define(["require","jquery","fuelux/combobox","fuelux/datepicker","fuelux/radio","fuelux/select","fuelux/spinner"],function(b){var d=b("jquery");var a=d.fn.scheduler;b("fuelux/combobox");b("fuelux/datepicker");b("fuelux/radio");b("fuelux/select");b("fuelux/spinner");var c=function(g,f){var e=this;this.$element=d(g);this.options=d.extend({},d.fn.scheduler.defaults,f);this.$startDate=this.$element.find(".scheduler-start .datepicker");this.$startTime=this.$element.find(".scheduler-start .combobox");this.$timeZone=this.$element.find(".scheduler-timezone .select");this.$repeatIntervalPanel=this.$element.find(".repeat-interval-panel");this.$repeatIntervalSelect=this.$element.find(".repeat-interval .select");this.$repeatIntervalSpinner=this.$element.find(".repeat-interval-panel .spinner");this.$repeatIntervalTxt=this.$element.find(".repeat-interval-text");this.$end=this.$element.find(".scheduler-end");this.$endAfter=this.$end.find(".spinner");this.$endSelect=this.$end.find(".select");this.$endDate=this.$end.find(".datepicker");this.$recurrencePanels=this.$element.find(".recurrence-panel");this.$element.find(".scheduler-weekly .btn-group .btn").on("click",function(i,h){e.changed(i,h,true)});this.$element.find(".combobox").on("changed",d.proxy(this.changed,this));this.$element.find(".datepicker").on("changed",d.proxy(this.changed,this));this.$element.find(".select").on("changed",d.proxy(this.changed,this));this.$element.find(".spinner").on("changed",d.proxy(this.changed,this));this.$element.find(".scheduler-monthly label.radio, .scheduler-yearly label.radio").on("mouseup",d.proxy(this.changed,this));this.$repeatIntervalSelect.on("changed",d.proxy(this.repeatIntervalSelectChanged,this));this.$endSelect.on("changed",d.proxy(this.endSelectChanged,this));this.$startDate.datepicker();this.$startTime.combobox();if(this.$startTime.find("input").val()===""){this.$startTime.combobox("selectByIndex",0)}this.$repeatIntervalSpinner.spinner();this.$endAfter.spinner();this.$endDate.datepicker()};c.prototype={constructor:c,changed:function(h,g,f){if(!f){h.stopPropagation()}this.$element.trigger("changed",{data:(g!==undefined)?g:d(h.currentTarget).data(),originalEvent:h,value:this.getValue()})},disable:function(){this.toggleState("disable")},enable:function(){this.toggleState("enable")},endSelectChanged:function(h,g){var f,i;if(!g){f=this.$endSelect.select("selectedItem");i=f.value}else{i=g.value}this.$endAfter.hide();this.$endDate.hide();if(i==="after"){this.$endAfter.show()}else{if(i==="date"){this.$endDate.show()}}},getValue:function(){var h=this.$repeatIntervalSpinner.spinner("value");var n="";var f=this.$repeatIntervalSelect.select("selectedItem").value;var g=this.$startTime.combobox("selectedItem").text.toLowerCase();var t=this.$timeZone.select("selectedItem");var r=function(v,x){var y="";var w;y+=v.getFullYear();y+=x;w=v.getMonth()+1;y+=(w<10)?"0"+w:w;y+=x;w=v.getDate();y+=(w<10)?"0"+w:w;return y};var q,s,i,e,m,p,u,o;u=""+r(this.$startDate.datepicker("getDate"),"-");u+="T";i=(g.search("am")>=0);e=(g.search("pm")>=0);g=d.trim(g.replace(/am/g,"").replace(/pm/g,"")).split(":");g[0]=parseInt(g[0],10);g[1]=parseInt(g[1],10);if(i&&g[0]>11){g[0]=0}else{if(e&&g[0]<12){g[0]+=12}}u+=(g[0]<10)?"0"+g[0]:g[0];u+=":";u+=(g[1]<10)?"0"+g[1]:g[1];u+=(t.offset==="+00:00")?"Z":t.offset;if(f==="none"){n="FREQ=DAILY;INTERVAL=1;COUNT=1;"}else{if(f==="hourly"){n="FREQ=HOURLY;";n+="INTERVAL="+h+";"}else{if(f==="daily"){n+="FREQ=DAILY;";n+="INTERVAL="+h+";"}else{if(f==="weekdays"){n+="FREQ=DAILY;";n+="BYDAY=MO,TU,WE,TH,FR;";n+="INTERVAL=1;"}else{if(f==="weekly"){s=[];this.$element.find(".scheduler-weekly .btn-group button.active").each(function(){s.push(d(this).data().value)});n+="FREQ=WEEKLY;";n+="BYDAY="+s.join(",")+";";n+="INTERVAL="+h+";"}else{if(f==="monthly"){n+="FREQ=MONTHLY;";n+="INTERVAL="+h+";";o=parseInt(this.$element.find("input[name=scheduler-month]:checked").val(),10);if(o===1){q=parseInt(this.$element.find(".scheduler-monthly-date .select").select("selectedItem").text,10);n+="BYMONTHDAY="+q+";"}else{if(o===2){s=this.$element.find(".month-days").select("selectedItem").value;p=this.$element.find(".month-day-pos").select("selectedItem").value;n+="BYDAY="+s+";";n+="BYSETPOS="+p+";"}}}else{if(f==="yearly"){n+="FREQ=YEARLY;";o=parseInt(this.$element.find("input[name=scheduler-year]:checked").val(),10);if(o===1){m=this.$element.find(".scheduler-yearly-date .year-month").select("selectedItem").value;q=this.$element.find(".year-month-day").select("selectedItem").text;n+="BYMONTH="+m+";";n+="BYMONTHDAY="+q+";"}else{if(o===2){s=this.$element.find(".year-month-days").select("selectedItem").value;p=this.$element.find(".year-month-day-pos").select("selectedItem").value;m=this.$element.find(".scheduler-yearly-day .year-month").select("selectedItem").value;n+="BYDAY="+s+";";n+="BYSETPOS="+p+";";n+="BYMONTH="+m+";"}}}}}}}}}var k=this.$endSelect.select("selectedItem").value;var j="";if(f!=="none"){if(k==="after"){j="COUNT="+this.$endAfter.spinner("value")+";"}else{if(k==="date"){j="UNTIL="+r(this.$endDate.datepicker("getDate"),"")+";"}}}n+=j;var l={startDateTime:u,timeZone:{name:t.name,offset:t.offset},recurrencePattern:n};return l},repeatIntervalSelectChanged:function(i,h){var g,j,f;if(!h){g=this.$repeatIntervalSelect.select("selectedItem");j=g.value;f=g.text}else{j=h.value;f=h.text}this.$repeatIntervalTxt.text(f);switch(j.toLowerCase()){case"hourly":case"daily":case"weekly":case"monthly":this.$repeatIntervalPanel.show();break;default:this.$repeatIntervalPanel.hide();break}this.$recurrencePanels.hide();this.$element.find(".scheduler-"+j).show();if(j==="none"){this.$end.hide()}else{this.$end.show()}},setValue:function(o){var k,g,n,e,f,j,h,m;if(o.startDateTime){m=o.startDateTime.split("T");this.$startDate.datepicker("setDate",m[0]);if(m[1]){m[1]=m[1].split(":");k=parseInt(m[1][0],10);f=(m[1][1])?parseInt(m[1][1].split("+")[0].split("-")[0].split("Z")[0],10):0;j=(k<12)?"AM":"PM";if(k===0){k=12}else{if(k>12){k-=12}}f=(f<10)?"0"+f:f;m=k+":"+f+" "+j;this.$startTime.find("input").val(m);this.$startTime.combobox("selectByText",m)}}n="li[data";if(o.timeZone){if(typeof(o.timeZone)==="string"){n+='-name="'+o.timeZone}else{if(o.timeZone.name){n+='-name="'+o.timeZone.name}else{n+='-offset="'+o.timeZone.offset}}n+='"]';this.$timeZone.select("selectBySelector",n)}else{if(o.startDateTime){m=o.startDateTime.split("T")[1];if(m){if(m.search(/\+/)>-1){m="+"+d.trim(m.split("+")[1])}else{if(m.search(/\-/)>-1){m="-"+d.trim(m.split("-")[1])}else{m="+00:00"}}}else{m="+00:00"}n+='-offset="'+m+'"]';this.$timeZone.select("selectBySelector",n)}}if(o.recurrencePattern){h={};m=o.recurrencePattern.toUpperCase().split(";");for(g=0,e=m.length;g<e;g++){if(m[g]!==""){n=m[g].split("=");h[n[0]]=n[1]}}if(h.FREQ==="DAILY"){if(h.BYDAY==="MO,TU,WE,TH,FR"){n="weekdays"}else{if(h.INTERVAL==="1"&&h.COUNT==="1"){n="none"}else{n="daily"}}}else{if(h.FREQ==="HOURLY"){n="hourly"}else{if(h.FREQ==="WEEKLY"){if(h.BYDAY){n=this.$element.find(".scheduler-weekly .btn-group");n.find("button").removeClass("active");m=h.BYDAY.split(",");for(g=0,e=m.length;g<e;g++){n.find('button[data-value="'+m[g]+'"]').addClass("active")}}n="weekly"}else{if(h.FREQ==="MONTHLY"){this.$element.find(".scheduler-monthly input").removeClass("checked");if(h.BYMONTHDAY){m=this.$element.find(".scheduler-monthly-date");m.find("input").addClass("checked");m.find(".select").select("selectByValue",h.BYMONTHDAY)}else{if(h.BYDAY){m=this.$element.find(".scheduler-monthly-day");m.find("input").addClass("checked");if(h.BYSETPOS){m.find(".month-day-pos").select("selectByValue",h.BYSETPOS)}m.find(".month-days").select("selectByValue",h.BYDAY)}}n="monthly"}else{if(h.FREQ==="YEARLY"){this.$element.find(".scheduler-yearly input").removeClass("checked");if(h.BYMONTHDAY){m=this.$element.find(".scheduler-yearly-date");m.find("input").addClass("checked");if(h.BYMONTH){m.find(".year-month").select("selectByValue",h.BYMONTH)}m.find(".year-month-day").select("selectByValue",h.BYMONTHDAY)}else{if(h.BYSETPOS){m=this.$element.find(".scheduler-yearly-day");m.find("input").addClass("checked");m.find(".year-month-day-pos").select("selectByValue",h.BYSETPOS);if(h.BYDAY){m.find(".year-month-days").select("selectByValue",h.BYDAY)}if(h.BYMONTH){m.find(".year-month").select("selectByValue",h.BYMONTH)}}}n="yearly"}else{n="none"}}}}}if(h.COUNT){this.$endAfter.spinner("value",parseInt(h.COUNT,10));this.$endSelect.select("selectByValue","after")}else{if(h.UNTIL){m=h.UNTIL;if(m.length===8){m=m.split("");m.splice(4,0,"-");m.splice(7,0,"-");m=m.join("")}this.$endDate.datepicker("setDate",m);this.$endSelect.select("selectByValue","date")}}this.endSelectChanged();if(h.INTERVAL){this.$repeatIntervalSpinner.spinner("value",parseInt(h.INTERVAL,10))}this.$repeatIntervalSelect.select("selectByValue",n);this.repeatIntervalSelectChanged()}},toggleState:function(e){this.$element.find(".combobox").combobox(e);this.$element.find(".datepicker").datepicker(e);this.$element.find(".select").select(e);this.$element.find(".spinner").spinner(e);this.$element.find(".radio").radio(e);if(e==="disable"){e="addClass"}else{e="removeClass"}this.$element.find(".scheduler-weekly .btn-group")[e]("disabled")},value:function(e){if(e){return this.setValue(e)}else{return this.getValue()}}};d.fn.scheduler=function(g){var f=Array.prototype.slice.call(arguments,1);var h;var e=this.each(function(){var k=d(this);var j=k.data("scheduler");var i=typeof g==="object"&&g;if(!j){k.data("scheduler",(j=new c(this,i)))}if(typeof g==="string"){h=j[g].apply(j,f)}});return(h===undefined)?e:h};d.fn.scheduler.defaults={};d.fn.scheduler.Constructor=c;d.fn.scheduler.noConflict=function(){d.fn.scheduler=a;return this};d(function(){d("body").on("mousedown.scheduler.data-api",".scheduler",function(){var e=d(this);if(e.data("scheduler")){return}e.scheduler(e.data())})})});