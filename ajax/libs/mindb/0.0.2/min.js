!function(a,b){function c(){return b.createElement("script")}if(a&&b){var d=b.getElementsByTagName("script")[0],e=d.parentNode;if(!a.JSON){var f=c();f.src="//cdn.staticfile.org/json2/20121008/json2.min.js",e.insertBefore(f,d)}if(!Function.prototype.bind||!Array.isArray){var g=c();g.src="//cdn.staticfile.org/es5-shim/2.1.0/es5-shim.min.js",e.insertBefore(g,d);var h=c();h.src="//cdn.staticfile.org/es5-shim/2.1.0/es5-sham.min.js",e.insertBefore(h,d)}}}("undefined"!=typeof window?window:this,"undefined"!=typeof document?document:null),!function(a,b){var c="undefined"!=typeof define,d="undefined"!=typeof exports;c?define(a,[],b):d?exports=b(require,exports,module):this[a]=b()}("min",function(a,b,c,d){"use strict";function e(){}function f(){}function g(){this._events=this._events||{},this._maxListeners=this._maxListeners||m}function h(a){this.results=null,this.errors=null,this.ended=!1,"function"==typeof a&&this.done(a)}function i(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b}function j(a){var b=this;this.queue=[],this.last=null,this.state=0,this.min=a;for(var c in a)a.hasOwnProperty(c)&&"function"==typeof a[c]&&!function(a){b[a]=function(){return b.queue.push({method:a,args:arguments}),b}}(c)}var k=b||{},l={noop:function(){return!1},inherits:function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})},extend:function(){for(var a=arguments[0],b=[].slice.call(arguments,1),c=0,d=b.length;d>c;c++)for(var e in b[c])a[e]=b[c][e];return a},arrayUnique:function(a){for(var b={},c=[],d=0,e=a.length;e>d;++d)b.hasOwnProperty(a[d])||(c.push(a[d]),b[a[d]]=1);return c},arrayInter:function(a){var b=[].slice.call(arguments,1);return l.arrayUnique(a).filter(function(a){for(var c=!0,d=0;d<b.length;d++)!function(d){var e=b[d];e.indexOf(a)<0&&(c=!1)}(d);return c})},arrayDiff:function(a){var b=[].slice.call(arguments,1);return a.filter(function(a){for(var c=!0,d=0;d<b.length;d++)!function(d){var e=b[d];e.indexOf(a)>=0&&(c=!1)}(d);return c})}};e.prototype.get=function(a){return sessionStorage?sessionStorage.getItem(a):!1},e.prototype.set=function(a,b){return sessionStorage?sessionStorage.setItem(a,b):!1},e.prototype.remove=function(a){return sessionStorage?sessionStorage.removeItem(a):!1},f.prototype.get=function(a){return localStorage?localStorage.getItem(a):!1},f.prototype.set=function(a,b){return localStorage?localStorage.setItem(a,b):!1},f.prototype.remove=function(a){return localStorage?localStorage.removeItem(a):!1},k.memStore=e,k.localStore=f;var m=10;g.prototype.setMaxListeners=function(a){if("number"!=typeof a||0>a)throw TypeError("n must be a positive number");this._maxListeners=a},g.prototype.emit=function(a){var b,c,d,e,f,g;if(this._events||(this._events={}),"error"===a&&(!this._events.error||"object"==typeof this._events.error&&!this._events.error.length)){if(b=arguments[1],!this.domain)throw b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');return b||(b=new TypeError('Uncaught, unspecified "error" event.')),!1}if(c=this._events[a],"undefined"==typeof c)return!1;if("function"==typeof c)switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,e=new Array(d-1),f=1;d>f;f++)e[f-1]=arguments[f];c.apply(this,e)}else if("object"==typeof c){for(d=arguments.length,e=new Array(d-1),f=1;d>f;f++)e[f-1]=arguments[f];for(g=c.slice(),d=g.length,f=0;d>f;f++)g[f].apply(this,e)}return!0},g.prototype.addListener=function(a,b){var c;if("function"!=typeof b)throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,"function"==typeof b.listener?b.listener:b),this._events[a]?"object"==typeof this._events[a]?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,"object"!=typeof this._events[a]||this._events[a].warned||(c=this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())),this},g.prototype.on=g.prototype.addListener,g.prototype.once=function(a,b){function c(){this.removeListener(a,c),b.apply(this,arguments)}if("function"!=typeof b)throw TypeError("listener must be a function");return c.listener=b,this.on(a,c),this},g.prototype.removeListener=function(a,b){var c,e,f,g;if("function"!=typeof b)throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,e=-1,c===b||"function"==typeof c.listener&&c.listener===b)this._events[a]=d,this._events.removeListener&&this.emit("removeListener",a,b);else if("object"==typeof c){for(g=f;g-->0;)if(c[g]===b||c[g].listener&&c[g].listener===b){e=g;break}if(0>e)return this;1===c.length?(c.length=0,this._events[a]=d):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},g.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&(this._events[a]=d),this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],"function"==typeof c)this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return this._events[a]=d,this},g.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?"function"==typeof this._events[a]?[this._events[a]]:this._events[a].slice():[]},g.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?"function"==typeof a._events[b]?1:a._events[b].length:0},k.EventEmitter=g,l.extend(k,new g),l.inherits(h,g),h.prototype.resolve=function(){var a=i(arguments);return this.emit("resolve",a),this.ended=!0,this.results=a,this},h.prototype.reject=function(){var a=i(arguments);return this.emit("reject",a),this.ended=!0,this.errors=a,this},h.prototype.then=function(a,b){var c=new h,d=this;return a=a||l.noop,b=b||l.noop,d.done(function(){var b=a.apply(d,arguments);b instanceof h?b.then(function(){c.resolve.apply(c,arguments)},function(a){c.reject(a)}):b instanceof Error&&c.reject(b)}).fail(function(a){b.call(d,a),c.reject(a)}),c},h.prototype.done=function(a){var b=this;return b.ended?null!==b.results&&a.apply(b,b.results):b.on("resolve",function(c){var d=a.apply(b,c);d instanceof h&&d.fail(b.reject.bind(b))}),b},h.prototype.fail=function(a){var b=this;return b.ended?null!==b.errors&&a.apply(b,b.errors):b.on("reject",function(c){a.apply(b,c)}),b},k.Promise=h,k.store=new k.localStore;var n={},o=null,p={0:"mix",1:"hash",2:"list",3:"set",4:"zset"};return k.fork=function(){var a={};for(var b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a},k.del=function(a,b){var c=this,d=new h(function(){c.emit("del",a),o&&clearTimeout(o),o=setTimeout(c.save.bind(c),5e3)}),e=this.store;"undefined"==typeof b&&(b=l.noop);var f="min-"+a;if(e.async)e.remove(f,function(c){return c?(d.reject(c),b(c)):(delete n[a],d.resolve(a),b(null,a),void 0)});else try{e.remove(f),delete n[a],d.resolve(a),b(null,a)}catch(g){d.reject(g),b(g)}return this.emit("del",a),d},k.exists=function(a,b){var c=new h;b=b||l.noop;try{this.get(a,function(a,d){return a&&(c.resolve(!1),b(null,!1)),"undefined"==typeof d?(c.resolve(!1),b(null,!1)):(c.resolve(!0),b(null,!0))})}catch(d){return c.reject(d),b(d)}return c},k.renamenx=function(a,b,c){var d=this,e=new h(function(){o&&clearTimeout(o),o=setTimeout(d.save.bind(d),5e3)});"undefined"==typeof c&&(c=l.noop);try{var f=function(a){e.reject(a),c(a)},g=null,i=null;k.exists(a).then(function(b){if(b)return k.get(a);var c=new Error("no such key");f(c)}).then(function(b){return g=n[a],i=b,k.del(a)}).then(function(){return k.set(b,i,c)}).then(function(){n[b]=g,e.resolve("OK"),c(null,"OK")}).fail(f)}catch(j){f(j)}return e},k.rename=function(a,b,c){var d=this,e=new h(function(){o&&clearTimeout(o),o=setTimeout(d.save.bind(d),5e3)}),f=function(a){e.reject(a),c(a)};return"undefined"==typeof c&&(c=l.noop),a==b?f(new Error("The key is equal to the new key.")):d.renamenx.apply(d,arguments).done(e.resolve.bind(e)).fail(e.reject.bind(e)),e},k.keys=function(a,b){var c=new h,d=Object.keys(n);b=b||l.noop;var e=a.replace("?","(.)").replace("*","(.*)");e=new RegExp(e);for(var f=[],g=0;g<d.length;g++)d[g].match(e)&&f.push(d[g]);return c.resolve(f),b(null,f),c},k.randomkey=function(a){var b=new h,c=Object.keys(n);"undefined"==typeof a&&(a=l.noop);var d=Math.round(Math.random()*(c.length-1)),e=c[d];return b.resolve(e),a(null,e),b},k.type=function(a,b){var c=new h;return b=b||l.noop,n.hasOwnProperty(a)?(c.resolve(p[n[a]]),b(null,b)):(c.resolve(null),b(null,null)),c},k.empty=function(a){var b=this,c=new h(function(a){b.emit("empty",a),o&&clearTimeout(o),o=setTimeout(b.save.bind(b),5e3)}),d=Object.keys(n),e=0;return a=a||l.noop,function f(g){g?b.del(g,function(a){a||e++,f(d.shift())}):(c.resolve(e),a(null,e))}(d.shift()),c},k.save=function(a){var b=this,c=new h(function(a,c){b.emit("save",a,c)});return a=a||l.noop,b.set("min_keys",JSON.stringify(n)).then(function(){return b.dump()}).then(function(b,d){c.resolve(b,d),a(b,d)}).fail(function(b){c.reject(b),a(b)}),c},k.dump=function(a){var b=this,c=new h;a=a||l.noop;var d={};return b.keys("*").then(function(e){!function f(g){if(g)b.get(g).then(function(a){d[g]=a,f(e.shift())}).fail(function(b){c.reject(b),a(b)});else{var h=JSON.stringify(d);c.resolve(d,h),a(null,d,h)}}(e.shift())}).fail(function(b){c.reject(b),a(b)}),c},k.restore=function(a,b){var c=this,d=new h(function(){c.emit("restore")});b=b||l.noop;var e=Object.keys(a);return function f(g,h){g?c.set(g,a[g]).then(function(){f(e.shift(),h)}).fail(function(a){d.reject(a),b(a)}):h()}(e.shift(),function(){c.exists("min_keys").then(function(a){return a?c.get("min_keys"):(d.resolve(),b(),void 0)}).then(function(a){n=JSON.parse(a),d.resolve(),b()})}),d},k.set=function(a,b,c){var d=this,e=new h(function(){o&&clearTimeout(o),o=setTimeout(d.save.bind(d),5e3)}),f=this.store;c=c||l.noop;var g="min-"+a;if(f.async){var i=JSON.stringify(b);f.set(g,i,function(d){return d?(e.reject(d),c(d)):(n[a]=0,e.resolve(a,b),c(null,a,b),void 0)})}else try{var i=JSON.stringify(b);f.set(g,i),n[a]=0,e.resolve(a,b),c(null,a,b)}catch(j){e.reject(j),c(j)}return this.emit("set",a,b),e},k.setnx=function(a,b,c){var d=new h,e=this;return c=c||l.noop,e.exists(a,function(f,g){return f&&(c(f),d.reject(f)),g?d.reject(new Error("The key is exists.")):(e.set(a,b,c).done(function(a,b){c(null,a,b),d.resolve(a,b)}).fail(function(a){c(a),d.reject(a)}),void 0)}),d},k.setex=function(a,b,c,d){function e(){g.del(a,l.noop)}var f=new h,g=this;return d=d||l.noop,g.set(a,c,function(a,c){setTimeout(e,1e3*b),d(a,c)}).done(function(a,c){setTimeout(e,1e3*b),f.resolve(a,c),d(null,a,c)}).fail(function(a){f.reject(a),d(a)}),f},k.psetex=function(a,b,c,d){function e(){g.del(a,l.noop)}var f=new h,g=this;return d=d||l.noop,g.set(a,c,function(a,c){setTimeout(e,b),d(a,c)}).done(function(){setTimeout(e,b),f.resolve.apply(f,arguments)}).fail(f.reject.bind(f)),f},k.mset=function(a,b){function c(b,e){delete g[e],f.set(b,a[b]).then(function(){j.push(arguments),i++,g[i]?c(g[i],i):d()}).fail(function(a){return k.push(a),i++,g[i]?c(g[i],i):d()})}function d(){k.length?(b(k),e.reject(k)):(b(null,j),e.resolve(j))}var e=new h,f=this,g=Object.keys(a),i=0,j=[],k=[];return b=b||l.noop,c(g[i],i),e},k.msetnx=function(a,b){function c(b,e){delete g[e],f.setnx(b,a[b]).then(function(){j.push(arguments),i++,g[i]?c(g[i],i):d()}).fail(function(a){k.push(a),d()})}function d(){return k.length?(b(k),e.reject(k)):(b(null,j),e.resolve(j),void 0)}var e=new h,f=this,g=Object.keys(a),i=0,j=[],k=[];return b=b||l.noop,c(g[i],i),e},k.append=function(a,b,c){var d=this,e=new h;return c=c||l.noop,d.exists(a).then(function(b){if(b)return d.get(a);var c=new h;return c.resolve(""),c}).then(function(c){return d.set(a,c+b)}).then(function(a){return d.strlen(a)}).done(function(a){e.resolve(a),c(null,a)}).fail(function(a){e.reject(a),c(a)}),e},k.get=function(a,b){var c=this,d=new h(function(b){c.emit("get",a,b)}),e=this.store;b=b||l.noop;var f="min-"+a;if(e.async)this.store.get(f,function(a,c){if(a){var e=new Error("no such key");return d.reject(e),b(e)}if(c){var f=JSON.parse(c);d.resolve(f),b(null,f)}else{var a=new Error("no such key");d.resolve(a),b(a)}});else try{var g=this.store.get(f);if(g){var i=JSON.parse(g);d.resolve(i),b(null,i)}else{var j=new Error("no such key");d.reject(j),b(j)}}catch(j){d.reject(j),b(j)}return d},k.mget=function(a,b){function c(b,e){delete a[e],f.get(b,function(b,e){return b?(j.push(b),i.push(null),g++,a[g]?c(a[g],g):d()):(i.push(e),g++,a[g]?c(a[g],g):d(),void 0)})}function d(){j.length?e.reject(j):e.resolve(i)}var e=new h,f=this,g=0,i=[],j=[];return b=b||l.noop,c(a[g],g),e},k.getset=function(a,b,c){var d=this,e=new h(function(c){d.emit("getset",a,b,c)});"undefined"==typeof c&&(c=l.noop);var f=null;return d.get(a).then(function(c){return f=c,d.set(a,b)}).then(function(){e.resolve(f),c(null,f)}).fail(function(a){e.reject(a),c(a)}),e},k.strlen=function(a,b){var c=this,d=new h;return b=b||l.noop,c.get(a).then(function(a){if("string"==typeof a){var c=a.length;d.resolve(c),b(null,c)}else{var e=new TypeError;d.reject(e),b(e)}}).fail(function(a){d.reject(a),b(a)}),d},k.incr=function(a,b){var c=this,d=new h(function(b){c.emit("incr",a,b)});return b=b||l.noop,c.exists(a).then(function(b){if(b)return c.get(a);var d=new h;return d.resolve(0),d}).then(function(e){return isNaN(parseInt(e))?(d.reject("value wrong"),b("value wrong")):(e=parseInt(e),c.set(a,++e))}).done(function(a,c){d.resolve(c),b(null,c)}).fail(function(a){d.reject(a),b(a)}),d},k.incrby=function(a,b,c){var d=this,e=new h(function(b){d.emit("incrby",a,b)});return c=c||l.noop,d.exists(a).then(function(b){if(b)return d.get(a);var c=new h;return c.resolve(0),c}).then(function(f){return isNaN(parseInt(f))?(e.reject("value wrong"),c("value wrong")):(f=parseInt(f),d.set(a,f+b))}).done(function(a,b){e.resolve(b),c(null,b)}).fail(function(a){e.reject(a),c(a)}),e},k.incrbyfloat=k.incrby,k.hset=function(a,b,c,d){var e=this,f=new h(function(){e.emit("hset",a,b,c)});return d=d||l.noop,e.exists(a,function(g,h){if(g)return f.reject(g),d(g);if(h)e.get(a,function(g,h){return g?(f.reject(g),d(g)):(h[b]=c,e.set(a,h,function(e){return e?(f.reject(e),d(e)):(f.resolve(a,b,c),d(null,a,b,c),void 0)}),void 0)});else{var i={};i[b]=c,e.set(a,i,function(e){return e?(f.reject(e),d(e)):(n[a]=1,f.resolve(a,b,c),d(null,a,b,c),void 0)})}}),f},k.hsetnx=function(a,b,c,d){var e=new h,f=this;return d=d||l.noop,f.hexists(a,b,function(g,h){if(g)return e.reject(g),d(g);if(h){var g=new Error("The field of the hash is exists");return e.reject(g),d(g)}f.hset(a,b,c,function(a){a&&(e.reject(a),d(a)),e.resolve("OK"),d(null,"OK")})}),e},k.hmset=function(a,b,c){var d=new h,e=this;c=c||l.noop;var f=Object.keys(b),g=[];return function i(h){var j=f[h];j?e.hset(a,j,b[j],function(a,b){return a?(d.reject(a),c(a)):(g.push(b),i(++h),void 0)}):(c(null,g),d.resolve(g))}(0),d},k.hget=function(a,b,c){var d=new h,e=this;return c=c||l.noop,e.hexists(a,b,function(f,g){if(f)return d.reject(f),c(f);if(g)e.get(a).done(function(a){var e=a[b];d.resolve(e),c(null,e)}).fail(function(a){d.reject(a),c(a)});else{var f=new Error("no such field");d.reject(f),c(f)}}),d},k.hmget=function(a,b,c){var d=new h,e=this;c=c||l.noop;var f=[];return function g(h){var i=b[h];i?e.hget(a,i,function(a){return a?(c(a),d.reject(a)):(f.push(f),g(++h),void 0)}):(d.resolve(f),c(null,f))}(0),d},k.hgetall=function(a,b){var c=new h,d=this;return b=b||l.noop,d.exists(a,function(e,f){if(e)return b(e),c.reject(e);if(!f){var e=new Error("no such key");return b(e),c.reject(e)}d.get(a).done(function(a){c.resolve(a),b(null,a)}).fail(function(){})}),c},k.hdel=function(a,b,c){var d=this,e=new h(function(a,b,c){d.emit("hdel",a,b,c)});return c=c||l.noop,d.hexists(a.field,function(f,g){if(f)return c(f),e.reject(f);if(!g){var f=new Error("no such key");return c(f),e.reject(f)}d.get(a).done(function(f){var g=f[b];delete f[b],d.set(a,f).done(function(){e.resolve(a,b,g),c(null,a,b,g)}).fail(function(a){e.reject(a),c(a)})}).fail(function(a){c(a)})}),e},k.hlen=function(a,b){var c=new h,d=this;return b=b||l.noop,d.exists(a,function(e,f){return e?(c.reject(e),b(e)):(f?d.get(a).done(function(a){var d=Object.keys(a).length;c.resolve(d),b(null,d)}).fail(function(a){c.reject(a),b(a)}):(c.resolve(0),b(null,0)),void 0)}),c},k.hkeys=function(a,b){var c=new h,d=this;return b=b||l.noop,d.exists(a,function(e,f){return e?(c.reject(e),b(e)):(f?d.get(a).done(function(a){var d=Object.keys(a);c.resolve(d),b(null,d)}).fail(function(a){c.reject(a),b(a)}):(c.resolve(0),b(null,0)),void 0)}),c},k.hexists=function(a,b,c){var d=new h,e=this;return c=c||l.noop,e.exists(a).then(function(b){return b?e.get(a):(d.resolve(!1),c(null,!1),void 0)}).then(function(a){a.hasOwnProperty(b)?(d.resolve(!0),c(null,!0)):(d.resolve(!1),c(null,!1))}).fail(function(a){d.reject(a),c(a)}),d},k.lpush=function(a,b,c){var d=this,e=new h(function(b){d.emit("lpush",a,b)});return c=c||l.noop,d.exists(a,function(f,g){if(f)return e.reject(f),c(f);if(g)d.get(a,function(f,g){return f?(e.reject(f),c(f)):(g.unshift(b),d.set(a,g,function(a){if(a)return e.reject(a),c(a);var b=g.length;e.resolve(b),c(null,b)}),void 0)});else{var h=[b];d.set(a,h,function(b){return b?(e.reject(b),c(b)):(n[a]=2,e.resolve(1),c(null,1),void 0)})}}),e},k.lpushx=function(a,b,c){var d=new h;c=c||l.noop;var e=this;return e.exists(a,function(f,g){if(f)return d.reject(f),c(f);if(!g){var f=new Error("no such key");return c(f),d.reject(f)}e.get(a,function(f,g){if(f)return d.reject(f),c(f);if(!g.length){var f=new Error("The list is empty.");return c(f),d.reject(f)}g.unshift(b),e.set(a,g,function(a){if(a)return d.reject(a),c(a);var b=g.length;d.resolve(b),c(null,b)})})}),d},k.rpush=function(a,b,c){var d=this,e=new h(function(b){d.emit("rpush",a,b)});return c=c||l.noop,d.exists(a,function(f,g){if(f)return e.reject(f),c(f);if(g)d.get(a,function(f,g){return f?(e.reject(f),c(f)):(g.push(b),d.set(a,g,function(a){if(a)return e.reject(a),c(a);var b=g.length;e.resolve(b),c(null,b)}),void 0)});else{var h=[b];d.set(a,h,function(a){return a?(e.reject(a),c(a)):(e.resolve(1),c(null,1),void 0)})}}),e},k.lpushx=function(a,b,c){var d=new h;c=c||l.noop;var e=this;return e.exists(a,function(f,g){if(f)return d.reject(f),c(f);if(!g){var f=new Error("no such key");return c(f),d.reject(f)}e.get(a,function(f,g){if(f)return d.reject(f),c(f);if(!g.length){var f=new Error("The list is empty.");return c(f),d.reject(f)}g.push(b),e.set(a,g,function(a){if(a)return d.reject(a),c(a);var b=g.length;d.resolve(b),c(null,b)})})}),d},k.lpop=function(a,b){var c=this,d=new h(function(b){c.emit("lpop",a,b)});b=b||l.noop;var e=null;return c.exists(a).then(function(e){return e?c.get(a):(d.resolve(null),b(null,null),void 0)}).then(function(b){return e=b.shift(),c.set(a,b)}).then(function(){d.resolve(e),b(null,e)}).fail(function(a){d.reject(a),b(a)}),d},k.rpop=function(a,b){var c=this,d=new h(function(b){c.emit("rpop",a,b)});b=b||l.noop;var e=null;return c.exists(a).then(function(e){return e?c.get(a):(d.resolve(null),b(null,null),void 0)}).then(function(b){return e=b.pop(),c.set(a,b)}).then(function(){d.resolve(e),b(null,e)}).fail(function(a){d.reject(a),b(a)}),d},k.llen=function(a,b){var c=new h;b=b||l.noop;var d=this;return d.exists(a,function(e,f){return e?(c.reject(e),b(e)):(f?d.get(a,function(a,d){if(a)return c.reject(a),b(a);var e=d.length;c.resolve(e),b(null,e)}):(c.resolve(0),b(null,0)),void 0)}),c},k.lrange=function(a,b,c,d){var e=new h;d=d||l.noop;var f=this;return f.exists(a,function(g,h){return g?(e.reject(g),d(g)):(h?f.get(a,function(a,f){if(a)return e.reject(a),d(a);var g=f.slice(b,c+1);e.resolve(g),d(null,g)}):(e.resolve(null),d(null,null)),void 0)}),e},k.lrem=function(a,b,c,d){var e=this,f=new h(function(b){e.emit("lrem",a,b)});return d=d||l.noop,e.exists(a,function(g,h){return g?(f.reject(g),d(g)):(h?e.get(a,function(a,e){if(a)return f.reject(a),d(a);var g=0;switch(!0){case b>0:for(var h=0;h<e.length&&b>g;h++)if(e[h]===c){{e.splice(h,1)[0]}g++}break;case 0>b:for(var h=e.length-1;h>=0&&b>g;h--)if(e[h]===c){{e.splice(h,1)[0]}g++}break;case b=0:for(var h=e.length-1;h>=0;h--)if(e[h]===c){{e.splice(h,1)[0]}g++}}f.resolve(g),d(null,g)}):(f.resolve(null),d(null,null)),void 0)}),f},k.lset=function(a,b,c,d){var e=this,f=new h(function(b){e.emit("lset",a,b)});return d=d||l.noop,e.exists(a,function(g,h){if(g)return f.reject(g),d(g);if(!h){var g=new Error("no such key");return f.reject(g),d(g)}e.get(a,function(g,h){if(g)return f.reject(g),d(g);if(!h[b]||!h.length){var g=new Error("no such key");return f.reject(g),d(g)}h[b]=c,e.set(a,h,function(a){if(a)return f.reject(a),d(a);var b=h.length;f.resolve(b),d(null,b)})})}),f},k.ltrim=function(a,b,c,d){var e=new h,f=this;return d=d||l.noop,f.exists(a,function(g,h){return g?(e.reject(g),d(g)):(h?f.get(a,function(a,f){if(a)return e.reject(a),d(a);var g=f.splice(b,c+1);e.resolve(g),d(null,g)}):(e.resolve(null),d(null,null)),void 0)}),e},k.lindex=function(a,b,c){var d=new h,e=this;return c=c||l.noop,e.exists(a,function(f,g){return f?(d.reject(f),c(f)):(g?e.get(a,function(a,e){if(a)return d.reject(a),c(a);var f=e[b];d.resolve(f),c(null,f)}):(d.resolve(null),c(null,null)),void 0)}),d},k.linsertBefore=function(a,b,c,d){var e=new h,f=this;return d=d||l.noop,f.exists(a,function(g,h){return g?(e.reject(g),d(g)):(h?f.get(a,function(g,h){if(g)return e.reject(g),d(g);var i=h.indexOf(b);return 0>i?(e.resolve(null),d(null,null)):(h.splice(i,1,c,b),f.set(a,h,function(a){if(a)return e.reject(a),d(a);var b=h.length;e.resolve(b),d(null,b)}),void 0)}):(e.resolve(null),d(null,null)),void 0)}),e},k.linsertAfter=function(a,b,c,d){var e=new h,f=this;return d=d||l.noop,f.exists(a,function(g,h){return g?(e.reject(g),d(g)):(h?f.get(a,function(g,h){if(g)return e.reject(g),d(g);var i=h.indexOf(b);return 0>i?(e.resolve(null),d(null,null)):(h.splice(i,0,c),f.set(a,h,function(a){if(a)return e.reject(a),d(a);var b=h.length;e.resolve(b),d(null,b)}),void 0)}):(e.resolve(null),d(null,null)),void 0)}),e},k.rpoplpush=function(a,b,c){var d=new h,e=this;return c=c||l.noop,e.rpop(a).then(function(a){return e.lpush(b,a)}).then(function(a){d.resolve(value,a),c(null,value,a)}).fail(function(a){c(a),d.reject(a)}),d},k.sadd=function(a,b){var c=this,d=new h(function(b){c.emit("sadd",a,b)});b=[].slice.call(arguments,1);var e=0;if(b[b.length-1]instanceof Function)var f=b.splice(b.length-1,1)[0];else var f=l.noop;return c.exists(a).then(function(d){if(d)return c.get(a);var e=l.arrayUnique(b);return c.set(a,e)}).then(function(){if(Array.isArray(arguments[0])){for(var g=arguments[0],h=0;h<b.length;h++)!function(a){var c=b[a];g.indexOf(c)>=0||(g.push(c),e++)}(h);return c.set(a,g)}"string"==typeof arguments[0]&&(e+=b.length,n[a]=3,d.resolve(e),f(null,e))}).then(function(){n[a]=3,d.resolve(e),f(null,e)}).fail(function(a){d.reject(a),f(a)}),d},k.srem=function(a,b,c){var d=this,e=new h(function(b){d.emit("srem",a,b)});b=[].slice.call(arguments,1);var f=0;return b[b.length-1]instanceof Function||(c=l.noop),d.exists(a).then(function(b){return b?d.get(a):new Error("no such key")}).then(function(c){for(var e=0;e<b.length;e++)!function(a){var d=b[a],e=c.indexOf(d);e>=0&&(c.splice(e,1),f++)}(e);return d.set(a,c)}).then(function(){n[a]=3,e.resolve(f),c(null,f)}).fail(function(a){e.reject(a),c(a)}),e},k.smembers=function(a,b){var c=new h,d=this;return b=b||l.noop,d.exists(a).then(function(b){return b?d.get(a):new Error("no such key")}).then(function(a){c.resolve(a),b(null,a)}).fail(function(a){c.reject(a),b(a)}),c},k.sismember=function(a,b,c){var d=this,e=new h;return d.exists(a).then(function(b){return b?d.get(a):new Error("no such key")}).then(function(a){var d=a.indexOf(b)>=0?1:0;e.resolve(d),c(null,d)}).fail(function(a){e.reject(a),c(a)}),e},k.scard=function(a,b){var c=new h;b=b||l.noop;var d=this;return d.exists(a).then(function(b){return b?d.get(a):new Error("no such key")}).then(function(a){var d=a.length;c.resolve(d),b(null,d)}).fail(function(a){c.reject(a),b(a)}),c},k.smove=function(a,b,c,d){var e=this,f=new h(function(d){e.emit("smove",a,b,c,d)});return members=[].slice.call(arguments,1),members[members.length-1]instanceof Function||(d=l.noop),e.exists(key).then(function(b){return b?e.sismember(a,c):new Error("no such key")}).then(function(b){return b?e.srem(a,c):new Error("no such member")}).then(function(){return e.sismember(b,c)}).then(function(a){return a?(n[key]=3,f.resolve(0),d(null,0),void 0):e.sadd(b,c)}).then(function(){n[key]=3,f.resolve(1),d(null,1)}).fail(function(a){f.reject(a),d(a)}),f},k.srandmember=function(a,b){var c=new h,d=this;return b=b||l.noop,d.exists(a).then(function(e){return e?d.get(a):(c.resolve(null),b(null,null),void 0)}).then(function(a){var d=Math.random()*a.length|0,e=a[d];c.resolve(e),b(null,e)}).fail(function(a){c.reject(a),b(a)}),c},k.spop=function(a,b){var c=this,d=new h(function(b){c.emit("spop",a,b)});b=b||l.noop;var e=null;return c.exists(a).then(function(e){return e?c.srandmember(a):(d.resolve(null),b(null,null),void 0)}).then(function(b){return e=b,c.srem(a,e)}).then(function(){d.resolve(e),b(null,e)}).fail(function(a){d.reject(a),b(a)}),d},k.sunion=function(a,b){var c=new h,d=this;a=[].slice.call(arguments),a[a.length-1]instanceof Function||(b=l.noop);var e=[];return function f(g){var h=a[g];h?d.exists(h).then(function(a){return a?d.get(h):(f(++g),void 0)}).then(function(a){Array.isArray(a)&&(e=e.concat(a)),f(++g)}).fail(function(a){return c.reject(a),b(a)}):(e=l.arrayUnique(e),c.resolve(e),b(null,e))}(0),c},k.sunionstore=function(a,b,c){var d=new h,e=this;b=[].slice.call(arguments,2),b[b.length-1]instanceof Function||(c=l.noop);var f=null;return e.sunion(b).then(function(b){return f=b,e.exists(a)}).then(function(b){return b?e.del(a):e.sadd(a,f)}).then(function(b){return"number"!=typeof b?e.sadd(a,f):(d.resolve(b,f),c(null,b,f),void 0)}).then(function(a){d.resolve(a,f),c(null,a,f)}).fail(function(a){d.reject(a),c(a)}),d},k.sinter=function(a,b){var c=new h,d=this;a=[].slice.call(arguments),a[a.length-1]instanceof Function||(b=l.noop);var e=[];return function f(g){var h=a[g];if(h)d.exists(h).then(function(a){return a?d.get(h):(f(++g),void 0)}).then(function(a){Array.isArray(a)&&e.push(a),f(++g)}).fail(function(a){return c.reject(a),b(a)});else{var i=l.arrayInter.apply(l,e);c.resolve(i),b(null,i)}}(0),c},k.sinterstore=function(a,b,c){var d=new h,e=this;b=[].slice.call(arguments,1),b[b.length-1]instanceof Function||(c=l.noop);var f=null;return e.sinter.apply(e,b).then(function(b){return f=b,e.exists(a)}).then(function(b){return b?e.del(a):(f.unshift(a),e.sadd.apply(e,f))}).then(function(b){return"string"!=typeof b?e.sadd(a,f):(d.resolve(f.length,f),c(null,f.length,f),void 0)}).then(function(){d.resolve(f.length,f),c(null,f.length,f)}).fail(function(a){d.reject(a),c(a)}),d},k.sdiff=function(a,b){var c=new h,d=this;a=[].slice.call(arguments,1),a[a.length-1]instanceof Function||(b=l.noop);var e=[];return function f(g){var h=a[g];if(h)d.exists(h).then(function(a){return a?d.get(h):(f(++g),void 0)}).then(function(a){Array.isArray(a)&&e.push(a),f(++g)}).fail(function(a){return c.reject(a),b(a)});else{var i=l.arrayDiff.apply(l,e);c.resolve(i),b(null,i)}}(0),c},k.sdiffstore=function(a,b,c){var d=new h,e=this;b=[].slice.call(arguments,2),b[b.length-1]instanceof Function||(c=l.noop);var f=null;return e.sdiff(b).then(function(b){return f=b,e.exists(a)}).then(function(b){return b?e.del(a):e.sadd(a,f)}).then(function(b){return"number"!=typeof b?e.sadd(a,f):(d.resolve(b,f),c(null,b,f),void 0)}).then(function(a){d.resolve(a,f),c(null,a,f)}).fail(function(a){d.reject(a),c(a)}),d},k.zadd=function(a,b,c,d){var e=this,f=new h(function(a){e.emit("zadd",a)});return d=d||l.noop,e.exists(a).then(function(d){if(d)return e.get(a);var f={};return f[b]=[0],e.set(a,{ms:[c],hsm:{0:b},shm:f})}).then(function(g){if("string"==typeof g)n[a]=4,f.resolve(1,1),d(null,1,1);else if("object"==typeof g){var h=g;if(h.ms.indexOf(c)>=0){var i=h.ms.length;return f.resolve(0,i),d(null,0,i)}var j=h.ms.length;return h.ms.push(c),h.hsm[j]=b,Array.isArray(h.shm[b])?h.shm[b].push(j):h.shm[b]=[j],e.set(a,h)}}).then(function(a,b){n[a]=4;var c=b.ms.length;f.resolve(1,c),d(null,1,c)}).fail(function(a){f.reject(a),d(a)}),f},k.zcard=function(a,b){var c=this,d=new h;return b=b||l.noop,c.exists(a).then(function(e){if(e)return c.get(a);var f=new Error("no such key");d.reject(f),b(f)}).then(function(a){var c=a.ms.filter(Boolean).length;d.resolve(c),b(null,c)}).fail(function(a){d.reject(a),b(a)}),d},k.zcount=function(a,b,c,d){var e=this,f=new h(function(a){e.emit(a)});return d=d||l.noop,e.exists(a).then(function(b){if(b)return e.get(a);var c=new Error("no such key");f.reject(c),d(c)}).then(function(a){var e=Object.keys(a.shm).filter(function(a){return a>=b&&c>=a}).map(function(b){return a.shm[b]}),g=0;e.forEach(function(a){g+=a.length}),f.resolve(g),d(null,g)}).fail(function(a){f.reject(a),d(a)}),f},k.zrem=function(a){var b=this,c=new h(function(a){b.emit("zrem",a)}),d=arguments[arguments.length-1],e=[].slice.call(arguments,1);"function"!=typeof d?d=l.noop:e.pop();var f=0;return b.exists(a).then(function(e){if(e)return b.get(a);var f=new Error("no such key");c.reject(f),d(f)}).then(function(a){for(var b=e.length,c=new h,d=0;d<e.length;d++)!function(d){var g=a.ms.indexOf(e[d]);if(g>=0){a.ms[g]=0;var h=a.hsm[g];delete a.hsm[g];var i=a.shm[h].indexOf(g);i>=0&&a.shm[h].splice(i,1),f++,--b||c.resolve(a)}else b--}(d);return c}).then(function(c){return b.set(a,c)}).then(function(){c.resolve(f),d(null,f)}).fail(function(a){c.reject(a),d(null,a)}),c},k.zscore=function(a,b,c){var d=this,e=new h;return c=c||l.noop,d.exists(a).then(function(b){if(b)return d.get(a);var f=new Error("no such key");e.reject(f),c(f)}).then(function(a){var d=a.ms.indexOf(b);if(d>=0){var f=a.hsm[d];e.resolve(f),c(null,f)}else{var g=new Error("This member does not be in the set");e.reject(g),c(g)}}),e},k.zrange=function(a,b,c,d){var e=this,f=new h(function(a){e.emit(a)});return d=d||l.noop,e.exists(a).then(function(b){if(b)return e.get(a);var c=new Error("no such key");f.reject(c),d(c)}).then(function(a){var e=Object.keys(a.shm).filter(function(a){return a>=b&&c>=a}).map(function(b){return a.shm[b]}),g=[];e.forEach(function(b){g=g.concat(b.map(function(b){return a.ms[b]}))}),f.resolve(g),d(null,g)}).fail(function(a){f.reject(a),d(a)}),f},k.zrevrange=function(a,b,c,d){var e=this,f=new h(function(a){e.emit(a)});return d=d||l.noop,e.exists(a).then(function(b){if(b)return e.get(a);var c=new Error("no such key");f.reject(c),d(c)}).then(function(a){var e=Object.keys(a.shm).reverse().filter(function(a){return a>=b&&c>=a}).map(function(b){return a.shm[b]}),g=[];e.forEach(function(b){g=g.concat(b.map(function(b){return a.ms[b]}))}),f.resolve(g),d(null,g)}).fail(function(a){f.reject(a),d(a)}),f},j.prototype.exec=function(a){var b=this,c=[];!function d(e){e?b.min[e.method].apply(b.min,e.args).then(function(){c.push(arguments),d(b.queue.shift())}).fail(function(b){a(b,c)}):a(null,c)}(b.queue.shift())},k.multi=function(){return new j(this)},k.exists("min_keys").then(function(a){return a?k.get("min_keys"):void 0}).then(function(a){n=JSON.parse(a)}),k});
//# sourceMappingURL=min.js.source