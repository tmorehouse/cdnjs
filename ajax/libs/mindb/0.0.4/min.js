!function(a,b){function c(){return b.createElement("script")}if(a&&b){var d=b.getElementsByTagName("script")[0],e=d.parentNode;if(!a.JSON){var f=c();f.src="//cdn.staticfile.org/json2/20121008/json2.min.js",e.insertBefore(f,d)}if(!Function.prototype.bind||!Array.isArray){var g=c();g.src="//cdn.staticfile.org/es5-shim/2.1.0/es5-shim.min.js",e.insertBefore(g,d);var h=c();h.src="//cdn.staticfile.org/es5-shim/2.1.0/es5-sham.min.js",e.insertBefore(h,d)}Object.create||(Object.create=function(){function a(){}return function(b,c){a.prototype={};for(var d in b)a.prototype[d]=b[d];for(var d in c)a.prototype[d]=c[d];return new a}}())}}("undefined"!=typeof window?window:this,"undefined"!=typeof document?document:null),!function(a,b){var c="undefined"!=typeof define,d="undefined"!=typeof exports;c?define(a,[],b):d?exports=b(require,exports,module):this[a]=b()}("min",function(a,b,c,d){"use strict";function e(){}function f(){}function g(){this._events=this._events||{},this._maxListeners=this._maxListeners||o}function h(a){this.results=null,this.errors=null,this.ended=!1,"function"==typeof a&&this.then(a)}function i(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b}function j(a){var b=this;this.queue=[],this.last=null,this.state=0,this.min=a;for(var c in a)a.hasOwnProperty(c)&&"function"==typeof a[c]&&!function(a){b[a]=function(){return b.queue.push({method:a,args:arguments}),b}}(c)}function k(a,b,c){var d=this;d.min=b,d.callback=c,d.result=[],d.keys={},d.promise=new h,d.sortFn=function(a,b){return n.isNumber(a)&&n.isNumber(b)?a-b:JSON.stringify(a)>JSON.stringify(b)};var e=function(){d.min.exists(a).then(function(b){return b?d.min.get(a):new Error("no such key")}).then(function(a){var b=new h;switch(!0){case Array.isArray(a):b.resolve(a);break;case a.ms&&Array.isArray(a.ms):b.resolve(a.ms);break;default:return new Error("content type wrong")}return b}).then(function(a){d.result=a.sort(d.sortFn),d.result.forEach(function(a){d.keys[a]=a}),d.promise.resolve(d.result),d.callback(null,d.result)}).fail(function(a){d.promise.reject(a),d.callback(a)})};!function f(a){var b=a.shift();b?(d[b]=function(){return d.promise[b].apply(d.promise,arguments)},f(a)):e()}(["then","fail","done"])}function l(a,b,c,d){b=b||"*",this.cursor=a||0,this.pattern=new RegExp(b.replace("*","(.*)")),this.limit=c>-1?c:10,this.end=this.cursor,this.parent=d}var m=b||{},n={noop:function(){return!1},inherits:function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})},extend:function(){for(var a=arguments[0],b=[].slice.call(arguments,1),c=0,d=b.length;d>c;c++)for(var e in b[c])a[e]=b[c][e];return a},isNumber:function(a){return"[object Number]"==toString.call(a)},isUndefined:function(a){return void 0===a},arrayUnique:function(a){for(var b={},c=[],d=0,e=a.length;e>d;++d)b.hasOwnProperty(a[d])||(c.push(a[d]),b[a[d]]=1);return c},arrayInter:function(a){var b=[].slice.call(arguments,1);return n.arrayUnique(a).filter(function(a){for(var c=!0,d=0;d<b.length;d++)!function(d){var e=b[d];e.indexOf(a)<0&&(c=!1)}(d);return c})},arrayDiff:function(a){var b=[].slice.call(arguments,1);return a.filter(function(a){for(var c=!0,d=0;d<b.length;d++)!function(d){var e=b[d];e.indexOf(a)>=0&&(c=!1)}(d);return c})}};e.prototype.get=function(a){return sessionStorage?sessionStorage.getItem(a):!1},e.prototype.set=function(a,b){return sessionStorage?sessionStorage.setItem(a,b):!1},e.prototype.remove=function(a){return sessionStorage?sessionStorage.removeItem(a):!1},f.prototype.get=function(a){return localStorage?localStorage.getItem(a):!1},f.prototype.set=function(a,b){return localStorage?localStorage.setItem(a,b):!1},f.prototype.remove=function(a){return localStorage?localStorage.removeItem(a):!1},m.memStore=e,m.localStore=f;var o=10;g.prototype.setMaxListeners=function(a){if("number"!=typeof a||0>a)throw TypeError("n must be a positive number");this._maxListeners=a},g.prototype.emit=function(a){var b,c,d,e,f,g;if(this._events||(this._events={}),"error"===a&&(!this._events.error||"object"==typeof this._events.error&&!this._events.error.length)){if(b=arguments[1],!this.domain)throw b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');return b||(b=new TypeError('Uncaught, unspecified "error" event.')),!1}if(c=this._events[a],"undefined"==typeof c)return!1;if("function"==typeof c)switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,e=new Array(d-1),f=1;d>f;f++)e[f-1]=arguments[f];c.apply(this,e)}else if("object"==typeof c){for(d=arguments.length,e=new Array(d-1),f=1;d>f;f++)e[f-1]=arguments[f];for(g=c.slice(),d=g.length,f=0;d>f;f++)g[f].apply(this,e)}return!0},g.prototype.addListener=function(a,b){var c;if("function"!=typeof b)throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,"function"==typeof b.listener?b.listener:b),this._events[a]?"object"==typeof this._events[a]?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,"object"!=typeof this._events[a]||this._events[a].warned||(c=this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())),this},g.prototype.on=g.prototype.addListener,g.prototype.once=function(a,b){function c(){this.removeListener(a,c),b.apply(this,arguments)}if("function"!=typeof b)throw TypeError("listener must be a function");return c.listener=b,this.on(a,c),this},g.prototype.removeListener=function(a,b){var c,e,f,g;if("function"!=typeof b)throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,e=-1,c===b||"function"==typeof c.listener&&c.listener===b)this._events[a]=d,this._events.removeListener&&this.emit("removeListener",a,b);else if("object"==typeof c){for(g=f;g-->0;)if(c[g]===b||c[g].listener&&c[g].listener===b){e=g;break}if(0>e)return this;1===c.length?(c.length=0,this._events[a]=d):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},g.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&(this._events[a]=d),this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],"function"==typeof c)this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return this._events[a]=d,this},g.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?"function"==typeof this._events[a]?[this._events[a]]:this._events[a].slice():[]},g.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?"function"==typeof a._events[b]?1:a._events[b].length:0},m.EventEmitter=g,n.extend(m,new g),n.inherits(h,g),h.prototype.resolve=function(){var a=i(arguments);return this.emit("fulfill",a),this.ended=!0,this.results=a,this},h.prototype.reject=function(){var a=i(arguments);return this.emit("reject",a),this.ended=!0,this.errors=a,this},h.prototype.then=function(a,b){var c=new h,d=this;a=a||n.noop,b=b||n.noop;var e=function(a){a&&"function"==typeof a.then?a.then(function(){c.resolve.apply(c,arguments)},function(a){c.reject(a)}):a instanceof Error&&c.reject(a)};return d.ended&&(d.results||d.errors)?(d.results&&e(a.apply(null,d.results)),d.errors&&(b.apply(null,d.errors),e.apply(null,d.errors))):d.once("fulfill",function(b){return e(a.apply(null,b))}).once("reject",function(a){return b.call(null,a),e(a)}),c},h.prototype.fail=function(a){var b=this;return b.ended&&null!==b.errors?a.apply(b,b.errors):b.once("reject",function(c){a.apply(b,c),b.ended=!1}),b},m.Promise=h,m.store=new m.localStore;var p={},q=null,r={0:"mix",1:"hash",2:"list",3:"set",4:"zset"};return m.fork=function(){var a={};for(var b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a},m.del=function(a,b){var c=this,d=new h(function(){c.emit("del",a),q&&clearTimeout(q),q=setTimeout(c.save.bind(c),5e3)}),e=this.store;"undefined"==typeof b&&(b=n.noop);var f="min-"+a;if(e.async)e.remove(f,function(c){return c?(d.reject(c),b(c)):(delete p[a],d.resolve(a),b(null,a),void 0)});else try{e.remove(f),delete p[a],d.resolve(a),b(null,a)}catch(g){d.reject(g),b(g)}return this.emit("del",a),d},m.exists=function(a,b){var c=new h;b=b||n.noop;try{this.get(a,function(a,d){return a&&(c.resolve(!1),b(null,!1)),"undefined"==typeof d?(c.resolve(!1),b(null,!1)):(c.resolve(!0),b(null,!0))})}catch(d){return c.reject(d),b(d)}return c},m.renamenx=function(a,b,c){var d=this,e=new h(function(){q&&clearTimeout(q),q=setTimeout(d.save.bind(d),5e3)});"undefined"==typeof c&&(c=n.noop);try{var f=function(a){e.reject(a),c(a)},g=null,i=null;m.exists(a).then(function(b){if(b)return m.get(a);var c=new Error("no such key");f(c)}).then(function(b){return g=p[a],i=b,m.del(a)}).then(function(){return m.set(b,i,c)}).then(function(){p[b]=g,e.resolve("OK"),c(null,"OK")}).fail(f)}catch(j){f(j)}return e},m.rename=function(a,b,c){var d=this,e=new h(function(){q&&clearTimeout(q),q=setTimeout(d.save.bind(d),5e3)}),f=function(a){e.reject(a),c(a)};return"undefined"==typeof c&&(c=n.noop),a==b?f(new Error("The key is equal to the new key.")):d.renamenx.apply(d,arguments).then(e.resolve.bind(e)).fail(e.reject.bind(e)),e},m.keys=function(a,b){var c=new h,d=Object.keys(p);b=b||n.noop;var e=a.replace("?","(.)").replace("*","(.*)");e=new RegExp(e);for(var f=[],g=0;g<d.length;g++)d[g].match(e)&&f.push(d[g]);return c.resolve(f),b(null,f),c},m.randomkey=function(a){var b=new h,c=Object.keys(p);"undefined"==typeof a&&(a=n.noop);var d=Math.round(Math.random()*(c.length-1)),e=c[d];return b.resolve(e),a(null,e),b},m.type=function(a,b){var c=new h;return b=b||n.noop,p.hasOwnProperty(a)?(c.resolve(r[p[a]]),b(null,b)):(c.resolve(null),b(null,null)),c},m.empty=function(a){var b=this,c=new h(function(a){b.emit("empty",a),q&&clearTimeout(q),q=setTimeout(b.save.bind(b),5e3)}),d=Object.keys(p),e=0;return a=a||n.noop,function f(g){g?b.del(g,function(a){a||e++,f(d.shift())}):(c.resolve(e),a(null,e))}(d.shift()),c},m.save=function(a){var b=this,c=new h(function(a,c){b.emit("save",a,c)});return a=a||n.noop,b.set("min_keys",JSON.stringify(p)).then(function(){return b.dump()}).then(function(b,d){c.resolve(b,d),a(b,d)}).fail(function(b){c.reject(b),a(b)}),c},m.dump=function(a){var b=this,c=new h;a=a||n.noop;var d={};return b.keys("*").then(function(e){!function f(g){if(g)b.get(g).then(function(a){d[g]=a,f(e.shift())}).fail(function(b){c.reject(b),a(b)});else{var h=JSON.stringify(d);c.resolve(d,h),a(null,d,h)}}(e.shift())}).fail(function(b){c.reject(b),a(b)}),c},m.restore=function(a,b){var c=this,d=new h(function(){c.save(function(){c.emit("restore")})});b=b||n.noop;var e=Object.keys(a);return function f(g,h){g?c.set(g,a[g]).then(function(){f(e.shift(),h)}).fail(function(a){d.reject(a),b(a)}):h()}(e.shift(),function(){c.exists("min_keys").then(function(a){return a?c.get("min_keys"):(d.resolve(),b(),void 0)}).then(function(a){p=JSON.parse(a),d.resolve(),b()})}),d},m.set=function(a,b,c){var d=this,e=new h(function(){q&&clearTimeout(q),q=setTimeout(d.save.bind(d),5e3)}),f=this.store;c=c||n.noop;var g="min-"+a;if(f.async){var i=JSON.stringify(b);f.set(g,i,function(d){return d?(e.reject(d),c(d)):(p[a]=0,e.resolve(a,b),c(null,a,b),void 0)})}else try{var i=JSON.stringify(b);f.set(g,i),p[a]=0,e.resolve(a,b),c(null,a,b)}catch(j){e.reject(j),c(j)}return this.emit("set",a,b),e},m.setnx=function(a,b,c){var d=new h,e=this;return c=c||n.noop,e.exists(a,function(f,g){return f&&(c(f),d.reject(f)),g?d.reject(new Error("The key is exists.")):(e.set(a,b,c).then(function(a,b){c(null,a,b),d.resolve(a,b)}).fail(function(a){c(a),d.reject(a)}),void 0)}),d},m.setex=function(a,b,c,d){function e(){g.del(a,n.noop)}var f=new h,g=this;return d=d||n.noop,g.set(a,c,function(a,c){setTimeout(e,1e3*b),d(a,c)}).then(function(a,c){setTimeout(e,1e3*b),f.resolve(a,c),d(null,a,c)}).fail(function(a){f.reject(a),d(a)}),f},m.psetex=function(a,b,c,d){function e(){g.del(a,n.noop)}var f=new h,g=this;return d=d||n.noop,g.set(a,c,function(a,c){setTimeout(e,b),d(a,c)}).then(function(){setTimeout(e,b),f.resolve.apply(f,arguments)}).fail(f.reject.bind(f)),f},m.mset=function(a,b){function c(b,e){delete g[e],f.set(b,a[b]).then(function(){j.push(arguments),i++,g[i]?c(g[i],i):d()}).fail(function(a){return k.push(a),i++,g[i]?c(g[i],i):d()})}function d(){k.length?(b(k),e.reject(k)):(b(null,j),e.resolve(j))}var e=new h,f=this,g=Object.keys(a),i=0,j=[],k=[];return b=b||n.noop,c(g[i],i),e},m.msetnx=function(a,b){function c(b,e){delete g[e],f.setnx(b,a[b]).then(function(){j.push(arguments),i++,g[i]?c(g[i],i):d()}).fail(function(a){k.push(a),d()})}function d(){return k.length?(b(k),e.reject(k)):(b(null,j),e.resolve(j),void 0)}var e=new h,f=this,g=Object.keys(a),i=0,j=[],k=[];return b=b||n.noop,c(g[i],i),e},m.append=function(a,b,c){var d=this,e=new h;return c=c||n.noop,d.exists(a).then(function(b){if(b)return d.get(a);var c=new h;return c.resolve(""),c}).then(function(c){return d.set(a,c+b)}).then(function(a){return d.strlen(a)}).then(function(a){e.resolve(a),c(null,a)}).fail(function(a){e.reject(a),c(a)}),e},m.get=function(a,b){var c=this,d=new h(function(b){c.emit("get",a,b)}),e=this.store;b=b||n.noop;var f="min-"+a;if(e.async)this.store.get(f,function(a,c){if(a){var e=new Error("no such key");return d.reject(e),b(e)}if(c){var f=JSON.parse(c);d.resolve(f),b(null,f)}else{var a=new Error("no such key");d.resolve(a),b(a)}});else try{var g=this.store.get(f);if(g){var i=JSON.parse(g);d.resolve(i),b(null,i)}else{var j=new Error("no such key");d.reject(j),b(j)}}catch(j){d.reject(j),b(j)}return d},m.getrange=function(a,b,c,d){var e=this,f=new h(function(d){e.emit("getrange",a,b,c,d)});d=d||n.noop;var g=c-b+1;return e.get(a).then(function(a){var c=a.substr(b,g);f.resolve(c),d(null,c)}).fail(function(a){f.reject(a),d(a)}),f},m.mget=function(a,b){function c(b,e){delete a[e],f.get(b,function(b,e){return b?(j.push(b),i.push(null),g++,a[g]?c(a[g],g):d()):(i.push(e),g++,a[g]?c(a[g],g):d(),void 0)})}function d(){j.length?e.reject(j):e.resolve(i)}var e=new h,f=this,g=0,i=[],j=[];return b=b||n.noop,c(a[g],g),e},m.getset=function(a,b,c){var d=this,e=new h(function(c){d.emit("getset",a,b,c)});"undefined"==typeof c&&(c=n.noop);var f=null;return d.get(a).then(function(c){return f=c,d.set(a,b)}).then(function(){e.resolve(f),c(null,f)}).fail(function(a){e.reject(a),c(a)}),e},m.strlen=function(a,b){var c=this,d=new h;return b=b||n.noop,c.get(a).then(function(a){if("string"==typeof a){var c=a.length;d.resolve(c),b(null,c)}else{var e=new TypeError;d.reject(e),b(e)}}).fail(function(a){d.reject(a),b(a)}),d},m.incr=function(a,b){var c=this,d=new h(function(b){c.emit("incr",a,b)});return b=b||n.noop,c.exists(a).then(function(b){if(b)return c.get(a);var d=new h;return d.resolve(0),d}).then(function(e){return isNaN(parseInt(e))?(d.reject("value wrong"),b("value wrong")):(e=parseInt(e),c.set(a,++e))}).then(function(a,c){d.resolve(c),b(null,c)}).fail(function(a){d.reject(a),b(a)}),d},m.incrby=function(a,b,c){var d=this,e=new h(function(b){d.emit("incrby",a,b)});return c=c||n.noop,d.exists(a).then(function(b){if(b)return d.get(a);var c=new h;return c.resolve(0),c}).then(function(f){return isNaN(parseFloat(f))?(e.reject("value wrong"),c("value wrong")):(f=parseFloat(f),d.set(a,f+b))}).then(function(a,b){e.resolve(b),c(null,b)}).fail(function(a){e.reject(a),c(a)}),e},m.incrbyfloat=m.incrby,m.decr=function(a,b){var c=this,d=new h(function(b){c.emit("decr",a,b)});return b=b||n.noop,c.exists(a).then(function(b){if(b)return c.get(a);var d=new h;return d.resolve(0),d}).then(function(e){return isNaN(parseInt(e))?(d.reject("value wrong"),b("value wrong")):(e=parseInt(e),c.set(a,--e))}).done(function(a,c){d.resolve(c),b(null,c)}).fail(function(a){d.reject(a),b(a)}),d},m.decrby=function(a,b,c){var d=this,e=new h(function(c){d.emit("decrby",a,b,c)});return c=c||n.noop,d.exists(a).then(function(b){if(b)return d.get(a);var c=new h;return c.resolve(0),c}).then(function(f){return isNaN(parseInt(f))?(e.reject("value wrong"),c("value wrong")):(f=parseInt(f),d.set(a,f-b))}).done(function(a,b){e.resolve(b),c(null,b)}).fail(function(a){e.reject(a),c(a)}),e},m.hset=function(a,b,c,d){var e=this,f=new h(function(){e.emit("hset",a,b,c)});return d=d||n.noop,e.exists(a,function(g,h){if(g)return f.reject(g),d(g);if(h)e.get(a,function(g,h){return g?(f.reject(g),d(g)):(h[b]=c,e.set(a,h,function(e){return e?(f.reject(e),d(e)):(f.resolve(a,b,c),d(null,a,b,c),void 0)}),void 0)});else{var i={};i[b]=c,e.set(a,i,function(e){return e?(f.reject(e),d(e)):(p[a]=1,f.resolve(a,b,c),d(null,a,b,c),void 0)})}}),f},m.hsetnx=function(a,b,c,d){var e=new h,f=this;return d=d||n.noop,f.hexists(a,b,function(g,h){if(g)return e.reject(g),d(g);if(h){var g=new Error("The field of the hash is exists");return e.reject(g),d(g)}f.hset(a,b,c,function(a){a&&(e.reject(a),d(a)),e.resolve("OK"),d(null,"OK")})}),e},m.hmset=function(a,b,c){var d=new h;c=c||n.noop;var e=Object.keys(b),f=m.multi();return e.forEach(function(c){f.hset(a,c,b[c])}),f.exec(function(a,b){c(null,b),d.resolve(b)}),d},m.hget=function(a,b,c){var d=new h,e=this;return c=c||n.noop,e.hexists(a,b,function(f,g){if(f)return d.reject(f),c(f);if(g)e.get(a).done(function(a){var e=a[b];d.resolve(e),c(null,e)}).fail(function(a){d.reject(a),c(a)});else{var f=new Error("no such field");d.reject(f),c(f)}}),d},m.hmget=function(a,b,c){var d=new h;c=c||n.noop;var e=[],f=m.multi();return b.forEach(function(b){f.hget(a,b)}),f.exec(function(a,b){return a?(c(a),d.reject(a)):(e=b.map(function(a){return a[0]}),d.resolve(e),c(null,e),void 0)}),d},m.hgetall=function(a,b){var c=new h,d=this;return b=b||n.noop,d.exists(a,function(e,f){if(e)return b(e),c.reject(e);if(!f){var e=new Error("no such key");return b(e),c.reject(e)}d.get(a).done(function(a){c.resolve(a),b(null,a)}).fail(function(){})}),c},m.hdel=function(a,b,c){var d=this,e=new h(function(a,b,c){d.emit("hdel",a,b,c)});return c=c||n.noop,d.hexists(a.field,function(f,g){if(f)return c(f),e.reject(f);if(!g){var f=new Error("no such key");return c(f),e.reject(f)}d.get(a).done(function(f){var g=f[b];delete f[b],d.set(a,f).done(function(){e.resolve(a,b,g),c(null,a,b,g)}).fail(function(a){e.reject(a),c(a)})}).fail(function(a){c(a)})}),e},m.hlen=function(a,b){var c=new h,d=this;return b=b||n.noop,d.exists(a,function(e,f){return e?(c.reject(e),b(e)):(f?d.get(a).done(function(a){var d=Object.keys(a).length;c.resolve(d),b(null,d)}).fail(function(a){c.reject(a),b(a)}):(c.resolve(0),b(null,0)),void 0)}),c},m.hkeys=function(a,b){var c=new h,d=this;return b=b||n.noop,d.exists(a,function(e,f){return e?(c.reject(e),b(e)):(f?d.get(a).done(function(a){var d=Object.keys(a);c.resolve(d),b(null,d)}).fail(function(a){c.reject(a),b(a)}):(c.resolve(0),b(null,0)),void 0)}),c},m.hexists=function(a,b,c){var d=new h,e=this;return c=c||n.noop,e.exists(a).then(function(b){return b?e.get(a):(d.resolve(!1),c(null,!1),void 0)}).then(function(a){a.hasOwnProperty(b)?(d.resolve(!0),c(null,!0)):(d.resolve(!1),c(null,!1))}).fail(function(a){d.reject(a),c(a)}),d},m.hincr=function(a,b,c){var d=this,e=new h(function(c){d.emit("hincr",a,b,c)});return c=c||n.noop,d.hexists(a,b).then(function(a){if(a)return d.hget(a);var b=new h;return b.resolve(0),b}).then(function(f){return isNaN(parseFloat(f))?(e.reject("value wrong"),c("value wrong")):(f=parseFloat(f),d.hset(a,b,++f))}).then(function(a,b,d){e.resolve(d),c(null,d)}).fail(function(a){e.reject(a),c(null,a)}),e},m.hincrby=function(a,b,c,d){var e=this,f=new h(function(c){e.emit("hincr",a,b,c)});return d=d||n.noop,e.hexists(a,b).then(function(a){if(a)return e.hget(a);var b=new h;return b.resolve(0),b}).then(function(g){return isNaN(parseFloat(g))?(f.reject("value wrong"),d("value wrong")):(g=parseFloat(g),e.hset(a,b,g+c))}).then(function(a,b,c){f.resolve(c),d(null,c)}).fail(function(a){f.reject(a),d(null,a)}),f},m.hincrbyfloat=m.hincrby,m.hdecr=function(a,b,c){var d=this,e=new h(function(c){d.emit("hdecr",a,b,c)});return c=c||n.noop,d.hexists(a,b).then(function(c){if(c)return d.hget(a,b);var e=new h;return e.resolve(0),e}).then(function(f){return isNaN(parseFloat(f))?(e.reject("value wrong"),c("value wrong")):(f=parseFloat(f),d.hset(a,b,--f))}).then(function(a,b,d){e.resolve(d),c(null,d)}).fail(function(a){e.reject(a),c(a)}),e},m.hdecrby=function(a,b,c,d){var e=this,f=new h(function(c){e.emit("hincr",a,b,c)});return d=d||n.noop,e.hexists(a,b).then(function(a){if(a)return e.hget(a);var b=new h;return b.resolve(0),b}).then(function(g){return isNaN(parseFloat(g))?(f.reject("value wrong"),d("value wrong")):(g=parseFloat(g),e.hset(a,b,g-c))}).then(function(a,b,c){f.resolve(c),d(null,c)}).fail(function(a){f.reject(a),d(null,a)}),f},m.lpush=function(a,b,c){var d=this,e=new h(function(b){d.emit("lpush",a,b)});return c=c||n.noop,d.exists(a,function(f,g){if(f)return e.reject(f),c(f);if(g)d.get(a,function(f,g){return f?(e.reject(f),c(f)):(g.unshift(b),d.set(a,g,function(a){if(a)return e.reject(a),c(a);var b=g.length;e.resolve(b),c(null,b)}),void 0)});else{var h=[b];d.set(a,h,function(b){return b?(e.reject(b),c(b)):(p[a]=2,e.resolve(1),c(null,1),void 0)})}}),e},m.lpushx=function(a,b,c){var d=new h;c=c||n.noop;var e=this;return e.exists(a,function(f,g){if(f)return d.reject(f),c(f);if(!g){var f=new Error("no such key");return c(f),d.reject(f)}e.get(a,function(f,g){if(f)return d.reject(f),c(f);if(!g.length){var f=new Error("The list is empty.");return c(f),d.reject(f)}g.unshift(b),e.set(a,g,function(a){if(a)return d.reject(a),c(a);var b=g.length;d.resolve(b),c(null,b)})})}),d},m.rpush=function(a,b,c){var d=this,e=new h(function(b){d.emit("rpush",a,b)});return c=c||n.noop,d.exists(a,function(f,g){if(f)return e.reject(f),c(f);if(g)d.get(a,function(f,g){return f?(e.reject(f),c(f)):(g.push(b),d.set(a,g,function(a){if(a)return e.reject(a),c(a);var b=g.length;e.resolve(b),c(null,b)}),void 0)});else{var h=[b];d.set(a,h,function(a){return a?(e.reject(a),c(a)):(e.resolve(1),c(null,1),void 0)})}}),e},m.lpushx=function(a,b,c){var d=new h;c=c||n.noop;var e=this;return e.exists(a,function(f,g){if(f)return d.reject(f),c(f);if(!g){var f=new Error("no such key");return c(f),d.reject(f)}e.get(a,function(f,g){if(f)return d.reject(f),c(f);if(!g.length){var f=new Error("The list is empty.");return c(f),d.reject(f)}g.push(b),e.set(a,g,function(a){if(a)return d.reject(a),c(a);var b=g.length;d.resolve(b),c(null,b)})})}),d},m.lpop=function(a,b){var c=this,d=new h(function(b){c.emit("lpop",a,b)});b=b||n.noop;var e=null;return c.exists(a).then(function(e){return e?c.get(a):(d.resolve(null),b(null,null),void 0)}).then(function(b){return e=b.shift(),c.set(a,b)}).then(function(){d.resolve(e),b(null,e)}).fail(function(a){d.reject(a),b(a)}),d},m.rpop=function(a,b){var c=this,d=new h(function(b){c.emit("rpop",a,b)});b=b||n.noop;var e=null;return c.exists(a).then(function(e){return e?c.get(a):(d.resolve(null),b(null,null),void 0)}).then(function(b){return e=b.pop(),c.set(a,b)}).then(function(){d.resolve(e),b(null,e)}).fail(function(a){d.reject(a),b(a)}),d},m.llen=function(a,b){var c=new h;b=b||n.noop;var d=this;return d.exists(a,function(e,f){return e?(c.reject(e),b(e)):(f?d.get(a,function(a,d){if(a)return c.reject(a),b(a);var e=d.length;c.resolve(e),b(null,e)}):(c.resolve(0),b(null,0)),void 0)}),c},m.lrange=function(a,b,c,d){var e=new h;d=d||n.noop;var f=this;return f.exists(a,function(g,h){return g?(e.reject(g),d(g)):(h?f.get(a,function(a,f){if(a)return e.reject(a),d(a);var g=f.slice(b,c+1);e.resolve(g),d(null,g)}):(e.resolve(null),d(null,null)),void 0)}),e},m.lrem=function(a,b,c,d){var e=this,f=new h(function(b){e.emit("lrem",a,b)});return d=d||n.noop,e.exists(a,function(g,h){return g?(f.reject(g),d(g)):(h?e.get(a,function(a,e){if(a)return f.reject(a),d(a);var g=0;switch(!0){case b>0:for(var h=0;h<e.length&&b>g;h++)if(e[h]===c){{e.splice(h,1)[0]}g++}break;case 0>b:for(var h=e.length-1;h>=0&&b>g;h--)if(e[h]===c){{e.splice(h,1)[0]}g++}break;case b=0:for(var h=e.length-1;h>=0;h--)if(e[h]===c){{e.splice(h,1)[0]}g++}}f.resolve(g),d(null,g)}):(f.resolve(null),d(null,null)),void 0)}),f},m.lset=function(a,b,c,d){var e=this,f=new h(function(b){e.emit("lset",a,b)});return d=d||n.noop,e.exists(a,function(g,h){if(g)return f.reject(g),d(g);if(!h){var g=new Error("no such key");return f.reject(g),d(g)}e.get(a,function(g,h){if(g)return f.reject(g),d(g);if(!h[b]||!h.length){var g=new Error("no such key");return f.reject(g),d(g)}h[b]=c,e.set(a,h,function(a){if(a)return f.reject(a),d(a);var b=h.length;f.resolve(b),d(null,b)})})}),f},m.ltrim=function(a,b,c,d){var e=new h,f=this;return d=d||n.noop,f.exists(a,function(g,h){return g?(e.reject(g),d(g)):(h?f.get(a,function(a,f){if(a)return e.reject(a),d(a);var g=f.splice(b,c+1);e.resolve(g),d(null,g)}):(e.resolve(null),d(null,null)),void 0)}),e},m.lindex=function(a,b,c){var d=new h,e=this;return c=c||n.noop,e.exists(a,function(f,g){return f?(d.reject(f),c(f)):(g?e.get(a,function(a,e){if(a)return d.reject(a),c(a);var f=e[b];d.resolve(f),c(null,f)}):(d.resolve(null),c(null,null)),void 0)}),d},m.linsertBefore=function(a,b,c,d){var e=new h,f=this;return d=d||n.noop,f.exists(a,function(g,h){return g?(e.reject(g),d(g)):(h?f.get(a,function(g,h){if(g)return e.reject(g),d(g);var i=h.indexOf(b);return 0>i?(e.resolve(null),d(null,null)):(h.splice(i,1,c,b),f.set(a,h,function(a){if(a)return e.reject(a),d(a);var b=h.length;e.resolve(b),d(null,b)}),void 0)}):(e.resolve(null),d(null,null)),void 0)}),e},m.linsertAfter=function(a,b,c,d){var e=new h,f=this;return d=d||n.noop,f.exists(a,function(g,h){return g?(e.reject(g),d(g)):(h?f.get(a,function(g,h){if(g)return e.reject(g),d(g);var i=h.indexOf(b);return 0>i?(e.resolve(null),d(null,null)):(h.splice(i,0,c),f.set(a,h,function(a){if(a)return e.reject(a),d(a);var b=h.length;e.resolve(b),d(null,b)}),void 0)}):(e.resolve(null),d(null,null)),void 0)}),e},m.rpoplpush=function(a,b,c){var d=new h,e=this;return c=c||n.noop,e.rpop(a).then(function(a){return e.lpush(b,a)}).then(function(a){d.resolve(value,a),c(null,value,a)}).fail(function(a){c(a),d.reject(a)}),d},m.sadd=function(a,b){var c=this,d=new h(function(b){c.emit("sadd",a,b)});b=Array.isArray(b)?b:[].slice.call(arguments,1);var e=0;if(b[b.length-1]instanceof Function)var f=b.splice(b.length-1,1)[0];else var f=n.noop;return c.exists(a).then(function(d){if(d)return c.get(a);var e=n.arrayUnique(b);return c.set(a,e)}).then(function(){if(Array.isArray(arguments[0])){for(var g=arguments[0],h=0;h<b.length;h++)!function(a){var c=b[a];g.indexOf(c)>=0||(g.push(c),e++)}(h);return c.set(a,g)}"string"==typeof arguments[0]&&(e+=b.length,p[a]=3,d.resolve(e),f(null,e))}).then(function(){p[a]=3,d.resolve(e),f(null,e)}).fail(function(a){d.reject(a),f(a)}),d},m.srem=function(a,b,c){var d=this,e=new h(function(b){d.emit("srem",a,b)});b=[].slice.call(arguments,1);var f=0;return b[b.length-1]instanceof Function||(c=n.noop),d.exists(a).then(function(b){return b?d.get(a):new Error("no such key")}).then(function(c){for(var e=0;e<b.length;e++)!function(a){var d=b[a],e=c.indexOf(d);e>=0&&(c.splice(e,1),f++)}(e);return d.set(a,c)}).then(function(){p[a]=3,e.resolve(f),c(null,f)}).fail(function(a){e.reject(a),c(a)}),e},m.smembers=function(a,b){var c=new h,d=this;return b=b||n.noop,d.exists(a).then(function(b){return b?d.get(a):new Error("no such key")}).then(function(a){c.resolve(a),b(null,a)}).fail(function(a){c.reject(a),b(a)}),c},m.sismember=function(a,b,c){var d=this,e=new h;return d.exists(a).then(function(b){return b?d.get(a):new Error("no such key")}).then(function(a){var d=a.indexOf(b)>=0?1:0;e.resolve(d),c(null,d)}).fail(function(a){e.reject(a),c(a)}),e},m.scard=function(a,b){var c=new h;b=b||n.noop;var d=this;return d.exists(a).then(function(b){return b?d.get(a):new Error("no such key")}).then(function(a){var d=a.length;c.resolve(d),b(null,d)}).fail(function(a){c.reject(a),b(a)}),c},m.smove=function(a,b,c,d){var e=this,f=new h(function(d){e.emit("smove",a,b,c,d)});return members=[].slice.call(arguments,1),members[members.length-1]instanceof Function||(d=n.noop),e.exists(key).then(function(b){return b?e.sismember(a,c):new Error("no such key")}).then(function(b){return b?e.srem(a,c):new Error("no such member")}).then(function(){return e.sismember(b,c)}).then(function(a){return a?(p[key]=3,f.resolve(0),d(null,0),void 0):e.sadd(b,c)}).then(function(){p[key]=3,f.resolve(1),d(null,1)}).fail(function(a){f.reject(a),d(a)}),f},m.srandmember=function(a,b){var c=new h,d=this;return b=b||n.noop,d.exists(a).then(function(e){return e?d.get(a):(c.resolve(null),b(null,null),void 0)}).then(function(a){var d=Math.random()*a.length|0,e=a[d];c.resolve(e),b(null,e)}).fail(function(a){c.reject(a),b(a)}),c},m.spop=function(a,b){var c=this,d=new h(function(b){c.emit("spop",a,b)});b=b||n.noop;var e=null;return c.exists(a).then(function(e){return e?c.srandmember(a):(d.resolve(null),b(null,null),void 0)}).then(function(b){return e=b,c.srem(a,e)}).then(function(){d.resolve(e),b(null,e)}).fail(function(a){d.reject(a),b(a)}),d},m.sunion=function(a,b){var c=new h,d=this;a=[].slice.call(arguments),a[a.length-1]instanceof Function||(b=n.noop);var e=[];return function f(g){var h=a[g];h?d.exists(h).then(function(a){return a?d.get(h):(f(++g),void 0)}).then(function(a){Array.isArray(a)&&(e=e.concat(a)),f(++g)}).fail(function(a){return c.reject(a),b(a)}):(e=n.arrayUnique(e),c.resolve(e),b(null,e))}(0),c},m.sunionstore=function(a,b,c){var d=new h,e=this;b=[].slice.call(arguments,2),b[b.length-1]instanceof Function||(c=n.noop);var f=null;return e.sunion(b).then(function(b){return f=b,e.exists(a)}).then(function(b){return b?e.del(a):e.sadd(a,f)}).then(function(b){return"number"!=typeof b?e.sadd(a,f):(d.resolve(b,f),c(null,b,f),void 0)}).then(function(a){d.resolve(a,f),c(null,a,f)}).fail(function(a){d.reject(a),c(a)}),d},m.sinter=function(a,b){var c=new h,d=this;a=[].slice.call(arguments),a[a.length-1]instanceof Function||(b=n.noop);var e=[];return function f(g){var h=a[g];if(h)d.exists(h).then(function(a){return a?d.get(h):(f(++g),void 0)}).then(function(a){Array.isArray(a)&&e.push(a),f(++g)}).fail(function(a){return c.reject(a),b(a)});else{var i=n.arrayInter.apply(n,e);c.resolve(i),b(null,i)}}(0),c},m.sinterstore=function(a,b,c){var d=new h,e=this;b=[].slice.call(arguments,1),b[b.length-1]instanceof Function||(c=n.noop);var f=null;return e.sinter.apply(e,b).then(function(b){return f=b,e.exists(a)}).then(function(b){return b?e.del(a):(f.unshift(a),e.sadd.apply(e,f))}).then(function(b){return"string"!=typeof b?e.sadd(a,f):(d.resolve(f.length,f),c(null,f.length,f),void 0)}).then(function(){d.resolve(f.length,f),c(null,f.length,f)}).fail(function(a){d.reject(a),c(a)}),d},m.sdiff=function(a,b){var c=new h,d=this;a=[].slice.call(arguments,1),a[a.length-1]instanceof Function||(b=n.noop);var e=[];return function f(g){var h=a[g];if(h)d.exists(h).then(function(a){return a?d.get(h):(f(++g),void 0)}).then(function(a){Array.isArray(a)&&e.push(a),f(++g)}).fail(function(a){return c.reject(a),b(a)});else{var i=n.arrayDiff.apply(n,e);c.resolve(i),b(null,i)}}(0),c},m.sdiffstore=function(a,b,c){var d=new h,e=this;b=[].slice.call(arguments,2),b[b.length-1]instanceof Function||(c=n.noop);var f=null;return e.sdiff(b).then(function(b){return f=b,e.exists(a)}).then(function(b){return b?e.del(a):e.sadd(a,f)}).then(function(b){return"number"!=typeof b?e.sadd(a,f):(d.resolve(b,f),c(null,b,f),void 0)}).then(function(a){d.resolve(a,f),c(null,a,f)}).fail(function(a){d.reject(a),c(a)}),d},m.zadd=function(a,b,c,d){var e=this,f=new h(function(a){e.emit("zadd",a)});return d=d||n.noop,e.exists(a).then(function(d){if(d)return e.get(a);var f={};return f[b]=[0],e.set(a,{ms:[c],hsm:{0:b},shm:f})
}).then(function(g){if("string"==typeof g)p[a]=4,f.resolve(1,1),d(null,1,1);else if("object"==typeof g){var h=g;if(h.ms.indexOf(c)>=0){var i=h.ms.length;return f.resolve(0,i),d(null,0,i)}var j=h.ms.length;return h.ms.push(c),h.hsm[j]=b,Array.isArray(h.shm[b])?h.shm[b].push(j):h.shm[b]=[j],e.set(a,h)}}).then(function(a,b){p[a]=4;var c=b.ms.length;f.resolve(1,c),d(null,1,c)}).fail(function(a){f.reject(a),d(a)}),f},m.zcard=function(a,b){var c=this,d=new h;return b=b||n.noop,c.exists(a).then(function(e){if(e)return c.get(a);var f=new Error("no such key");d.reject(f),b(f)}).then(function(a){var c=a.ms.filter(Boolean).length;d.resolve(c),b(null,c)}).fail(function(a){d.reject(a),b(a)}),d},m.zcount=function(a,b,c,d){var e=this,f=new h(function(a){e.emit(a)});return d=d||n.noop,e.exists(a).then(function(b){if(b)return e.get(a);var c=new Error("no such key");f.reject(c),d(c)}).then(function(a){var e=Object.keys(a.shm).filter(function(a){return a>=b&&c>=a}).map(function(b){return a.shm[b]}),g=0;e.forEach(function(a){g+=a.length}),f.resolve(g),d(null,g)}).fail(function(a){f.reject(a),d(a)}),f},m.zrem=function(a){var b=this,c=new h(function(a){b.emit("zrem",a)}),d=arguments[arguments.length-1],e=[].slice.call(arguments,1);"function"!=typeof d?d=n.noop:e.pop();var f=0;return b.exists(a).then(function(e){if(e)return b.get(a);var f=new Error("no such key");c.reject(f),d(f)}).then(function(a){for(var b=e.length,c=new h,d=0;d<e.length;d++)!function(d){var g=a.ms.indexOf(e[d]);if(g>=0){a.ms[g]=0;var h=a.hsm[g];delete a.hsm[g];var i=a.shm[h].indexOf(g);i>=0&&a.shm[h].splice(i,1),f++,--b||c.resolve(a)}else b--}(d);return c}).then(function(c){return b.set(a,c)}).then(function(){c.resolve(f),d(null,f)}).fail(function(a){c.reject(a),d(null,a)}),c},m.zscore=function(a,b,c){var d=this,e=new h;return c=c||n.noop,d.exists(a).then(function(b){if(b)return d.get(a);var f=new Error("no such key");e.reject(f),c(f)}).then(function(a){var d=a.ms.indexOf(b);if(d>=0){var f=a.hsm[d];e.resolve(f),c(null,f)}else{var g=new Error("This member does not be in the set");e.reject(g),c(g)}}),e},m.zrange=function(a,b,c,d){var e=this,f=new h(function(a){e.emit(a)});return d=d||n.noop,e.exists(a).then(function(b){if(b)return e.get(a);var c=new Error("no such key");f.reject(c),d(c)}).then(function(a){var e=Object.keys(a.shm).filter(function(a){return a>=b&&c>=a}).map(function(b){return a.shm[b]}),g=[];e.forEach(function(b){g=g.concat(b.map(function(b){return a.ms[b]}))}),f.resolve(g),d(null,g)}).fail(function(a){f.reject(a),d(a)}),f.withScore=function(b){var c=new h;return b=b||n.noop,f.then(function(d){var f=e.multi();d.forEach(function(b){f.zscore(a,b)}),f.exec(function(a,e){if(a)return b(a),c.reject(a);var f=[];e.forEach(function(a,b){f.push({member:d[b],score:a[0]})}),c.resolve(f),b(null,f)})}),c},f},m.zrevrange=function(a,b,c,d){var e=this,f=new h(function(a){e.emit(a)});return d=d||n.noop,e.exists(a).then(function(b){if(b)return e.get(a);var c=new Error("no such key");f.reject(c),d(c)}).then(function(a){var e=Object.keys(a.shm).reverse().filter(function(a){return a>=b&&c>=a}).map(function(b){return a.shm[b]}),g=[];e.forEach(function(b){g=g.concat(b.map(function(b){return a.ms[b]}))}),f.resolve(g),d(null,g)}).fail(function(a){f.reject(a),d(a)}),f.withScore=function(b){var c=new h;return b=b||n.noop,f.then(function(d){var f=e.multi();d.forEach(function(b){f.zscore(a,b)}),f.exec(function(a,e){if(a)return b(a),c.reject(a);var f=[];e.forEach(function(a,b){f.push({member:d[b],score:a[0]})}),c.resolve(f),b(null,f)})}),c},f},m.zincrby=function(a,b,c,d){var e=this,f=new h(function(d){e.emit("zincrby",a,b,c,d)});d=d||n.noop;var g=null;return e.exists(a).then(function(g){return g?e.zscore(a,c):(e.zadd(a,b,c,d).then(f.resolve.bind(f)).fail(f.reject.bind(f)),void 0)}).then(function(){return e.get(a)}).then(function(d){var f=d.ms.indexOf(c),h=d.hsm[f];g=h+b;var i=d.shm[h].indexOf(f);return d.shm[h].splice(i,1),d.hsm[f]=g,d.shm[g]?d.shm[g].push(f):d.shm[g]=[f],e.set(a,d)}).then(function(){f.resolve(g),d(null,g)}).fail(function(a){f.reject(a),d(a)}),f},m.zdecrby=function(a,b,c,d){var e=this,f=new h(function(d){e.emit("zdecrby",a,b,c,d)});d=d||n.noop;var g=null;return e.exists(a).then(function(b){if(b)return e.zscore(a,c);var g=new Error("no such key");return f.reject(g),d(g)}).then(function(){return e.get(a)}).then(function(d){var f=d.ms.indexOf(c),h=d.hsm[f];g=h-b;var i=d.shm[h].indexOf(f);return d.shm[h].splice(i,1),d.hsm[f]=g,d.shm[g]?d.shm[g].push(f):d.shm[g]=[f],e.set(a,d)}).then(function(){f.resolve(g),d(null,g)}).fail(function(a){f.reject(a),d(a)}),f},m.zrank=function(a,b,c){var d=this,e=new h;return c=c||n.noop,d.exists(a).then(function(b){if(b)return d.get(a);var f=new Error("no such key");return e.reject(f),c(f)}).then(function(a){var d=Object.keys(a.shm),f=a.hsm[a.ms.indexOf(b)],g=d.indexOf(f);e.resolve(g),c(null,g)}).fail(function(a){e.reject(a),c(a)}),e},m.zrevrank=function(a,b,c){var d=this,e=new h;return c=c||n.noop,d.exists(a).then(function(b){if(b)return d.get(a);var f=new Error("no such key");return e.reject(f),c(f)}).then(function(a){var d=Object.keys(a.shm),f=a.hsm[a.ms.indexOf(b)],g=d.reverse().indexOf(f);e.resolve(g),c(null,g)}).fail(function(a){e.reject(a),c(a)}),e},j.prototype.exec=function(a){var b=this,c=[];!function d(e){e?b.min[e.method].apply(b.min,e.args).then(function(){c.push(arguments),d(b.queue.shift())}).fail(function(b){a(b,c)}):a(null,c)}(b.queue.shift())},m.multi=function(){return new j(this)},k.prototype.by=function(a,b){var c=this;b=b||n.noop;var d={},e=[],f=null;if(a.indexOf("->")>0){var g=a.indexOf("->");f=a.substr(g+2),a=a.substr(0,a.length-g)}return c.min.keys(a).then(function(b){for(var f=new RegExp(a.replace("?","(.)").replace("*","(.*)")),g=0;g<b.length;g++){var h=f.exec(b[g])[1];c.result.indexOf(h)>=0&&(d[b[g]]=h)}return e=Object.keys(d),c.min.mget(e.slice())}).then(function(a){for(var f={},g=0;g<a.length;g++)f[JSON.stringify(a[g])]=e[g];a.sort(c.sortFn);var h=a.map(function(a){return f[JSON.stringify(a)]}).map(function(a){return d[a]});c.result=h,c.promise.resolve(h),b(null,h)}).fail(function(a){c.promise.reject(a),b(a),c.callback(a)}),this},k.prototype.asc=function(a){var b=this;a=a||n.noop,b.sortFn=function(a,b){return n.isNumber(a)&&n.isNumber(b)?a-b:JSON.stringify(a)>JSON.stringify(b)};var c=function(c){b.result=c.sort(b.sortFn),b.promise.resolve(b.result),a(null,b.result)};return b.promise.ended?c(b.result):b.promise.once("resolve",c),b},k.prototype.desc=function(a){var b=this;a=a||n.noop,b.sortFn=function(a,b){return n.isNumber(a)&&n.isNumber(b)?b-a:JSON.stringify(a)<JSON.stringify(b)};var c=function(c){b.result=c.sort(b.sortFn),b.promise.resolve(b.result),a(null,b.result)};return b.promise.ended?c(b.result):b.promise.once("resolve",c),b},k.prototype.get=function(a,b){var c=this;b=b||n.noop;var d=function(d){var e=[];!function f(d){var g=d.shift();if(n.isUndefined(g))c.result=e,c.promise.resolve(e),b(null,e);else if(Array.isArray(g)){var h=c.keys[g[0]];c.min.get(a.replace("*",h)).then(function(a){g.push(a),e.push(g),f(d)}).fail(function(a){c.promise.reject(a),b(a)})}else if(g.substr||n.isNumber(g)){var h=c.keys[g];c.min.get(a.replace("*",h)).then(function(a){e.push([a]),a.substr||n.isNumber(a)?c.keys[a]=h:c.keys[JSON.stringify(a)]=h,f(d)}).fail(function(a){c.promise.reject(a),b(a)})}}(d.slice())};return c.promise.ended?d(c.result):c.promise.once("resolve",d),this},k.prototype.hget=function(a,b,c){c=c||n.noop;var d=this,e=function(e){var f=[];!function g(e){var h=e.shift();if(n.isUndefined(h))d.result=f,d.promise.resolve(f),c(null,f);else if(Array.isArray(h)){var i=d.keys[h[0]];d.min.hget(a.replace("*",i),b).then(function(a){h.push(a),f.push(h),g(e)}).fail(function(a){d.promise.reject(a),c(a)})}else if(h.substr||n.isNumber(h)){var i=d.keys[h];d.min.hget(a.replace("*",i)).then(function(a){f.push([a]),a.substr||n.isNumber(a)?d.keys[a]=i:d.keys[JSON.stringify(a)]=i,g(e)}).fail(function(a){d.promise.reject(a),c(a)})}}(e.slice())};return d.promise.ended?e(d.result):d.promise.once("resolve",e),this},k.prototype.limit=function(a,b,c){c=c||n.noop;var d=this,e=function(e){d.result=e.splice(a,b),d.promise.resolve(d.result),c(null,d.result)};return d.promise.ended?e(d.result):d.promise.once("resolve",e),this},k.prototype.flatten=function(a){a=a||n.noop;var b=this;if(b.promise.ended){for(var c=[],d=0;d<b.result.length;d++)for(var e=0;e<b.result[d].length;e++)c.push(b.result[d][e]);b.result=c,b.promise.resolve(c),a(null,c)}else b.promise.once("resolve",function(c){for(var d=[],e=0;e<c.length;e++)for(var f=0;f<c[e].length;f++)d.push(c[e][f]);b.result=d,b.promise.resolve(d),a(null,d)});return this},k.prototype.store=function(a,b){var c=this;return b=b||n.noop,c.promise.ended?c.min.set(a,c.result).then(function(){c.promise.resolve(c.result),b(null,c.result)}).fail(function(a){c.promise.reject(a),b(a)}):c.promise.once("resolve",function(d){c.min.set(a,d).then(function(){c.promise.resolve(d),b(null,d)}).fail(function(a){c.promise.reject(a),b(a)})}),this},m.sort=function(a,b){return b=b||n.noop,new k(a,this,b)},l.prototype.scan=function(a){var b=this,c=[];return b.parent.get("min_keys").then(function(d){d=JSON.parse(d);var e=Object.keys(d);!function f(d){var g=e[d];if(g&&b.pattern.test(g)&&"min_keys"!==g){if(c.push(g),++b.end-b.cursor>=b.limit)return a(null,c,b.end)}else if(!g)return b.end=0,a(null,c,b.end);return f(++d)}(b.cursor)},function(b){a(b)}),this},l.prototype.match=function(a,b){return this.pattern=new RegExp(a.replace("*","(.*)")),this.end=this.cursor,this.scan(b||n.noop)},l.prototype.count=function(a,b){return this.limit=a,this.end=this.cursor,this.scan(b||n.noop)},m.scan=function(a,b){var c=this;b=b||n.noop;var d=new l(a,null,-1,c);return d.scan(b),d},m.exists("min_keys").then(function(a){return a?m.get("min_keys"):void 0}).then(function(a){p=JSON.parse(a)}),m});
//# sourceMappingURL=min.js.source