Ink.createModule("Ink.UI.LazyLoad","1",["Ink.UI.Common_1","Ink.Dom.Event_1","Ink.Dom.Element_1"],function(t,o,e){"use strict";var n=function(t,o){this._init(t,o)};return n.prototype={_init:function(o){this._rootElm=t.elsOrSelector(o,"Ink.UI.LazyLoad root element")[0]||null,this._options=t.options({item:["String",".lazyload-item"],placeholder:["String",null],source:["String","data-src"],destination:["String","src"],delay:["Number",100],delta:["Number",0],image:["Boolean",!0],scrollElement:["Element",window],touchEvents:["Boolean",!0],onInsideViewport:["Function",!1],onAfterAttributeChange:["Function",!1],autoInit:["Boolean",!0]},arguments[1]||{},this._rootElm),this._aData=[],this._hasEvents=!1,this._options.autoInit&&this._activate()},_activate:function(){this._getData(),this._hasEvents||this._addEvents(),this._onScrollThrottled()},_getData:function(){for(var t=Ink.ss(this._options.item),o=null,n=0,i=t.length;i>n;n++)null==this._options.placeholder||e.hasAttribute(t[n],this._options.destination)||t[n].setAttribute(this._options.destination,this._options.placeholder),o=t[n].getAttribute(this._options.source),null===o&&this._options.image||this._aData.push({elm:t[n],original:o})},_addEvents:function(){this._onScrollThrottled=o.throttle(Ink.bindEvent(this._onScroll,this),this._options.delay),"ontouchmove"in document.documentElement&&this._options.touchEvents&&o.observe(document.documentElement,"touchmove",this._onScrollThrottled),o.observe(this._options.scrollElement,"scroll",this._onScrollThrottled),this._hasEvents=!0},_removeEvents:function(){"ontouchmove"in document.documentElement&&this._options.touchEvents&&o.stopObserving(document.documentElement,"touchmove",this._onScrollThrottled),o.stopObserving(this._options.scrollElement,"scroll",this._onScrollThrottled),this._hasEvents=!1},_onScroll:function(){for(var t,o=0;o<this._aData.length;o++)t=this._aData[o],e.inViewport(t.elm,{partial:!0,margin:this._options.delta})&&(this._elInViewport(t),this._options.image&&(this._aData.splice(o,1),o-=1));0===this._aData.length&&this._removeEvents()},_elInViewport:function(t){this._userCallback("onInsideViewport",{element:t.elm}),this._options.image&&(t.elm.setAttribute(this._options.destination,t.original),t.elm.removeAttribute(this._options.source)),this._userCallback("onAfterAttributeChange",{element:t.elm})},_userCallback:function(t){"function"==typeof this._options[t]&&this._options[t].apply(this,[].slice.call(arguments,1))},reload:function(){this._activate()},destroy:function(){this._hasEvents&&this._removeEvents(),t.destroyComponent.call(this)}},n});