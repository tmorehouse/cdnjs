Ink.createModule("Ink.UI.Droppable","1",["Ink.Dom.Element_1","Ink.Dom.Event_1","Ink.Dom.Css_1","Ink.UI.Common_1","Ink.Util.Array_1","Ink.Dom.Selector_1"],function(e,o,n,t,r,a){"use strict";var i=function(e){return function(o){return n.addClassName(e,o)}},s=function(e){return function(o){return n.removeClassName(e,o)}},p={debug:!1,_droppables:[],_draggables:[],add:function(o,n){function r(e){e.style.position="inherit"}o=t.elOrSelector(o,"Droppable.add target element");var a=Ink.extendObj({hoverClass:n.hoverclass||!1,accept:!1,onHover:!1,onDrop:!1,onDropOut:!1},n||{},e.data(o));"string"==typeof a.hoverClass&&(a.hoverClass=a.hoverClass.split(/\s+/));var i,s=this,p={move:function(e,o){r(e),o.appendChild(e)},copy:function(e,o){r(e),o.appendChild(e.cloneNode)},revert:function(e){s._findDraggable(e).originalParent.appendChild(e),r(e)}};if("string"==typeof a.onHover&&(i=a.onHover,a.onHover=p[i],void 0===a.onHover))throw new Error("Unknown hover event handler: "+i);if("string"==typeof a.onDrop&&(i=a.onDrop,a.onDrop=p[i],void 0===a.onDrop))throw new Error("Unknown drop event handler: "+i);if("string"==typeof a.onDropOut&&(i=a.onDropOut,a.onDropOut=p[i],void 0===a.onDropOut))throw new Error("Unknown dropOut event handler: "+i);var l={element:o,data:{},options:a};this._droppables.push(l),this._update(l)},_findData:function(e){for(var o=this._droppables,n=0,t=o.length;t>n;n++)if(o[n].element===e)return o[n]},_findDraggable:function(e){for(var o=this._draggables,n=0,t=o.length;t>n;n++)if(o[n].element===e)return o[n]},updateAll:function(){r.each(this._droppables,p._update)},update:function(e){this._update(this._findData(e))},_update:function(o){var n=o.data,t=o.element;n.left=e.offsetLeft(t),n.top=e.offsetTop(t),n.right=n.left+e.elementWidth(t),n.bottom=n.top+e.elementHeight(t)},remove:function(e){e=t.elOrSelector(e);for(var o=this._droppables.length,n=0;o>n;n++)if(this._droppables[n].element===e){this._droppables.splice(n,1);break}return o!==this._droppables.length},action:function(e,o,n,t){r.each(this._droppables,Ink.bind(function(p){var l=p.data,d=p.options,h=p.element;(!d.accept||a.matches(d.accept,[t]).length)&&("drag"!==o||this._findDraggable(t)||this._draggables.push({element:t,originalParent:t.parentNode}),e.x>=l.left&&e.x<=l.right&&e.y>=l.top&&e.y<=l.bottom?"drag"===o?(d.hoverClass&&r.each(d.hoverClass,i(h)),d.onHover&&d.onHover(t,h)):"drop"===o&&(d.hoverClass&&r.each(d.hoverClass,s(h)),d.onDrop&&d.onDrop(t,h,n)):"drag"===o&&d.hoverClass?r.each(d.hoverClass,s(h)):"drop"===o&&d.onDropOut&&d.onDropOut(t,h,n))},this))}};return p});