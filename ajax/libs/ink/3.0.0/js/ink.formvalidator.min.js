Ink.createModule("Ink.UI.FormValidator","1",["Ink.Dom.Element_1","Ink.Dom.Css_1","Ink.Util.Validator_1","Ink.Dom.Selector_1"],function(e,r,n,i){"use strict";function t(e){if(!e.name)return[];if(!e.form)return i.select('name="'+e.name+'"');var r=e.form[e.name];return"undefined"==typeof r.length&&(r=[r]),r}var s={version:"1",_flagMap:{"ink-fv-required":{msg:"Required field"},"ink-fv-email":{msg:"Invalid e-mail address"},"ink-fv-url":{msg:"Invalid URL"},"ink-fv-number":{msg:"Invalid number"},"ink-fv-phone_pt":{msg:"Invalid phone number"},"ink-fv-phone_cv":{msg:"Invalid phone number"},"ink-fv-phone_mz":{msg:"Invalid phone number"},"ink-fv-phone_ao":{msg:"Invalid phone number"},"ink-fv-date":{msg:"Invalid date"},"ink-fv-confirm":{msg:"Confirmation does not match"},"ink-fv-custom":{msg:""}},elements:{},confirmElms:{},hasConfirm:{},_errorClassName:"tip error",_errorValidationClassName:"validaton",_errorTypeWarningClassName:"warning",_errorTypeErrorClassName:"error",validate:function(e,r){if(this._free(),r=Ink.extendObj({onSuccess:!1,onError:!1,customFlag:!1,confirmGroup:[]},r||{}),"string"==typeof e&&(e=document.getElementById(e)),null===e)return!1;this.element=e,("undefined"==typeof this.element.id||null===this.element.id||""===this.element.id)&&(this.element.id="ink-fv_randomid_"+Math.round(99999*Math.random())),this.custom=r.customFlag,this.confirmGroup=r.confirmGroup;var n=this._validateElements();return n.length>0?(r.onError?r.onError(n):this._showError(e,n),!1):(r.onError||this._clearError(e),this._clearCache(),r.onSuccess&&r.onSuccess(),!0)},reset:function(){this._clearError(),this._clearCache()},_free:function(){this.element=null,this.custom=!1,this.confirmGroup=!1},_clearCache:function(){this.element=null,this.elements=[],this.custom=!1,this.confirmGroup=!1},_getElements:function(){var e=this.elements[this.element.id]=[];this.confirmElms[this.element.id]=[];for(var n=i.select(":input",this.element),t=!1,s=0,a=n.length;a>s;s++){t=n[s];var o=(t.getAttribute("type")+"").toLowerCase();if("radio"===o||"checkbox"===o){if(0===e.length||t.getAttribute("type")!==e[e.length-1].getAttribute("type")&&t.getAttribute("name")!==e[e.length-1].getAttribute("name"))for(var l in this._flagMap)if(r.hasClassName(t,l)){e.push(t);break}}else{for(var m in this._flagMap)if(r.hasClassName(t,m)&&"ink-fv-confirm"!==m){e.push(t);break}r.hasClassName(t,"ink-fv-confirm")&&(this.confirmElms[this.element.id].push(t),this.hasConfirm[this.element.id]=!0)}}},_validateElements:function(){var e;this._getElements(),this.hasConfirm[this.element.id]===!0&&(e=this._makeConfirmGroups());for(var n,i=[],t=!1,s=!1,a=0,o=this.elements[this.element.id].length;o>a;a++)if(n=!1,t=this.elements[this.element.id][a],!t.disabled)for(var l in this._flagMap)if(r.hasClassName(t,l))if("ink-fv-custom"!==l&&"ink-fv-confirm"!==l)this._isValid(t,l)||(n?i[i.length-1].errors.push(l):(i.push({elm:t,errors:[l]}),n=!0));else if("ink-fv-confirm"!==l)s=this._isCustomValid(t),s.length>0&&i.push({elm:t,errors:[l],custom:s});else if("ink-fv-confirm"===l)continue;return i=this._validateConfirmGroups(e,i)},_validateConfirmGroups:function(e,r){var n=!1;for(var i in e)e.hasOwnProperty(i)&&(n=e[i],2===n.length&&n[0].value!==n[1].value&&r.push({elm:n[1],errors:["ink-fv-confirm"]}));return r},_makeConfirmGroups:function(){var e;if(this.confirmGroup&&this.confirmGroup.length>0){e={};for(var n=!1,i=!1,t=0,s=this.confirmElms[this.element.id].length;s>t;t++){n=this.confirmElms[this.element.id][t];for(var a=0,o=this.confirmGroup.length;o>a;a++)i=this.confirmGroup[a],r.hasClassName(n,i)&&("undefined"==typeof e[i]?e[i]=[n]:e[i].push(n))}return e}return 2===this.confirmElms[this.element.id].length&&(e={"ink-fv-confirm":[this.confirmElms[this.element.id][0],this.confirmElms[this.element.id][1]]}),e},_isCustomValid:function(e){for(var n=[],i=!1,t=0,s=this.custom.length;s>t;t++)i=this.custom[t],r.hasClassName(e,i.flag)&&(i.callback(e,i.msg)||n.push({flag:i.flag,msg:i.msg}));return n},_isValid:function(e,i){var s=e.nodeName.toLowerCase(),a=(e.getAttribute("type")||"").toLowerCase(),o=this._trim(e.value);if("ink-fv-required"!==i&&"checkbox"!==a&&"radio"!==a&&""===o)return!r.hasClassName(e,"ink-fv-required");switch(i){case"ink-fv-required":if("select"===s)return e.selectedIndex>0?!0:!1;if("checkbox"!==a&&"radio"!==a&&""!==o)return!0;if("checkbox"===a||"radio"===a){for(var l=t(e),m=!1,h=0,f=l.length;f>h;h++)if(l[h].checked===!0){m=!0;break}return m}return!1;case"ink-fv-email":return n.mail(e.value);case"ink-fv-url":return n.url(e.value);case"ink-fv-number":return!isNaN(Number(e.value))&&isFinite(Number(e.value));case"ink-fv-phone_pt":return n.isPTPhone(e.value);case"ink-fv-phone_cv":return n.isCVPhone(e.value);case"ink-fv-phone_ao":return n.isAOPhone(e.value);case"ink-fv-phone_mz":return n.isMZPhone(e.value);case"ink-fv-date":var u=Ink.getModule("Ink.Dom.Element",1),c=u.data(e),d="yyyy-mm-dd";if(r.hasClassName(e,"ink-datepicker")&&"format"in c?d=c.format:"validFormat"in c&&(d=c.validFormat),!(d in n._dateParsers)){var v=[];for(var g in n._dateParsers)n._dateParsers.hasOwnProperty(g)&&v.push(g);throw new Error("The attribute data-valid-format must be one of the following values: "+v.join(", "))}return n.isDate(d,e.value);case"ink-fv-custom":}return!1},_showError:function(e,r){this._clearError(e);for(var n=!1,i=0,t=r.length;t>i;i++)n=r[i].elm,n&&this._showAnErrorOnElement(n,r[i])},_showAnErrorOnElement:function(n,i){var t=e.findUpwardsByClass(n,"control-group"),s=e.findUpwardsByClass(n,"control"),a=[this._errorClassName,this._errorTypeClassName].join(" "),o=e.create("p",{className:a});o.innerHTML="ink-fv-custom"!==i.errors[0]?this._flagMap[i.errors[0]].msg:i.custom[0].msg;var l=s||t;l?l.appendChild(o):e.insertAfter(o,n),s&&("ink-fv-required"===i.errors[0]?r.addClassName(t,"validation error"):r.addClassName(t,"validation warning"))},_clearError:function(n){for(var i,t,s=n.getElementsByTagName("p"),a=s.length-1;a>=0;a--)i=s[a],r.hasClassName(i,this._errorClassName)&&(t=e.findUpwardsBySelector(i,".control-group"),t&&r.removeClassName(t,["validation","error","warning"]),r.hasClassName(i,this._errorClassName,!0)&&e.remove(i));var o=n.getElementsByTagName("ul");for(a=o.length-1;a>=0;a--)i=o[a],r.hasClassName(i,"control-group")&&r.removeClassName(i,"validation error")},_trim:function(e){return"string"==typeof e?e.replace(/^\s+|\s+$|\n+$/g,""):void 0}};return s});