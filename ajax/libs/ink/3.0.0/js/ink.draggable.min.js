Ink.createModule("Ink.UI.Draggable","1",["Ink.Dom.Element_1","Ink.Dom.Event_1","Ink.Dom.Css_1","Ink.Dom.Browser_1","Ink.Dom.Selector_1","Ink.UI.Common_1"],function(t,e,s,i,n,o){"use strict";function h(t,e,s){return t=Math.min(t,s),t=Math.max(t,e)}var l=0,r=1,a=function(t,e){this.init(t,e)};return a.prototype={init:function(s,n){var h=Ink.extendObj({constraint:!1,constraintElm:!1,top:!1,right:!1,bottom:!1,left:!1,handle:n.handler||!1,revert:!1,cursor:"move",zindex:n.zindex||9999,dragClass:"drag",onStart:!1,onEnd:!1,onDrag:!1,onChange:!1,droppableProxy:!1,mouseAnchor:void 0,skipChildren:!0,fps:100,debug:!1},n||{},t.data(s));this.options=h,this.element=o.elOrSelector(s),this.constraintElm=h.constraintElm&&o.elOrSelector(h.constraintElm),this.handle=!1,this.elmStartPosition=!1,this.active=!1,this.dragged=!1,this.prevCoords=!1,this.placeholder=!1,this.position=!1,this.zindex=!1,this.firstDrag=!0,h.fps&&(this.deltaMs=1e3/h.fps,this.lastRunAt=0),this.handlers={},this.handlers.start=Ink.bindEvent(this._onStart,this),this.handlers.dragFacade=Ink.bindEvent(this._onDragFacade,this),this.handlers.drag=Ink.bindEvent(this._onDrag,this),this.handlers.end=Ink.bindEvent(this._onEnd,this),this.handlers.selectStart=function(t){return e.stop(t),!1},this.handle=this.options.handle?o.elOrSelector(this.options.handle):this.element,this.handle.style.cursor=h.cursor,e.observe(this.handle,"touchstart",this.handlers.start),e.observe(this.handle,"mousedown",this.handlers.start),i.IE&&e.observe(this.element,"selectstart",this.handlers.selectStart)},destroy:function(){e.stopObserving(this.handle,"touchstart",this.handlers.start),e.stopObserving(this.handle,"mousedown",this.handlers.start),i.IE&&e.stopObserving(this.element,"selectstart",this.handlers.selectStart)},_getCoords:function(e){var s=[t.scrollWidth(),t.scrollHeight()];return{x:(e.touches?e.touches[0].clientX:e.clientX)+s[l],y:(e.touches?e.touches[0].clientY:e.clientY)+s[r]}},_cloneStyle:function(e,i){i.className=e.className,i.style.borderWidth="0",i.style.padding="0",i.style.position="absolute",i.style.width=t.elementWidth(e)+"px",i.style.height=t.elementHeight(e)+"px",i.style.left=t.elementLeft(e)+"px",i.style.top=t.elementTop(e)+"px",i.style.cssFloat=s.getStyle(e,"float"),i.style.display=s.getStyle(e,"display")},_onStart:function(i){if(!this.active&&e.isLeftClick(i)||"undefined"==typeof i.button){var n=e.element(i);if(this.options.skipChildren&&n!==this.handle)return;e.stop(i),s.addClassName(this.element,this.options.dragClass),this.elmStartPosition=[t.elementLeft(this.element),t.elementTop(this.element)];var o=[parseInt(s.getStyle(this.element,"left"),10),parseInt(s.getStyle(this.element,"top"),10)],h=t.elementDimensions(this.element);this.originalPosition=[o[l]?o[l]:null,o[r]?o[r]:null],this.delta=this._getCoords(i),this.active=!0,this.position=s.getStyle(this.element,"position"),this.zindex=s.getStyle(this.element,"zIndex");var a=document.createElement("div");if(a.style.position=this.position,a.style.width=h[l]+"px",a.style.height=h[r]+"px",a.style.marginTop=s.getStyle(this.element,"margin-top"),a.style.marginBottom=s.getStyle(this.element,"margin-bottom"),a.style.marginLeft=s.getStyle(this.element,"margin-left"),a.style.marginRight=s.getStyle(this.element,"margin-right"),a.style.borderWidth="0",a.style.padding="0",a.style.cssFloat=s.getStyle(this.element,"float"),a.style.display=s.getStyle(this.element,"display"),a.style.visibility="hidden",this.delta2=[this.delta.x-this.elmStartPosition[l],this.delta.y-this.elmStartPosition[r]],this.options.mouseAnchor){var d=this.options.mouseAnchor.split(" "),p=[h[l],h[r]];"left"===d[0]?p[l]=0:"center"===d[0]&&(p[l]=parseInt(p[l]/2,10)),"top"===d[1]?p[r]=0:"center"===d[1]&&(p[r]=parseInt(p[r]/2,10)),this.applyDelta=[this.delta2[l]-p[l],this.delta2[r]-p[r]]}var m=this.options.fps?"dragFacade":"drag";if(this.placeholder=a,this.options.onStart&&this.options.onStart(this.element,i),this.options.droppableProxy){this.proxy=document.createElement("div"),h=[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight];var c=this.proxy.style;c.width=h[l]+"px",c.height=h[r]+"px",c.position="fixed",c.left="0",c.top="0",c.zIndex=this.options.zindex+1,c.backgroundColor="#FF0000",s.setOpacity(this.proxy,0);for(var g=document.body.firstChild;g&&1!==g.nodeType;)g=g.nextSibling;document.body.insertBefore(this.proxy,g),e.observe(this.proxy,"mousemove",this.handlers[m]),e.observe(this.proxy,"touchmove",this.handlers[m])}else e.observe(document,"mousemove",this.handlers[m]);return this.element.style.position="absolute",this.element.style.zIndex=this.options.zindex,this.element.parentNode.insertBefore(this.placeholder,this.element),this._onDrag(i),e.observe(document,"mouseup",this.handlers.end),e.observe(document,"touchend",this.handlers.end),!1}},_onDragFacade:function(t){var e=+new Date;(!this.lastRunAt||e>this.lastRunAt+this.deltaMs)&&(this.lastRunAt=e,this._onDrag(t))},_onDrag:function(s){if(this.active){e.stop(s),this.dragged=!0;var i=this._getCoords(s),n=i.x,o=i.y,a=this.options,d=!1,p=!1;if(this.prevCoords&&n!==this.prevCoords.x||o!==this.prevCoords.y){a.onDrag&&a.onDrag(this.element,s),this.prevCoords=i,d=this.elmStartPosition[l]+n-this.delta.x,p=this.elmStartPosition[r]+o-this.delta.y;var m=t.elementDimensions(this.element);if(this.constraintElm){var c=t.offset(this.constraintElm),g=t.elementDimensions(this.constraintElm),y=c[r]+(a.top||0),u=c[r]+g[r]-(a.bottom||0),v=c[l]+(a.left||0),f=c[l]+g[l]-(a.right||0);p=h(p,y,u-m[r]),d=h(d,v,f-m[l])}else if(a.constraint){var b=a.right===!1?t.pageWidth()-m[l]:a.right,x=a.left===!1?0:a.left,S=a.top===!1?0:a.top,I=a.bottom===!1?t.pageHeight()-m[r]:a.bottom;("horizontal"===a.constraint||"both"===a.constraint)&&(d=h(d,x,b)),("vertical"===a.constraint||"both"===a.constraint)&&(p=h(p,S,I))}var D=Ink.getModule("Ink.UI.Droppable_1");if(this.firstDrag&&(D&&D.updateAll(),this.firstDrag=!1),d&&(this.element.style.left=d+"px"),p&&(this.element.style.top=p+"px"),D){var C=this.options.mouseAnchor?{x:n-this.applyDelta[l],y:o-this.applyDelta[r]}:i;D.action(C,"drag",s,this.element)}a.onChange&&a.onChange(this)}}},_onEnd:function(i){if(e.stopObserving(document,"mousemove",this.handlers.drag),e.stopObserving(document,"touchmove",this.handlers.drag),this.options.fps&&this._onDrag(i),s.removeClassName(this.element,this.options.dragClass),this.active&&this.dragged){this.options.droppableProxy&&document.body.removeChild(this.proxy),this.pt&&(t.remove(this.pt),this.pt=void 0),this.placeholder&&t.remove(this.placeholder),this.options.revert&&(this.element.style.position=this.position,this.element.style.zIndex=null!==this.zindex?this.zindex:"auto",this.element.style.left=this.originalPosition[l]?this.originalPosition[l]+"px":"",this.element.style.top=this.originalPosition[r]?this.originalPosition[r]+"px":""),this.options.onEnd&&this.options.onEnd(this.element,i);var n=Ink.getModule("Ink.UI.Droppable_1");n&&n.action(this._getCoords(i),"drop",i,this.element),this.position=!1,this.zindex=!1,this.firstDrag=!0}this.active=!1,this.dragged=!1}},a});