Ink.createModule("Ink.UI.Sticky","1",["Ink.UI.Common_1","Ink.Dom.Event_1","Ink.Dom.Element_1","Ink.Dom.Css_1"],function(t,o,i,e){"use strict";var s=function(o,e){this._rootElement=t.elOrSelector(o,"Ink.UI.Sticky_1"),this._options=t.options({offsetBottom:["Integer",0],offsetTop:["Integer",0],topElement:["Element",null],wrapperClass:["String","ink-sticky-wrapper"],stickyClass:["String","ink-sticky-stuck"],inlineDimensions:["Boolean",!0],inlinePosition:["Boolean",!0],bottomElement:["Element",null],activateInLayouts:["String","medium,large"]},e||{},this._rootElement),this._options.activateInLayouts=this._options.activateInLayouts.toString(),this._dims=null,this._options.offsetTop=parseInt(this._options.offsetTop,10)||0,this._options.offsetBottom=parseInt(this._options.offsetBottom,10)||0,this._options.topElement&&(this._options.topElement=t.elOrSelector(this._options.topElement,"Top Element")),this._options.bottomElement&&(this._options.bottomElement=t.elOrSelector(this._options.bottomElement,"Sticky bottom Element")),this._wrapper=i.create("div",{className:this._options.wrapperClass}),i.wrap(this._rootElement,this._wrapper),this._init()};return s.prototype={_init:function(){var t=document.addEventListener?document:window;this._onScroll=Ink.bind(o.throttle(this._onScroll,33),this),o.observe(t,"scroll",this._onScroll),o.observe(window,"resize",Ink.bindEvent(o.throttle(this._onResize,100),this)),this._onScroll()},_isDisabledInLayout:function(){var o=t.currentLayout();return o?-1===this._options.activateInLayouts.indexOf(o):!1},_onScroll:function(){var t=this._getDims(),o=i.scrollHeight(),e=this._isDisabledInLayout()||o<=t.top-this._options.offsetTop||this._options.topElement&&this._options.topElement.getBoundingClientRect().bottom+this._options.offsetTop>0;if(e)return void this._unstick();var s=this._options.offsetTop+t.height+i.scrollHeight(),n=document.body.scrollHeight;this._options.bottomElement&&(n=this._options.bottomElement.getBoundingClientRect().top+i.scrollHeight()),n-=this._options.offsetBottom,this._stickTo(n>s?"screen":"bottom")},_stickTo:function(t){var o=this._rootElement.style,s=this._getDims();if(e.addClassName(this._rootElement,this._options.stickyClass),this._wrapper.style.height=s.height+"px",this._inlineDimensions(s.height+"px",s.width+"px"),this._options.inlinePosition!==!1)if(o.left=s.left+"px","screen"===t)o.bottom=null,o.top=this._options.offsetTop+"px";else if("bottom"===t){var n=this._getBottomOffset(),l=i.scrollHeight()+i.viewportHeight(),h=i.pageHeight()-l;o.bottom=n-h+"px",o.top="auto"}},_unstick:function(){e.removeClassName(this._rootElement,this._options.stickyClass),this._inlineDimensions(null,null),this._options.inlinePosition&&(this._rootElement.style.left=null,this._rootElement.style.top=null,this._rootElement.style.bottom=null),this._wrapper.style.height=null,this._wrapper.style.width=null,this._dims=null},_onResize:function(){this._dims=null,this._onScroll()},_getDims:function(){if(null!==this._dims)return this._dims;var t=this._rootElement.style,o=t.position,e=t.width;t.position="static",t.width=null;var s=i.outerDimensions(this._rootElement),n=this._wrapper.getBoundingClientRect();return this._dims={height:s[1],width:s[0],left:n.left+i.scrollWidth(),top:n.top+i.scrollHeight()},t.position=o,t.width=e,this._dims},_inlineDimensions:function(t,o){this._options.inlineDimensions&&(this._rootElement.style.height=t,this._rootElement.style.width=o)},_getBottomOffset:function(){var t=this._options.offsetBottom;return this._options.bottomElement&&(t+=i.pageHeight()-i.offsetTop(this._options.bottomElement)),t}},s});