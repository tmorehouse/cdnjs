Ink.createModule("Ink.UI.Toggle","1",["Ink.UI.Common_1","Ink.Dom.Event_1","Ink.Dom.Css_1","Ink.Dom.Element_1","Ink.Dom.Selector_1","Ink.Util.Array_1"],function(t,e,s,i,n,o){"use strict";var a=function(e,n){if(this._rootElement=t.elOrSelector(e,"[Ink.UI.Toggle root element]:"),this._options=Ink.extendObj({target:void 0,triggerEvent:"click",closeOnClick:!0,isAccordion:!1,initialState:null,classNameOn:"show-all",classNameOff:"hide-all",togglesDisplay:null,closeOnInsideClick:"a[href]",onChangeState:null},n||{},i.data(this._rootElement)),this._targets=t.elsOrSelector(this._options.target,"Ink.UI.Toggle target option"),this._options.closeOnClick="true"===this._options.closeOnClick.toString(),this._options.initialState=null!==this._options.initialState?"true"===this._options.initialState.toString():"none"!==s.getStyle(this._targets[0],"display"),"show-all"!==this._options.classNameOn||"hide-all"!==this._options.classNameOff)for(var o=0,a=this._targets.length;a>o;o++)s.removeClassName(this._targets[o],"show-all"),s.removeClassName(this._targets[o],"hide-all");this._init()};return a.prototype={_init:function(){if(this._accordion=s.hasClassName(this._rootElement.parentNode,"accordion")||s.hasClassName(this._targets[0].parentNode,"accordion"),this._firstTime=!0,this._bindEvents(),null!==this._options.initialState)this.setState(this._options.initialState,!0);else{var t="none"!==s.getStyle(this._targets[0],"display");this.setState(t,!0)}for(var e=0,i=this._targets.length;i>e;e++)this._targets[e].style.display&&(this._targets[e].style.display="");this._rootElement.setAttribute("data-is-toggle-trigger","true")},_bindEvents:function(){if(this._options.triggerEvent&&e.observe(this._rootElement,this._options.triggerEvent,Ink.bind(this._onTriggerEvent,this)),this._options.closeOnClick&&e.observe(document,"click",Ink.bind(this._onOutsideClick,this)),this._options.closeOnInsideClick&&"false"!==this._options.closeOnInsideClick){var t=this._options.closeOnInsideClick;"true"===t.toString()&&(t="*"),e.observeMulti(this._targets,"click",Ink.bind(function(s){i.findUpwardsBySelector(e.element(s),t)&&this.setState(!1,!0)},this))}},_onTriggerEvent:function(t){var s=e.element(t),n=o.some(this._targets,function(t){return t===s||i.isAncestorOf(t,s)});if(!n){this._accordion&&this._updateAccordion();var a=this.getState();this.setState(!a,!0),!a&&this._firstTime&&(this._firstTime=!1),e.stopDefault(t)}},_updateAccordion:function(){var t,e;e=s.hasClassName(this._targets[0].parentNode,"accordion")?this._targets[0].parentNode:this._targets[0].parentNode.parentNode,t=n.select(".toggle, .ink-toggle",e);for(var o=0;o<t.length;o+=1){var a=i.data(t[o]),r=n.select(a.target,e);r.length>0&&r[0]!==this._targets[0]&&(r[0].style.display="none")}},_onOutsideClick:function(t){var s,n=e.element(t);if(!i.findUpwardsBySelector(n,'[data-is-toggle-trigger="true"]')){var a=o.some(this._targets,function(t){return i.isAncestorOf(t,n)||t===n});if(this._rootElement!==n&&!i.isAncestorOf(this._rootElement,n)&&!a){if((s=Ink.ss(".ink-shade")).length)for(var r=s.length,l=0;r>l;l++)if(i.isAncestorOf(s[l],n)&&i.isAncestorOf(s[l],this._rootElement))return;this.setState(!1,!0)}}},setState:function(t,e){if(t!==this.getState()){if(e&&"function"==typeof this._options.onChangeState){var i=this._options.onChangeState(t);if(i===!1)return!1}for(var n=0,o=this._targets.length;o>n;n++)s.addRemoveClassName(this._targets[n],this._options.classNameOn,t),s.addRemoveClassName(this._targets[n],this._options.classNameOff,!t);s.addRemoveClassName(this._rootElement,"active",t)}},getState:function(){return s.hasClassName(this._rootElement,"active")}},a});