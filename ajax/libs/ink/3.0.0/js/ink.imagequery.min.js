Ink.createModule("Ink.UI.ImageQuery","1",["Ink.UI.Common_1","Ink.Dom.Event_1","Ink.Dom.Element_1","Ink.Util.Array_1"],function(e,t,n,i){"use strict";var s=function(t,i){this._element=e.elsOrSelector(t,"Ink.UI.ImageQuery",!0);for(var o=1;o<this._element.length;o++)new s(this._element[o],i);this._element=this._element[0],this._options=Ink.extendObj({queries:[],onLoad:null},i||{},n.data(this._element));var r;if(-1!==(r=this._element.src.lastIndexOf("?"))){var l=this._element.src.substr(r);this._filename=this._element.src.replace(l,"").split("/").pop()+l}else this._filename=this._element.src.split("/").pop();this._init()};return s.prototype={_init:function(){this._options.queries=i.sortMulti(this._options.queries,"width").reverse(),"function"==typeof this._options.onLoad&&t.observe(this._element,"onload",Ink.bindEvent(this._onLoad,this)),t.observe(window,"resize",t.throttle(Ink.bindMethod(this,"_onResize"),400)),this._onResize()},_onResize:function(){if(this._options.queries.length){var e=this._findCurrentQuery(),t=e.src||this._options.src;if(window.devicePixelRatio>1&&"retina"in this._options&&(t=e.retina||this._options.retina),e.file=this._filename,"function"==typeof t&&(t=t.apply(this,[this._element,e]),"string"!=typeof t))throw'[ImageQuery] :: "src" callback does not return a string';t=t.replace(/{:(.*?)}/g,function(t,n){return e[n]}),this._element.src=t,delete e.file}},_findCurrentQuery:function(){for(var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=this._options.queries,n=t.length-1,i=0;n>i;i+=1)if(t[i].width<=e)return t[i];return t[n]},_onLoad:function(){this._options.onLoad.call(this)}},s});