Ink.createModule("Ink.UI.Carousel","1",["Ink.UI.Common_1","Ink.Dom.Event_1","Ink.Dom.Css_1","Ink.Dom.Element_1","Ink.UI.Pagination_1","Ink.Dom.Browser_1","Ink.Dom.Selector_1"],function(t,i,s,e,n,o){"use strict";function h(t,i,s){return Math.min(s,Math.max(i,t))}function a(t,i){t.style.transitionProperty=t.style.oTransitionProperty=t.style.msTransitionProperty=t.style.mozTransitionProperty=t.style.webkitTransitionProperty=i}var _=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,1e3/30)},r=function(s,n){this._handlers={paginationChange:Ink.bindMethod(this,"_onPaginationChange"),windowResize:i.throttle(Ink.bindMethod(this,"refit"),200)},i.observe(window,"resize",this._handlers.windowResize);var o=this._element=t.elOrSelector(s,"1st argument"),h=this._options=t.options({autoAdvance:["Integer",0],axis:["String","x"],initialPage:["Integer",0],spaceAfterLastSlide:["Boolean",!0],hideLast:["Boolean",!1],center:["Boolean",!1],keyboardSupport:["Boolean",!1],pagination:["String",null],onChange:["Function",null],swipe:["Boolean",!0]},n||{},o,this);this._isY="y"===h.axis;var a=Ink.s("ul.stage",o);this._ulEl=a,e.removeTextNodeChildren(a),null==this._options.pagination&&(this._currentPage=this._options.initialPage),this.refit(),this._isY&&(this._ulEl.style.whiteSpace="normal"),h.swipe&&(i.observe(o,"touchstart",Ink.bindMethod(this,"_onTouchStart")),i.observe(o,"touchmove",Ink.bindMethod(this,"_onTouchMove")),i.observe(o,"touchend",Ink.bindMethod(this,"_onTouchEnd"))),this._setUpPagination(),this._setUpAutoAdvance(),this._setUpHider()};return r.prototype={refit:function(){var t=this._isY,i=function(i,s){return s?e.outerDimensions(i)[t?0:1]:e.outerDimensions(i)[t?1:0]};this._liEls=Ink.ss("li.slide",this._ulEl);var s=this._liEls.length,n=this._ulEl.getBoundingClientRect();this._ctnLength=t?n.bottom-n.top:n.right-n.left,this._elLength=i(this._liEls[0]),this._slidesPerPage=Math.floor(this._ctnLength/this._elLength)||1;var o=Math.ceil(s/this._slidesPerPage),a=this._numPages!==o;this._numPages=o,this._deltaLength=this._slidesPerPage*this._elLength,this._center(),this._updateHider(),this._IE7(),this._pagination&&a&&this._pagination.setSize(this._numPages),this.setPage(h(this.getPage(),0,this._numPages))},_setUpPagination:function(){this._options.pagination?(t.isDOMElement(this._options.pagination)||"string"==typeof this._options.pagination?this._pagination=new n(this._options.pagination,{size:this._numPages,onChange:this._handlers.paginationChange}):(this._pagination=this._options.pagination,this._pagination._options.onChange=this._handlers.paginationChange,this._pagination.setSize(this._numPages)),this._pagination.setCurrent(this._options.initialPage||0)):this._currentPage=this._options.initialPage||0},_setUpAutoAdvance:function(){if(this._options.autoAdvance){var t=this;setTimeout(function i(){t.nextPage(!0),setTimeout(i,t._options.autoAdvance)},this._options.autoAdvance)}},_setUpHider:function(){if(this._options.hideLast){var t=e.create("div",{className:"hider",insertBottom:this._element});t.style.position="absolute",t.style[this._isY?"left":"top"]="0",t.style[this._isY?"right":"bottom"]="0",t.style[this._isY?"bottom":"right"]="0",this._hiderEl=t}},_center:function(){if(this._options.center){var t,i=Math.floor((this._ctnLength-this._elLength*this._slidesPerPage)/2);t=this._isY?[i,"px 0"]:["0 ",i,"px"],this._ulEl.style.padding=t.join("")}},_updateHider:function(){if(this._hiderEl)if(0===this.getPage()){var t=Math.floor(this._ctnLength-this._elLength*this._slidesPerPage);this._options.center&&(t/=2),this._hiderEl.style[this._isY?"height":"width"]=t+"px"}else this._hiderEl.style[this._isY?"height":"width"]="0px"},_IE7:function(){if(o.IE&&""+o.version.split(".")[0]=="7")for(var t=Ink.ss("li.slide",this._ulEl),i=function(i,e){t[s].style[i]=e},s=0,e=t.length;e>s;s++)i("position","absolute"),i(this._isY?"top":"left",s*this._elLength+"px")},_onTouchStart:function(t){if(!(t.touches.length>1)){this._swipeData={x:i.pointerX(t),y:i.pointerY(t),lastUlPos:null};var s=this._ulEl.getBoundingClientRect();this._swipeData.inUlX=this._swipeData.x-s.left,this._swipeData.inUlY=this._swipeData.y-s.top,a(this._ulEl,"none"),this._touchMoveIsFirstTouchMove=!0,i.stopPropagation(t)}},_onTouchMove:function(t){if(!(t.touches.length>1)){var s=i.pointerX(t),e=i.pointerY(t),n=Math.abs(e-this._swipeData.y),o=Math.abs(s-this._swipeData.x);this._touchMoveIsFirstTouchMove&&(this._touchMoveIsFirstTouchMove=void 0,this._scrolling=this._isY?o>n:n>o,this._scrolling||this._onAnimationFrame()),!this._scrolling&&this._swipeData&&(i.stopDefault(t),this._swipeData.pointerPos=this._isY?e:s),i.stopPropagation(t)}},_onAnimationFrame:function(){var t=this._swipeData;if(t&&!this._scrolling&&!this._touchMoveIsFirstTouchMove){var i,s=this._element.getBoundingClientRect();i=this._isY?t.pointerPos-t.inUlY-s.top:t.pointerPos-t.inUlX-s.left,this._ulEl.style[this._isY?"top":"left"]=i+"px",t.lastUlPos=i,_(Ink.bindMethod(this,"_onAnimationFrame"))}},_onTouchEnd:function(t){if(this._swipeData&&this._swipeData.pointerPos&&!this._scrolling&&!this._touchMoveIsFirstTouchMove){var s=.1,e=-this._swipeData.lastUlPos,n=this.getPage(),o=e/this._elLength/this._slidesPerPage;if(Math.round(o)===n){var h=o-n;Math.abs(h)>s&&(h=h>0?1:-1,n+=h)}else n=Math.round(o);this.setPage(n),i.stopPropagation(t),i.stopDefault(t)}a(this._ulEl,null),this._swipeData=null,this._touchMoveIsFirstTouchMove=void 0,this._scrolling=void 0},_onPaginationChange:function(t){this._setPage(t.getCurrent())},getPage:function(){return this._pagination?this._pagination.getCurrent():this._currentPage||0},setPage:function(t,i){i&&(t%=this._numPages,0>t&&(t=this._numPages-t)),t=h(t,0,this._numPages-1),this._pagination?this._pagination.setCurrent(t):this._setPage(t)},_setPage:function(t){var i=t*this._deltaLength,s=t===this._numPages-1;if(!this._options.spaceAfterLastSlide&&s&&t>0){var e=this._liEls.length-t*this._slidesPerPage;e<this._slidesPerPage&&(i=(t-1)*this._deltaLength+e*this._elLength)}this._ulEl.style[this._isY?"top":"left"]=["-",i,"px"].join(""),this._options.onChange&&this._options.onChange.call(this,t),this._currentPage=t,this._updateHider()},nextPage:function(t){this.setPage(this.getPage()+1,t)},previousPage:function(t){this.setPage(this.getPage()-1,t)}},r});