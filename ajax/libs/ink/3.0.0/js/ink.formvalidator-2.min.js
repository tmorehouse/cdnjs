Ink.createModule("Ink.UI.FormValidator","2",["Ink.UI.Common_1","Ink.Dom.Element_1","Ink.Dom.Event_1","Ink.Dom.Selector_1","Ink.Dom.Css_1","Ink.Util.Array_1","Ink.Util.I18n_1","Ink.Util.Validator_1"],function(e,t,r,n,i,a,o,l){"use strict";var s={required:function(e){return"undefined"!=typeof e&&!/^\s*$/.test(e)},min_length:function(e,t){return"string"==typeof e&&e.length>=parseInt(t,10)},max_length:function(e,t){return"string"==typeof e&&e.length<=parseInt(t,10)},exact_length:function(e,t){return"string"==typeof e&&e.length===parseInt(t,10)},email:function(e){return"string"==typeof e&&l.mail(e)},url:function(e,t){return t=t||!1,"string"==typeof e&&l.url(e,t)},ip:function(e,t){return"string"!=typeof e?!1:l.isIP(e,t)},phone:function(e,t){if("string"!=typeof e)return!1;var r=t?t.toUpperCase():"";return l["is"+r+"Phone"](e)},credit_card:function(e,t){return"string"!=typeof e?!1:l.isCreditCard(e,t||"default")},date:function(e,t){return"string"==typeof e&&l.isDate(t,e)},alpha:function(e,t){return l.ascii(e,{singleLineWhitespace:t})},text:function(e,t,r){return l.unicode(e,{singleLineWhitespace:t,unicodePunctuation:r})},latin:function(e,t,r){return"string"!=typeof e?!1:l.latin1(e,{latin1Punctuation:t,singleLineWhitespace:r})},alpha_numeric:function(e){return l.ascii(e,{numbers:!0})},alpha_dash:function(e){return l.ascii(e,{dash:!0,underscore:!0})},digit:function(e){return"string"==typeof e&&/^[0-9]{1}$/.test(e)},integer:function(e,t){return l.number(e,{negative:!t,decimalPlaces:0})},decimal:function(e,t,r,n){return l.number(e,{decimalSep:t||".",decimalPlaces:+r||null,maxDigits:+n})},numeric:function(e,t,r,n){return t=t||".",-1!==e.indexOf(t)?s.decimal(e,t,r,n):s.integer(e)},range:function(e,t,r,n){return e=+e,t=+t,r=+r,isNaN(e)||isNaN(t)||isNaN(r)?!1:t>e||e>r?!1:n?(e-t)%n===0:!0},color:function(e){return l.isColor(e)},matches:function(e,t){return e===this.getFormElements()[t][0].getValue()}},d=new o({en_US:{"formvalidator.required":"The {field} filling is mandatory","formvalidator.min_length":"The {field} must have a minimum size of {param1} characters","formvalidator.max_length":"The {field} must have a maximum size of {param1} characters","formvalidator.exact_length":"The {field} must have an exact size of {param1} characters","formvalidator.email":"The {field} must have a valid e-mail address","formvalidator.url":"The {field} must have a valid URL","formvalidator.ip":"The {field} does not contain a valid {param1} IP address","formvalidator.phone":"The {field} does not contain a valid {param1} phone number","formvalidator.credit_card":"The {field} does not contain a valid {param1} credit card","formvalidator.date":"The {field} should contain a date in the {param1} format","formvalidator.alpha":"The {field} should only contain letters","formvalidator.text":"The {field} should only contain alphabetic characters","formvalidator.latin":"The {field} should only contain alphabetic characters","formvalidator.alpha_numeric":"The {field} should only contain letters or numbers","formvalidator.alpha_dashes":"The {field} should only contain letters or dashes","formvalidator.digit":"The {field} should only contain a digit","formvalidator.integer":"The {field} should only contain an integer","formvalidator.decimal":"The {field} should contain a valid decimal number","formvalidator.numeric":"The {field} should contain a number","formvalidator.range":"The {field} should contain a number between {param1} and {param2}","formvalidator.color":"The {field} should contain a valid color","formvalidator.matches":"The {field} should match the field {param1}","formvalidator.validation_function_not_found":"The rule {rule} has not been defined"},pt_PT:{"formvalidator.required":"Preencher {field} é obrigatório","formvalidator.min_length":"{field} deve ter no mínimo {param1} caracteres","formvalidator.max_length":"{field} tem um tamanho máximo de {param1} caracteres","formvalidator.exact_length":"{field} devia ter exactamente {param1} caracteres","formvalidator.email":"{field} deve ser um e-mail válido","formvalidator.url":"O {field} deve ser um URL válido","formvalidator.ip":"{field} não tem um endereço IP {param1} válido","formvalidator.phone":"{field} deve ser preenchido com um número de telefone {param1} válido.","formvalidator.credit_card":"{field} não tem um cartão de crédito {param1} válido","formvalidator.date":"{field} deve conter uma data no formato {param1}","formvalidator.alpha":"O campo {field} deve conter apenas caracteres alfabéticos","formvalidator.text":"O campo {field} deve conter apenas caracteres alfabéticos","formvalidator.latin":"O campo {field} deve conter apenas caracteres alfabéticos","formvalidator.alpha_numeric":"{field} deve conter apenas letras e números","formvalidator.alpha_dashes":"{field} deve conter apenas letras e traços","formvalidator.digit":"{field} destina-se a ser preenchido com apenas um dígito","formvalidator.integer":"{field} deve conter um número inteiro","formvalidator.decimal":"{field} deve conter um número válido","formvalidator.numeric":"{field} deve conter um número válido","formvalidator.range":"{field} deve conter um número entre {param1} e {param2}","formvalidator.color":"{field} deve conter uma cor válida","formvalidator.matches":"{field} deve corresponder ao campo {param1}","formvalidator.validation_function_not_found":"[A regra {rule} não foi definida]"}},"en_US"),m=function(r,n){this._element=e.elOrSelector(r,"Invalid FormElement"),this._errors={},this._rules={},this._value=null,this._options=Ink.extendObj({label:this._getLabel()},t.data(this._element)),this._options=Ink.extendObj(this._options,n||{})};m.prototype={_getLabel:function(){var e=t.findUpwardsByClass(this._element,"control-group"),r=Ink.s("label",e);return r=r?t.textContent(r):this._element.name||this._element.id||""},_parseRules:function(e){this._rules={},e=e.split("|");var t,r,n,i,a=e.length;if(a>0)for(t=0;a>t;t++)if(r=e[t])if(-1!==(i=r.indexOf("["))){n=r.substr(i+1),n=n.split("]"),n=n[0],n=n.split(",");for(var o=0,l=n.length;l>o;o++)n[o]="true"===n[o]?!0:"false"===n[o]?!1:n[o];n.splice(0,0,this.getValue()),r=r.substr(0,i),this._rules[r]=n}else this._rules[r]=[this.getValue()]},_addError:function(e){for(var t=this._rules[e]||[],r={field:this._options.label,value:this.getValue()},n=1;n<t.length;n++)r["param"+n]=t[n];var i="formvalidator."+e;this._errors[e]=d.text(i,r),this._errors[e]===i&&(this._errors[e]="Validation message not found")},getValue:function(){switch(this._element.nodeName.toLowerCase()){case"select":return Ink.s("option:selected",this._element).value;case"textarea":return this._element.innerHTML;case"input":if(!("type"in this._element))return this._element.value;if("radio"===this._element.type&&"checkbox"===this._element.type){if(this._element.checked)return this._element.value}else if("file"!==this._element.type)return this._element.value;return;default:return this._element.innerHTML}},getErrors:function(){return this._errors},getElement:function(){return this._element},getFormElements:function(){return this._options.form._formElements},validate:function(){if(this._errors={},this._parseRules(this._options.rules),"required"in this._rules||""!==this.getValue())for(var e in this._rules)if(this._rules.hasOwnProperty(e)){if("function"!=typeof s[e])return this._addError(null),!1;if(s[e].apply(this,this._rules[e])===!1)return this._addError(e),!1}return!0}};var f=function(n,i){this._rootElement=e.elOrSelector(n),this._formElements={},this._errorMessages=[],this._markedErrorElements=[],this._options=Ink.extendObj({eventTrigger:"submit",neverSubmit:"false",searchFor:"input, select, textarea, .control-group",beforeValidation:void 0,onError:void 0,onSuccess:void 0},t.data(this._rootElement)),this._options=Ink.extendObj(this._options,i||{}),"string"==typeof this._options.eventTrigger&&r.observe(this._rootElement,this._options.eventTrigger,Ink.bindEvent(this.validate,this)),this._init()};return f.setRule=function(e,t,r){if(s[e]=r,d.getKey("formvalidator."+e)!==t){var n={};n["formvalidator."+e]=t;var i={};i[d.lang()]=n,d.append(i)}},f.getI18n=function(){return d},f.setI18n=function(e){d=e},f.appendI18n=function(){d.append.apply(d,[].slice.call(arguments))},f.setLanguage=function(e){d.lang(e)},f.getRules=function(){return s},f.prototype={_init:function(){},getElements:function(){this._formElements={};var e=n.select(this._options.searchFor,this._rootElement);if(e.length){var r,i;for(r=0;r<e.length;r+=1){i=e[r];var a=t.data(i);if("rules"in a){var o,l={form:this};"name"in i&&i.name?o=i.name:"id"in i&&i.id?o=i.id:(o="element_"+Math.floor(100*Math.random()),i.id=o),o in this._formElements?this._formElements[o].push(new m(i,l)):this._formElements[o]=[new m(i,l)]}}}return this._formElements},validate:function(e){this._options.neverSubmit+""=="true"&&e&&r.stopDefault(e),"function"==typeof this._options.beforeValidation&&this._options.beforeValidation(),a.each(this._markedErrorElements,function(e){i.removeClassName(e,["validation","error"])}),a.each(this._errorMessages,t.remove),this.getElements();var n=[];for(var o in this._formElements)if(this._formElements.hasOwnProperty(o))for(var l=0;l<this._formElements[o].length;l+=1)this._formElements[o][l].validate()||n.push(this._formElements[o][l]);return 0===n.length?("function"==typeof this._options.onSuccess&&this._options.onSuccess(),e&&"true"===this._options.cancelEventOnSuccess.toString()?(r.stopDefault(e),!1):!0):(e&&r.stopDefault(e),"function"==typeof this._options.onError&&this._options.onError(n),this._errorMessages=[],this._markedErrorElements=[],a.each(n,Ink.bind(function(e){var r,n;i.hasClassName(e.getElement(),"control-group")?(r=e.getElement(),n=Ink.s(".control",e.getElement())):(r=t.findUpwardsByClass(e.getElement(),"control-group"),n=t.findUpwardsByClass(e.getElement(),"control")),r&&(i.addClassName(r,["validation","error"]),this._markedErrorElements.push(r));var a=document.createElement("p");i.addClassName(a,"tip"),n||r?(n||r).appendChild(a):t.insertAfter(a,e.getElement());var o=e.getErrors(),l=[];for(var s in o)o.hasOwnProperty(s)&&l.push(o[s]);a.innerHTML=l.join("<br/>"),this._errorMessages.push(a)},this)),!1)}},f});