Ink.createModule("Ink.UI.SortableList","1",["Ink.UI.Common_1","Ink.Dom.Css_1","Ink.Dom.Event_1","Ink.Dom.Element_1","Ink.Dom.Selector_1"],function(e,t,o,s,i){"use strict";var n="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,r=function(t,o){this._element=e.elOrSelector(t,"Ink.UI.SortableList"),this._options=e.options("Sortable",{placeholderClass:["String","placeholder"],draggedClass:["String","hide-all"],draggingClass:["String","dragging"],dragSelector:["String","li"],dragObject:["String",null],handleSelector:["String",null],moveSelector:["String",!1],swap:["Boolean",!1],cancelMouseOut:["Boolean",!1]},o||{},this._element),null!=this._options.dragObject&&(Ink.warn("Ink.UI.SortableList: options.dragObject is now deprecated. Please use options.handleSelector instead."),this._options.handleSelector=this._options.handleSelector||this._options.dragObject),this._handlers={down:Ink.bind(this._onDown,this),move:Ink.bind(this._onMove,this),up:Ink.bind(this._onUp,this)},this._isMoving=!1,this._init()};return r.prototype={_init:function(){this._down=n?"touchstart mousedown":"mousedown",this._move=n?"touchmove mousemove":"mousemove",this._up=n?"touchend mouseup":"mouseup",this._observe(),e.registerInstance(this,this._element,"sortableList")},_observe:function(){o.on(this._element,this._down,this._options.dragSelector,this._handlers.down),o.on(this._element,this._move,this._options.dragSelector,this._handlers.move),this._options.cancelMouseOut&&o.on(this._element,"mouseleave",Ink.bind(this.stopMoving,this)),o.on(document.documentElement,this._up,this._handlers.up)},_onDown:function(e){if(!(this._isMoving||this._placeholder||this._options.handleSelector&&!i.matchesSelector(e.target,this._options.handleSelector))){var t=e.currentTarget;return this._isMoving=t,this._placeholder=t.cloneNode(!0),this._movePlaceholder(t),this._addMovingClasses(),!1}},_onMove:function(e){return this.validateMove(e.currentTarget),!1},_onUp:function(e){return this._isMoving&&this._placeholder&&e.currentTarget!==this._isMoving&&e.currentTarget!==this._placeholder?(s.insertBefore(this._isMoving,this._placeholder),this.stopMoving(),!1):void 0},_addMovingClasses:function(){t.addClassName(this._placeholder,this._options.placeholderClass),t.addClassName(this._isMoving,this._options.draggedClass),t.addClassName(document.documentElement,this._options.draggingClass)},_removeMovingClasses:function(){this._isMoving&&t.removeClassName(this._isMoving,this._options.draggedClass),this._placeholder&&t.removeClassName(this._placeholder,this._options.placeholderClass),t.removeClassName(document.documentElement,this._options.draggingClass)},_movePlaceholder:function(e){var t,o,i,n,r=this._placeholder;r?this._options.swap?(s.insertAfter(r,e),s.insertBefore(e,this._isMoving),s.insertBefore(this._isMoving,r)):(t=s.offset(e),o=s.offset(this._placeholder),i=t[1]>o[1],n=t[0]>o[0],i&&n||!i&&!n?s.insertBefore(r,e):s.insertAfter(r,e),s.insertBefore(this._isMoving,r)):s.insertAfter(r,e)},destroy:e.destroyComponent,stopMoving:function(){this._removeMovingClasses(),s.remove(this._placeholder),this._placeholder=!1,this._isMoving=!1},validateMove:function(e){this._isMoving&&this._placeholder&&e!==this._placeholder&&e!==this._isMoving&&(!this._options.moveSelector||i.matchesSelector(e,this._options.moveSelector)?this._movePlaceholder(e):this.stopMoving())}},r});