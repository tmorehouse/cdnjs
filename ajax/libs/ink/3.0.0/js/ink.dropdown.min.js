Ink.createModule("Ink.UI.Dropdown","1",["Ink.UI.Common_1","Ink.UI.Toggle_1","Ink.Dom.Event_1","Ink.Dom.Element_1"],function(i,t,e,s){"use strict";function n(i,t){this._init(i,t)}return n.prototype={_init:function(s,n){this._element=i.elOrSelector(s),this._options=i.options("Ink.UI.Dropdown_1",{target:["Element"],hoverOpen:["Number",null],dismissOnInsideClick:["Boolean",!1],dismissOnOutsideClick:["Boolean",!0],dismissAfter:["Number",null],onInsideClick:["Function",null],onOutsideClick:["Function",null],onOpen:["Function",null],onDismiss:["Function",null]},n||{},this._element),this._toggle=new t(this._element,{target:this._options.target,closeOnInsideClick:null,closeOnClick:!1,onChangeState:Ink.bind(function(i){return this._openOrDismiss(i,!0,!0)},this)}),e.observeMulti([this._options.target,this._element],"mouseout",Ink.bindMethod(this,"_onMouseOut")),e.observeMulti([this._options.target,this._element],"mouseover",Ink.bindMethod(this,"_onMouseOver")),e.observe(this._options.target,"click",Ink.bindMethod(this,"_onInsideClick")),e.observe(document,"click",Ink.bindMethod(this,"_onOutsideClick"))},_onMouseOver:function(){"number"==typeof this._options.hoverOpen&&this._toggle.getState()===!1&&(clearTimeout(this._openTimeout),this._openTimeout=setTimeout(Ink.bindMethod(this,"open",!0),1e3*this._options.hoverOpen)),"number"==typeof this._options.dismissAfter&&clearTimeout(this._dismissTimeout)},_onMouseOut:function(){"number"==typeof this._options.dismissAfter&&this._toggle.getState()===!0&&(clearTimeout(this._dismissTimeout),this._dismissTimeout=setTimeout(Ink.bindMethod(this,"dismiss",!0),1e3*this._options.dismissAfter)),"number"==typeof this._options.hoverOpen&&clearTimeout(this._openTimeout)},_onInsideClick:function(i){var t=this._handlerCall("onInsideClick",e.element(i));return t===!1?!1:(this._options.dismissOnInsideClick&&this.dismiss(!0),void e.stop(i))},_onOutsideClick:function(i){var t=e.element(i),n=s.findUpwardsHaving(t,Ink.bind(function(i){return i===this._element},this)),o=s.findUpwardsHaving(t,Ink.bind(function(i){return i===this._options.target},this));if(!n&&!o){var l=this._handlerCall("onOutsideClick",t);if(l===!1)return!1;this._options.dismissOnOutsideClick&&this.dismiss(!0),e.stop(i)}},dismiss:function(i,t){this._openOrDismiss(!1,i,t)},open:function(i,t){this._openOrDismiss(!0,i,t)},_openOrDismiss:function(i,t,e){if(!this._toggle||this._toggle.getState()!==i){if(t&&this._handlerCall(i?"onOpen":"onDismiss")===!1)return!1;e||this._toggle.setState(i),clearTimeout(this._dismissTimeout),clearTimeout(this._openTimeout)}},_handlerCall:function(i){return this._options[i]?this._options[i].call(this,[].slice.call(arguments,1)):void 0}},n});