/*!
 * Pusher JavaScript Library v2.2.0-rc1
 * http://pusherapp.com/
 *
 * Copyright 2013, Pusher
 * Released under the MIT licence.
 */

(function(){function d(a,c,d){Pusher.EventsDispatcher.call(this);this.hooks=a;this.method=c;this.url=d}var a=d.prototype;Pusher.Util.extend(a,Pusher.EventsDispatcher.prototype);a.start=function(a){var c=this;c.position=0;c.xhr=c.hooks.getRequest(c);c.unloader=function(){c.close()};Pusher.Util.addWindowListener("unload",c.unloader);c.xhr.open(c.method,c.url,!0);c.xhr.send(a)};a.close=function(){if(this.unloader)Pusher.Util.removeWindowListener("unload",this.unloader),this.unloader=null;if(this.xhr)this.hooks.abortRequest(this.xhr),
this.xhr=null};a.onChunk=function(a,c){for(;;){var d=this.advanceBuffer(c);if(d)this.emit("chunk",{status:a,data:d});else break}this.isBufferTooLong(c)&&this.emit("buffer_too_long")};a.advanceBuffer=function(a){var a=a.slice(this.position),c=a.indexOf("\n");return c!==-1?(this.position+=c+1,a.slice(0,c)):null};a.isBufferTooLong=function(a){return this.position===a.length&&a.length>262144};Pusher.HTTP.Request=d}).call(this);
(function(){var d={getRequest:function(a){var b=new window.XDomainRequest;b.ontimeout=function(){a.emit("error",new Pusher.Errors.RequestTimedOut);a.close()};b.onerror=function(b){a.emit("error",b);a.close()};b.onprogress=function(){if(b.responseText&&b.responseText.length>0)a.onChunk(200,b.responseText)};b.onload=function(){if(b.responseText&&b.responseText.length>0)a.onChunk(200,b.responseText);a.emit("finished",200);a.close()};return b},abortRequest:function(a){a.ontimeout=a.onerror=a.onprogress=
a.onload=null;a.abort()}};Pusher.HTTP.getXDR=function(a,b){return new Pusher.HTTP.Request(d,a,b)}}).call(this);
(function(){function d(e,a){this.hooks=e;var b=Math.floor(Math.random()*1E3)+"/",d;d=[];for(var f=0;f<8;f++)d.push(Math.floor(Math.random()*32).toString(32));d=d.join("");this.session=b+d;b=/([^\?]*)\/*(\??.*)/.exec(a);this.location={base:b[1],queryString:b[2]};this.readyState=c;this.openStream()}function a(e){var a=e.indexOf("?")===-1?"?":"&";return e+a+"t="+ +new Date+"&n="+g++}function b(a,b){if(Pusher.Util.isXHRSupported())return Pusher.HTTP.getXHR(a,b);else if(Pusher.Util.isXDRSupported(b.indexOf("https:")===
0))return Pusher.HTTP.getXDR(a,b);else throw new "Cross-origin HTTP requests are not supported";}var c=0,g=1,f=d.prototype;f.send=function(a){return this.sendRaw(JSON.stringify([a]))};f.close=function(a,b){this.onClose(a,b,!0)};f.sendRaw=function(e){if(this.readyState===1)try{return b("POST",a(this.location.base+"/"+this.session+"/xhr_send")).start(e),!0}catch(c){return!1}else return!1};f.reconnect=function(){this.closeStream();this.openStream()};f.onClose=function(a,b,c){this.stopActivityCheck();
this.closeStream();this.readyState=3;if(this.onclose)this.onclose({code:a,reason:b,wasClean:c})};f.onChunk=function(a){if(a.status===200)switch(this.readyState===1&&this.resetActivityCheck(),a.data.slice(0,1)){case "o":a=JSON.parse(a.data.slice(1)||"{}");this.onOpen(a);break;case "a":for(var a=JSON.parse(a.data.slice(1)||"[]"),b=0;b<a.length;b++)this.onEvent(a[b]);break;case "m":a=JSON.parse(a.data.slice(1)||"null");this.onEvent(a);break;case "h":this.hooks.onHeartbeat(this);break;case "c":a=JSON.parse(a.data.slice(1)||
"[]"),this.onClose(a[0],a[1],!0)}};f.onOpen=function(a){if(this.readyState===c){if(a&&a.hostname){var b=this.location,a=a.hostname,d=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(this.location.base);b.base=d[1]+a+d[3]}this.resetActivityCheck();this.readyState=1;if(this.onopen)this.onopen()}else this.onClose(1006,"Server lost session",!0)};f.onEvent=function(a){if(this.readyState===1&&this.onmessage)this.onmessage({data:a})};f.onError=function(a){if(this.onerror)this.onerror(a)};f.openStream=function(){var e=
this;e.stream=b("POST",a(e.hooks.getReceiveURL(e.location,e.session)));e.stream.bind("chunk",function(a){e.onChunk(a)});e.stream.bind("finished",function(a){e.hooks.onFinished(e,a)});e.stream.bind("buffer_too_long",function(){e.reconnect()});try{e.stream.start()}catch(c){Pusher.Util.defer(function(){e.onError(c);e.onClose(1006,"Could not start streaming",!1)})}};f.closeStream=function(){if(this.stream)this.stream.unbind_all(),this.stream.close(),this.stream=null};f.resetActivityCheck=function(){var a=
this;a.stopActivityCheck();a.activityTimer=new Pusher.Timer(3E4,function(){a.hooks.sendHeartbeat(a);a.activityTimer=new Pusher.Timer(15E3,function(){a.onClose(1006,"Did not receive a heartbeat response",!1)})})};f.stopActivityCheck=function(){if(this.activityTimer)this.activityTimer.ensureAborted(),this.activityTimer=null};Pusher.HTTP.Socket=d}).call(this);
(function(){var d={getReceiveURL:function(a,b){return a.base+"/"+b+"/xhr_streaming"+a.queryString},onHeartbeat:function(a){a.sendRaw("[]")},sendHeartbeat:function(a){a.sendRaw("h")},onFinished:function(a,b){a.onClose(1006,"Connection interrupted ("+b+")",!1)}};Pusher.HTTP.getStreamingSocket=function(a){return new Pusher.HTTP.Socket(d,a)}}).call(this);
(function(){var d={getReceiveURL:function(a,b){return a.base+"/"+b+"/xhr"+a.queryString},onHeartbeat:function(){},sendHeartbeat:function(a){a.sendRaw("h")},onFinished:function(a,b){if(b===200)a.reconnect();else a.onClose(1006,"Connection interrupted ("+b+")",!1)}};Pusher.HTTP.getPollingSocket=function(a){return new Pusher.HTTP.Socket(d,a)}}).call(this);
