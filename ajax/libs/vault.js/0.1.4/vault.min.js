'use strict';var mode=typeof window==='undefined'?'server':'browser';var Vault=(function(){var Local,Session,Server;var conf={vaultFile:'/.vault.json',vaultData:'__vaultData'};var parse=function(value){if(value===null||value===undefined||value==='undefined'){return undefined;}
if(value==='null'){return null;}
if(value===true||value==='true'){return true;}
if(value===false||value==='false'){return false;}
if(value!==''&&!isNaN(value)){return parseFloat(value);}
if(value.indexOf&&(value.indexOf('{')===0||value.indexOf('[')===0)){return JSON.parse(value);}
return value;};var prepare=function(value){if(typeof value==='object'){return JSON.stringify(value);}
return value;};var getExpires=function(config){if(config.expires.match(/^(\+|\-)\d+\s\w+/)){var expires=new Date();var operator=config.expires.substring(0,1);var parts=config.expires.substring(1).split(' ');var num=parseInt(parts[0],10);var time=parts[1];switch(time){case'millisecond':case'milliseconds':time='Milliseconds';break;case'second':case'seconds':time='Seconds';break;case'minute':case'minutes':time='Minutes';break;case'hour':case'hours':time='Hours';break;case'day':case'days':time='Date';break;case'month':case'months':time='Month';break;case'year':case'years':time='FullYear';break;}
if(operator==='-'){expires['set'+time](expires['get'+time]()-num);}else{expires['set'+time](expires['get'+time]()+num);}
return expires;}
return new Date(config.expires);};var getData=function(storage){var vaultDataDictionary=storage.getItem(conf.vaultData);if(!vaultDataDictionary){vaultDataDictionary={};}
if(typeof vaultDataDictionary==='string'){vaultDataDictionary=JSON.parse(vaultDataDictionary);}
return vaultDataDictionary;};var setKeyMeta=function(storage,key,config){if(key===conf.vaultData){return false;}
config=config||{};var vaultDataDictionary=getData(storage);if(!vaultDataDictionary[key]){vaultDataDictionary[key]={};}
if(config.expires){var expires=getExpires(config);vaultDataDictionary[key].expires=expires&&expires.valueOf();}else{delete vaultDataDictionary[key].expires;}
if(config.path){vaultDataDictionary[key].path=config.path;}else{delete vaultDataDictionary[key].path;}
storage.setItem(conf.vaultData,prepare(vaultDataDictionary));};var getKeyMeta=function(storage,key){if(key===conf.vaultData){return false;}
try{var vaultDataDictionary=getData(storage);return vaultDataDictionary[key];}catch(e){return undefined;}};var clearKeyMeta=function(storage,key){if(key===conf.vaultData){return false;}
try{var vaultDataDictionary=getData(storage);delete vaultDataDictionary[key];storage.setItem(conf.vaultData,prepare(vaultDataDictionary));}catch(e){}};var checkKeyMeta=function(storage,key){if(key===conf.vaultData){return false;}
try{var obj=parse(storage[key]);var keyMeta=getKeyMeta(storage,key);if(keyMeta){if(mode==='browser'&&keyMeta.path){var storagePath=window.location.pathname||window.location.path;if(!storagePath.match(keyMeta.path)){return true;}}
if(!keyMeta.expires&&obj&&obj.expires){keyMeta.expires=obj.expires;}
if(keyMeta.expires&&keyMeta.expires<=new Date()){var expired=new Date(keyMeta.expires).toString();console.log('Removing expired item: '+key+'. It expired on: '+expired);clearKeyMeta(storage,key);storage.removeItem(key);return true;}}}catch(e){console.warn('Vault Error:',e);}
return false;};var setup=function(type){var storage;try{storage=window[type];try{var test=storage['foo'];}catch(e){storage=undefined;}}catch(e){storage=undefined;}
if(!storage){console.warn('Vault: '+type+' is not suppored. I will attempt to use Cookies instead.');return Cookie;}
return{type:type,get:function(key,default_value){var obj;if(storage[key]){var meta=checkKeyMeta(storage,key);if(meta){return default_value;}
if(obj&&obj.value!==undefined){return parse(obj.value);}
return parse(storage[key]);}
return default_value;},getAndRemove:function(key){var value=this.get(key);this.remove(key);return value;},getList:function(){var list=[];for(var i in storage){var item={};item[i]=this.get(i);list.push(item);}
return list;},set:function(key,value,config){try{if(type==='sessionStorage'&&config&&config.expires){delete config.expires;}
setKeyMeta(storage,key,config);return storage.setItem(key,prepare(value));}catch(e){console.warn('Vault: I cannot write to localStoarge even though localStorage is supported. Perhaps you are using your browser in private mode? Here is the error: ',e);}},remove:function(key){clearKeyMeta(storage,key);return storage.removeItem(key);},clear:function(){return storage.clear();},list:function(raw){var i,il=storage.length;if(il===0){console.log('0 items in '+type);return undefined;}
for(i in storage){var value=raw?parse(storage[i]):this.get(i);console.log(i,'=',value);}}};};var Cookie={get:function(cookie,default_value){var cookies=document.cookie.split(';');var cl=cookies.length;for(var c=0;c<cl;c++){var pair=cookies[c].split('=');pair[0]=pair[0].replace(/^[ ]/,'');if(pair[0]===cookie){return parse(pair[1]);}}
return default_value;},getAndRemove:function(key){var value=this.get(key);this.remove(key);return value;},getList:function(){var list=[];if(document.cookie!==''){var cookies=document.cookie.split(';');var cl=cookies.length;for(var c=0;c<cl;c++){var pair=cookies[c].split('=');pair[0]=pair[0].replace(/^[ ]/,'');var item={};item[pair[0]]=parse(pair[1]);list.push(item);}}
return list;},set:function(key,value,config){var expires='';if(config&&config.expires){var exp=getExpires(config);expires='; expires='+exp.toUTCString();}
var max_age='';if(config&&config.max_age){max_age='; max-age='+config.max_age;}
var domain='';if(config&&config.domain){domain='; domain='+config.domain;}
var cookiePath='';if(config&&config.path){cookiePath='; path='+config.path;}
var secure=(config&&config.secure)?'; secure':'';value=prepare(value)+cookiePath+domain+max_age+expires+secure;console.log('Vault: set cookie "'+key+'": '+value);document.cookie=key+'='+value;},remove:function(key){document.cookie=key+'=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';},clear:function(){var cookies=document.cookie.split(';');var cl=cookies.length;for(var c=0;c<cl;c++){var pair=cookies[c].split('=');pair[0]=pair[0].replace(/^[ ]/,'');this.remove(pair[0]);}},list:function(){var cookies=document.cookie.split(';');var cl=cookies.length;if(document.cookie===''||cl===0){console.log('0 cookies');return undefined;}
for(var c=0;c<cl;c++){var pair=cookies[c].split('=');pair[0]=pair[0].replace(/^[ ]/,'');console.log(pair[0],'=',parse(pair[1]));}}};if(mode==='server'){var fs=require('fs');var path=require('path');var appDir=path.dirname();var _file=appDir+conf.vaultFile;var cache;try{cache=fs.readFileSync(_file);}catch(e){fs.writeFileSync(_file,JSON.stringify({},null,2));}
if(cache){try{cache=JSON.parse(cache);}catch(e){}}else{cache={};}
Server={type:'Server',save:function(callback){fs.writeFileSync(_file,JSON.stringify(cache,null,2));},get:function(key,default_value){var meta=checkKeyMeta(this,key);if(meta){return default_value;}
return cache[key]||default_value;},getItem:function(key,default_value){return this.get(key,default_value);},getAndRemove:function(key){var value=cache[key];delete cache[key];this.save();return value;},getList:function(){var list=[];for(var key in cache){var obj={};obj[key]=cache[key];list.push(obj);}
return list;},set:function(key,value,config){cache[key]=value;setKeyMeta(this,key,config);this.save();return cache[key];},setItem:function(key,value,config){return this.set(key,value,config);},remove:function(key){try{delete cache[key];}catch(e){}
this.save();},removeItem:function(key){this.remove(key);},clear:function(){cache={};this.save();},list:function(){for(var key in cache){console.log(key,'=',cache[key]);}}};Cookie=Server;Local=Server;Session=Server;}else{Local=setup('localStorage');Session=setup('sessionStorage');}
var v={conf:conf,Local:Local,Session:Session,Cookie:Cookie,set:function(key,value,config){if(config&&config.expires){return Local.set(key,value,config);}else{return Session.set(key,value,config);}
return Cookie.set(key,value,config);},get:function(key){var sess=Session.get(key);if(sess!==undefined){return sess;}else{var local=Local.get(key);if(local!==undefined){return local;}else{return Cookie.get(key);}}},list:function(raw){if(mode==='server'){console.log('--== Server ==--');return Local.list(raw);}
console.log('--== Local ==--');Local.list(raw);console.log('--== Session ==--');Session.list(raw);console.log('--== Cookie ==--');Cookie.list(raw);},getLists:function(){if(mode==='server'){return Local.getList();}
return{Local:Local.getList(),Session:Session.getList(),Cookie:Cookie.getList()};},remove:function(key){Local.remove(key);Session.remove(key);Cookie.remove(key);},clear:function(){Local.clear();Session.clear();Cookie.clear();}};return v;}());if(typeof module==='object'&&module.exports){module.exports=Vault;}