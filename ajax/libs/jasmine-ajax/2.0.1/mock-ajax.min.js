!function(){function t(t,s,n){n=n||[];for(var r in s)e(n,r)||(t[r]=s[r]);return t}function e(t,e){for(var s=0;s<t.length;s++)if(t[s]===e)return!0;return!1}function s(t){var e=new o,s=new n,u=new r,h=t.XMLHttpRequest,c=i(e,s,u);this.install=function(){t.XMLHttpRequest=c},this.uninstall=function(){t.XMLHttpRequest=h,this.stubs.reset(),this.requests.reset(),u.reset()},this.stubRequest=function(t,e){var n=new a(t,e);return s.addStub(n),n},this.withMock=function(t){this.install();try{t()}finally{this.uninstall()}},this.addCustomParamParser=function(t){u.add(t)},this.requests=e,this.stubs=s}function n(){var t=[];this.addStub=function(e){t.push(e)},this.reset=function(){t=[]},this.findStub=function(e,s){for(var n=t.length-1;n>=0;n--){var r=t[n];if(r.matches(e,s))return r}}}function r(){var t=[{test:function(t){return/^application\/json/.test(t.contentType())},parse:function(t){return JSON.parse(t)}},{test:function(){return!0},parse:function(t){for(var e={},s=t.split("&"),n=0;n<s.length;++n){var r=s[n].replace(/\+/g," ").split("="),i=decodeURIComponent(r[0]);e[i]=e[i]||[],e[i].push(decodeURIComponent(r[1]))}return e}}],e=[];this.add=function(t){e.unshift(t)},this.findParser=function(t){for(var s in e){var n=e[s];if(n.test(t))return n}},this.reset=function(){e=[];for(var s in t)e.push(t[s])},this.reset()}function i(e,s,n){function r(){e.track(this),this.requestHeaders={}}var i=["responseBody","responseText","responseXML","status","statusText","responseTimeout"];return t(r.prototype,new window.XMLHttpRequest,i),t(r.prototype,{open:function(){this.method=arguments[0],this.url=arguments[1],this.username=arguments[3],this.password=arguments[4],this.readyState=1,this.onreadystatechange()},setRequestHeader:function(t,e){this.requestHeaders[t]=e},abort:function(){this.readyState=0,this.status=0,this.statusText="abort",this.onreadystatechange()},readyState:0,onload:function(){},onreadystatechange:function(){},status:null,send:function(t){this.params=t,this.readyState=2,this.onreadystatechange();var e=s.findStub(this.url,t);e&&this.response(e)},contentType:function(){for(var t in this.requestHeaders)if("content-type"===t.toLowerCase())return this.requestHeaders[t]},data:function(){return this.params?n.findParser(this).parse(this.params):{}},getResponseHeader:function(t){return this.responseHeaders[t]},getAllResponseHeaders:function(){var t=[];for(var e in this.responseHeaders)this.responseHeaders.hasOwnProperty(e)&&t.push(e+": "+this.responseHeaders[e]);return t.join("\r\n")},responseText:null,response:function(t){this.status=t.status,this.statusText=t.statusText||"",this.responseText=t.responseText||"",this.readyState=4,this.responseHeaders=t.responseHeaders||{"Content-Type":t.contentType||"application/json"},this.onload(),this.onreadystatechange()},responseTimeout:function(){this.readyState=4,jasmine.clock().tick(3e4),this.onreadystatechange("timeout")}}),r}function o(){var t=[];this.track=function(e){t.push(e)},this.first=function(){return t[0]},this.count=function(){return t.length},this.reset=function(){t=[]},this.mostRecent=function(){return t[t.length-1]},this.at=function(e){return t[e]},this.filter=function(e){if(0==t.length)return[];for(var s=[],n=0;n<t.length;n++)e instanceof RegExp&&e.test(t[n].url)?s.push(t[n]):e instanceof Function&&e(t[n])?s.push(t[n]):t[n].url==e&&s.push(t[n]);return s}}function a(t,e){var s=function(t){return t?t.split("&").sort().join("&"):void 0};if(t instanceof RegExp)this.url=t,this.query=void 0;else{var n=t.split("?");this.url=n[0],this.query=n.length>1?s(n[1]):void 0}this.data=s(e),this.andReturn=function(t){this.status=t.status||200,this.contentType=t.contentType,this.responseText=t.responseText},this.matches=function(t,e){var n=!1;if(t=t.toString(),this.url instanceof RegExp)n=this.url.test(t);else{var r=t.split("?"),i=r[0],o=r[1];n=this.url===i&&this.query===s(o)}return n&&(!this.data||this.data===s(e))}}"undefined"==typeof window&&"object"==typeof exports?(exports.MockAjax=s,jasmine.Ajax=new s(exports)):(window.MockAjax=s,jasmine.Ajax=new s(window))}();