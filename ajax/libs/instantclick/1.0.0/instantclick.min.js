var InstantClick=function(){var m=location.pathname;var i=0;var d={};var b=[];var e=function(){return true};function f(q){var p=q.indexOf("#");if(p==-1){return q}return q.substr(0,p)}function l(p){var q=document.createEvent("HTMLEvents");q.initEvent(p,true,true);dispatchEvent(q)}function a(){return{currentPathname:m,p0:b[0],p1:b[1],pHistory:d,pId:i}}function c(v){var q=document.getElementsByTagName("a"),y,t=location.protocol+"//"+location.host;for(var u=q.length-1;u>=0;u--){y=q[u];if(y.target||y.href.indexOf(t+"/")!=0||y.href.indexOf("#")>-1&&f(y.href)==f(location.href)||y.hasAttribute("data-no-instant")||!e(y.href.substr(t.length),y)){continue}y.addEventListener("mouseover",h);y.addEventListener("click",o)}if(!v){var r=document.getElementsByTagName("script"),x,p,w,s;for(u=r.length-1;u>=0;u--){x=r[u];p=document.createElement("script");if(x.src){p.src=x.src}if(x.innerHTML){p.innerHTML=x.innerHTML}w=x.parentNode;s=x.nextSibling;w.removeChild(x);w.insertBefore(p,s)}}l("page:change")}function h(p){k(p.target.href)}function k(p){var q=i;if(b[i].state=="waiting"){q^=1}b[q].state="preloading";b[q].url=p;b[q].body=false;b[q].timingStart=+new Date;b[q].timing=false;b[q].xhr.open("GET",p,true);b[q].xhr.send()}function g(r){var u=r.target.id;if(b[u].xhr.readyState<4){return}var t=b[u].xhr.responseText;b[u].timing=+new Date-b[u].timingStart;var s=t.indexOf("<body");if(s>-1){b[u].body=t.substr(t.indexOf(">",s)+1);var p=b[u].body.indexOf("</body");if(p>-1){b[u].body=b[u].body.substr(0,p)}b[u].body=b[u].body.replace(/<script[^>]+data-no-instant[^>]*>[\s\S]*<\/script>/ig,"")}var q=t.indexOf("<title");if(q>-1){b[u].title=t.substr(t.indexOf(">",q)+1);b[u].title=b[u].title.substr(0,b[u].title.indexOf("</title"))}d[f(b[u].url)]={body:b[u].body,title:b[u].title};if(u==i&&b[i].state=="waiting"){j(b[i].url)}}function o(p){if(p.which>1||p.metaKey||p.ctrlKey){return}p.preventDefault();j(p.target.href)}function j(p){if(b[i].url!=p){if(b[i^1].url!=p){throw new Error("Clicked on a link without hovering on it first")}else{i^=1}}if(!b[i].body){b[i].state="waiting";return}b[i].state="displayed";document.body.innerHTML=b[i].body;document.title=b[i].title;if(b[i].url!=location.href){if(b[i].url.indexOf("#")==-1){scrollTo(0,0)}else{var q=b[i].url.substr(b[i].url.indexOf("#")+1);if(document.getElementById(q)||document.getElementsByName(q).length>0){q=document.getElementById(q)||document.getElementsByTagName(q)[0];var r=0;for(;q.offsetParent;q=q.offsetParent){r+=q.offsetTop}scrollTo(0,r)}else{scrollTo(0,0)}}history.pushState(null,null,b[i].url)}m=location.pathname;c()}function n(){if(!("pushState" in history)){return}if(b.length){return}if(0 in arguments){e=arguments[0]}d[f(location.href)]={body:document.body.innerHTML,title:document.title};for(var p=0;p<2;p++){b[p]={};b[p].xhr=new XMLHttpRequest();b[p].xhr.id=p;b[p].xhr.addEventListener("readystatechange",g);b[p].url=false;b[p].body=false;b[p].title=false;b[p].state="";b[p].timingStart=false;b[p].timing=false}c(true);addEventListener("popstate",function(){if(m==location.pathname){return}var q=f(location.href);if(!(q in d)){location.href=location.href;return}m=location.pathname;document.body.innerHTML=d[q].body;document.title=d[q].title;c()})}return{init:n,debug:a}}();