var InstantClick=function(s,a){var e;var m;var B;var o={};var r={};var x;var c;var h;var t={change:[]};function d(D){var p=D.indexOf("#");if(p==-1){return D}return D.substr(0,p)}function z(p){while(p.nodeName!="A"){p=p.parentNode}return p}function b(D){for(var p=0;p<t[D].length;p++){t[D][p]()}}function i(p){var D=s.implementation.createHTMLDocument("");D.documentElement.innerHTML=p;s.documentElement.replaceChild(D.body,s.body)}function v(p){n(z(p.target).href)}function C(D){var p=z(D.target);p.addEventListener("mouseout",A);if(!h){n(p.href)}else{m=p.href;B=setTimeout(n,h)}}function u(p){if(p.which>1||p.metaKey||p.ctrlKey){return}p.preventDefault();w(z(p.target).href)}function A(){if(B){clearTimeout(B);B=false;return}if(!r.isPreloading||(r.isPreloading&&r.isWaitingForCompletion)){return}r.xhr.abort();r.isPreloading=false;r.isWaitingForCompletion=false}function l(F){if(r.xhr.readyState<4){return}if(r.xhr.status==0){return}r.timing.ready=+new Date-r.timing.start;var H=r.xhr.responseText;var E=H.indexOf("<title");if(E>-1){r.title=H.substr(H.indexOf(">",E)+1);r.title=r.title.substr(0,r.title.indexOf("</title"))}var G=H.indexOf("<body");if(G>-1){r.body=H.substr(G);var p=r.body.indexOf("</body");if(p>-1){r.body=r.body.substr(0,p)}var D=d(r.url);o[D]={body:r.body,title:r.title,scrollY:D in o?o[D].scrollY:0}}else{r.hasBody=false}if(r.isWaitingForCompletion){r.isWaitingForCompletion=false;w(r.url)}}function g(L){var D=s.getElementsByTagName("a"),K,G=a.protocol+"//"+a.host;for(var H=D.length-1;H>=0;H--){K=D[H];if(K.target||K.hasAttribute("download")||K.href.indexOf(G+"/")!=0||K.href.indexOf("#")>-1&&d(K.href)==e||(x?K.hasAttribute("data-no-instant"):!K.hasAttribute("data-instant"))){continue}if(c){K.addEventListener("mousedown",v)}else{K.addEventListener("mouseover",C)}K.addEventListener("click",u)}if(!L){var E=s.getElementsByTagName("script"),J,p,I,F;for(H=0,j=E.length;H<j;H++){J=E[H];if(J.hasAttribute("data-no-instant")){continue}p=s.createElement("script");if(J.src){p.src=J.src}if(J.innerHTML){p.innerHTML=J.innerHTML}I=J.parentNode;F=J.nextSibling;I.removeChild(J);I.insertBefore(p,F)}}b("change")}function n(p){if(!c&&"display" in r.timing&&+new Date-(r.timing.start+r.timing.display)<100){return}if(B){clearTimeout(B);B=false}if(!p){p=m}if((r.isPreloading&&p==r.url)||(r.isPreloading&&r.isWaitingForCompletion)){return}r.isPreloading=true;r.isWaitingForCompletion=false;r.url=p;r.body=false;r.hasBody=true;r.timing={};r.timing.start=+new Date;r.xhr.open("GET",p);r.xhr.send()}function w(D){if(!("display" in r.timing)){r.timing.display=+new Date-r.timing.start}if(B){if(r.url&&r.url!=D){a.href=D;return}n(D);r.isWaitingForCompletion=true;return}if(!r.isPreloading||(r.isPreloading&&r.isWaitingForCompletion)){a.href=D;return}if(!r.hasBody){a.href=r.url;return}if(!r.body){r.isWaitingForCompletion=true;return}o[e].scrollY=pageYOffset;r.isPreloading=false;r.isWaitingForCompletion=false;i(r.body);s.title=r.title;var E=r.url.indexOf("#");var p=E>-1&&s.getElementById(r.url.substr(E+1));var F=0;if(r.url!=a.href&&p){for(;p.offsetParent;p=p.offsetParent){F+=p.offsetTop}}scrollTo(0,F);history.pushState(null,null,r.url);e=d(a.href);g()}var f="pushState" in history;function y(){if(!f){b("change");return}if(e){return}for(var D=0;D<arguments.length;D++){var p=arguments[D];if(p===true){x=true}else{if(p=="mousedown"){c=true}else{if(typeof p=="number"){h=p}}}}e=d(a.href);o[e]={body:s.body.outerHTML,title:s.title,scrollY:pageYOffset};r.xhr=new XMLHttpRequest();r.xhr.addEventListener("readystatechange",l);r.url=false;r.body=false;r.hasBody=true;r.title=false;r.isPreloading=false;r.isWaitingForCompletion=false;r.timing={};g(true);addEventListener("popstate",function(){var E=d(a.href);if(E==e){return}if(!(E in o)){a.href=a.href;return}o[e].scrollY=pageYOffset;e=E;i(o[E].body);scrollTo(0,o[E].scrollY);s.title=o[E].title;g()})}function k(p,D){t[p].push(D)}function q(){return{currentLocationWithoutHash:e,p:r,pHistory:o,supported:f,useBlacklist:x}}return{supported:f,init:y,on:k,debug:q}}(document,location);