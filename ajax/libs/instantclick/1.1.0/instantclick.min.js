var InstantClick=function(){var c;var o=0;var i={};var l=[];var d="pushState" in history;var s=false;var m={change:[]};function b(w){var p=w.indexOf("#");if(p==-1){return w}return w.substr(0,p)}function u(p){while(p.nodeName!="A"){p=p.parentNode}return p}function f(p,w){m[p].push(w)}function a(w){for(var p=0;p<m[w].length;p++){m[w][p]()}}function k(){return{currentLocationWithoutHash:c,p0:l[0],p1:l[1],pHistory:i,pId:o,supported:d,useBlacklist:s}}function e(E){var w=document.getElementsByTagName("a"),D,z=location.protocol+"//"+location.host;for(var A=w.length-1;A>=0;A--){D=w[A];if(D.target||D.href.indexOf(z+"/")!=0||D.href.indexOf("#")>-1&&b(D.href)==b(location.href)||(s?D.hasAttribute("data-no-instant"):!D.hasAttribute("data-instant"))){continue}D.addEventListener("mouseover",q);D.addEventListener("click",n)}if(!E){var x=document.getElementsByTagName("script"),C,p,B,y;for(A=0,j=x.length;A<j;A++){C=x[A];if(C.hasAttribute("data-no-instant")){continue}p=document.createElement("script");if(C.src){p.src=C.src}if(C.innerHTML){p.innerHTML=C.innerHTML}B=C.parentNode;y=C.nextSibling;B.removeChild(C);B.insertBefore(p,y)}}a("change")}function q(w){var p=u(w.target);p.addEventListener("mouseout",v);h(p.href)}function h(p){var w=o;if(l[o].state=="waiting"){w^=1}l[w].state="preloading";l[w].url=p;l[w].body=false;l[w].hasBody=true;l[w].timingStart=+new Date;l[w].timing=false;l[w].xhr.open("GET",p,true);l[w].xhr.send()}function g(x){var A=x.target.id;if(l[A].xhr.readyState<4){return}var z=l[A].xhr.responseText;l[A].timing=+new Date-l[A].timingStart;var w=z.indexOf("<title");if(w>-1){l[A].title=z.substr(z.indexOf(">",w)+1);l[A].title=l[A].title.substr(0,l[A].title.indexOf("</title"))}var y=z.indexOf("<body");if(y>-1){l[A].body=z.substr(z.indexOf(">",y)+1);var p=l[A].body.indexOf("</body");if(p>-1){l[A].body=l[A].body.substr(0,p)}i[b(l[A].url)]={body:l[A].body,title:l[A].title}}else{l[A].hasBody=false}if(A==o&&l[o].state=="waiting"){r(l[o].url)}}function n(p){if(p.which>1||p.metaKey||p.ctrlKey){return}p.preventDefault();r(u(p.target).href)}function r(p){if(l[o].url!=p){if(l[o^1].url==p){o^=1}}if(!l[o].body){if(!l[o].hasBody){location.href=l[o].url;return}l[o].state="waiting";return}l[o].state="displayed";document.body.innerHTML=l[o].body;document.title=l[o].title;if(l[o].url!=location.href){if(l[o].url.indexOf("#")==-1){scrollTo(0,0)}else{var w=l[o].url.substr(l[o].url.indexOf("#")+1);if(document.getElementById(w)||document.getElementsByName(w).length>0){w=document.getElementById(w)||document.getElementsByTagName(w)[0];var x=0;for(;w.offsetParent;w=w.offsetParent){x+=w.offsetTop}scrollTo(0,x)}else{scrollTo(0,0)}}history.pushState(null,null,l[o].url)}c=b(location.href);e()}function v(w){var p=u(w.target);var x=o;if(l[x].url!=p.href&&l[x^1].url==p.href){x^=1}if(l[x].state!="preloading"){return}l[x].xhr.abort();l[x].state=""}function t(w){if(!d){a("change");return}if(l.length){return}if(w){s=true}c=b(location.href);i[b(location.href)]={body:document.body.innerHTML,title:document.title};for(var p=0;p<2;p++){l[p]={};l[p].xhr=new XMLHttpRequest();l[p].xhr.id=p;l[p].xhr.addEventListener("readystatechange",g);l[p].url=false;l[p].body=false;l[p].hasBody=true;l[p].title=false;l[p].state="";l[p].timingStart=false;l[p].timing=false}e(true);addEventListener("popstate",function(){var x=b(location.href);if(x==c){return}if(!(x in i)){location.href=location.href;return}c=x;document.body.innerHTML=i[x].body;document.title=i[x].title;e()})}return{init:t,supported:d,on:f,debug:k}}();