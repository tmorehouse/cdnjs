!function(e){var t=e.define,n=e.require,s=e.Ember;"undefined"==typeof s&&"undefined"!=typeof n&&(s=n("ember")),s.libraries.register("Ember Simple Auth OAuth 2.0","0.7.2"),t("simple-auth-oauth2/authenticators/oauth2",["simple-auth/authenticators/base","./../configuration","exports"],function(e,t,n){"use strict";var r=e["default"],i=t["default"];n["default"]=r.extend({serverTokenEndpoint:"/token",serverTokenRevocationEndpoint:null,refreshAccessTokens:!0,_refreshTokenTimeout:null,init:function(){this.serverTokenEndpoint=i.serverTokenEndpoint,this.serverTokenRevocationEndpoint=i.serverTokenRevocationEndpoint,this.refreshAccessTokens=i.refreshAccessTokens},restore:function(e){var t=this;return new s.RSVP.Promise(function(n,r){var i=(new Date).getTime();!s.isEmpty(e.expires_at)&&e.expires_at<i?t.refreshAccessTokens?t.refreshAccessToken(e.expires_in,e.refresh_token).then(function(e){n(e)},r):r():s.isEmpty(e.access_token)?r():(t.scheduleAccessTokenRefresh(e.expires_in,e.expires_at,e.refresh_token),n(e))})},authenticate:function(e){var t=this;return new s.RSVP.Promise(function(n,r){var i={grant_type:"password",username:e.identification,password:e.password};if(!s.isEmpty(e.scope)){var o=s.makeArray(e.scope).join(" ");s.merge(i,{scope:o})}t.makeRequest(t.serverTokenEndpoint,i).then(function(e){s.run(function(){var r=t.absolutizeExpirationTime(e.expires_in);t.scheduleAccessTokenRefresh(e.expires_in,r,e.refresh_token),s.isEmpty(r)||(e=s.merge(e,{expires_at:r})),n(e)})},function(e){s.run(function(){r(e.responseJSON||e.responseText)})})})},invalidate:function(e){function t(e){s.run.cancel(n._refreshTokenTimeout),delete n._refreshTokenTimeout,e()}var n=this;return new s.RSVP.Promise(function(r){if(s.isEmpty(n.serverTokenRevocationEndpoint))t(r);else{var i=[];s.A(["access_token","refresh_token"]).forEach(function(t){s.isEmpty(e[t])||i.push(n.makeRequest(n.serverTokenRevocationEndpoint,{token_type_hint:t,token:e[t]}))}),s.$.when.apply(s.$,i).always(function(){t(r)})}})},makeRequest:function(e,t){return s.$.ajax({url:e,type:"POST",data:t,dataType:"json",contentType:"application/x-www-form-urlencoded"})},scheduleAccessTokenRefresh:function(e,t,n){if(this.refreshAccessTokens){var r=(new Date).getTime();s.isEmpty(t)&&!s.isEmpty(e)&&(t=new Date(r+1e3*e).getTime());var i=1e3*(Math.floor(5*Math.random())+5);!s.isEmpty(n)&&!s.isEmpty(t)&&t>r-i&&(s.run.cancel(this._refreshTokenTimeout),delete this._refreshTokenTimeout,s.testing||(this._refreshTokenTimeout=s.run.later(this,this.refreshAccessToken,e,n,t-r-i)))}},refreshAccessToken:function(e,t){var n=this,r={grant_type:"refresh_token",refresh_token:t};return new s.RSVP.Promise(function(i,o){n.makeRequest(n.serverTokenEndpoint,r).then(function(r){s.run(function(){e=r.expires_in||e,t=r.refresh_token||t;var o=n.absolutizeExpirationTime(e),a=s.merge(r,{expires_in:e,expires_at:o,refresh_token:t});n.scheduleAccessTokenRefresh(e,null,t),n.trigger("sessionDataUpdated",a),i(a)})},function(e,t,n){s.Logger.warn("Access token could not be refreshed - server responded with "+n+"."),o()})})},absolutizeExpirationTime:function(e){return s.isEmpty(e)?void 0:new Date((new Date).getTime()+1e3*e).getTime()}})}),t("simple-auth-oauth2/authorizers/oauth2",["simple-auth/authorizers/base","exports"],function(e,t){"use strict";var n=e["default"];t["default"]=n.extend({authorize:function(e){var t=this.get("session.access_token");this.get("session.isAuthenticated")&&!s.isEmpty(t)&&e.setRequestHeader("Authorization","Bearer "+t)}})}),t("simple-auth-oauth2/configuration",["simple-auth/utils/load-config","exports"],function(e,t){"use strict";var n=e["default"],s={serverTokenEndpoint:"/token",serverTokenRevocationEndpoint:null,refreshAccessTokens:!0};t["default"]={serverTokenEndpoint:s.serverTokenEndpoint,serverTokenRevocationEndpoint:s.serverTokenRevocationEndpoint,refreshAccessTokens:s.refreshAccessTokens,load:n(s)}}),t("simple-auth-oauth2/ember",["./initializer"],function(e){"use strict";var t=e["default"];s.onLoad("Ember.Application",function(e){e.initializer(t)})}),t("simple-auth-oauth2/initializer",["./configuration","simple-auth/utils/get-global-config","simple-auth-oauth2/authenticators/oauth2","simple-auth-oauth2/authorizers/oauth2","exports"],function(e,t,n,s,r){"use strict";var i=e["default"],o=t["default"],a=n["default"],u=s["default"];r["default"]={name:"simple-auth-oauth2",before:"simple-auth",initialize:function(e){var t=o("simple-auth-oauth2");i.load(e,t),e.register("simple-auth-authorizer:oauth2-bearer",u),e.register("simple-auth-authenticator:oauth2-password-grant",a)}}})}(this);