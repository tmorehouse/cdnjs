(function(e){Ember.libraries.register("Ember Simple Auth OAuth 2.0","0.7.3");var t,r;(function(){var e={},i={};t=function(t,r,i){e[t]={deps:r,callback:i}};r=function(t){if(i.hasOwnProperty(t)){return i[t]}i[t]={};if(!e[t]){throw new Error("Could not find module "+t)}var n=e[t],s=n.deps,o=n.callback,a=[],u;for(var h=0,c=s.length;h<c;h++){if(s[h]==="exports"){a.push(u={})}else{a.push(r(l(s[h])))}}var f=o.apply(this,a);return i[t]=u||f;function l(e){if(e.charAt(0)!=="."){return e}var r=e.split("/");var i=t.split("/").slice(0,-1);for(var n=0,s=r.length;n<s;n++){var o=r[n];if(o===".."){i.pop()}else if(o==="."){continue}else{i.push(o)}}return i.join("/")}};r.registry=e})();t("simple-auth-oauth2/authenticators/oauth2",["simple-auth/authenticators/base","./../configuration","exports"],function(e,t,r){"use strict";var i=e["default"];var n=t["default"];r["default"]=i.extend({serverTokenEndpoint:"/token",serverTokenRevocationEndpoint:null,refreshAccessTokens:true,_refreshTokenTimeout:null,init:function(){this.serverTokenEndpoint=n.serverTokenEndpoint;this.serverTokenRevocationEndpoint=n.serverTokenRevocationEndpoint;this.refreshAccessTokens=n.refreshAccessTokens},restore:function(e){var t=this;return new Ember.RSVP.Promise(function(r,i){var n=(new Date).getTime();if(!Ember.isEmpty(e.expires_at)&&e.expires_at<n){if(t.refreshAccessTokens){t.refreshAccessToken(e.expires_in,e.refresh_token).then(function(e){r(e)},i)}else{i()}}else{if(Ember.isEmpty(e.access_token)){i()}else{t.scheduleAccessTokenRefresh(e.expires_in,e.expires_at,e.refresh_token);r(e)}}})},authenticate:function(e){var t=this;return new Ember.RSVP.Promise(function(r,i){var n={grant_type:"password",username:e.identification,password:e.password};if(!Ember.isEmpty(e.scope)){var s=Ember.makeArray(e.scope).join(" ");Ember.merge(n,{scope:s})}t.makeRequest(t.serverTokenEndpoint,n).then(function(e){Ember.run(function(){var i=t.absolutizeExpirationTime(e.expires_in);t.scheduleAccessTokenRefresh(e.expires_in,i,e.refresh_token);if(!Ember.isEmpty(i)){e=Ember.merge(e,{expires_at:i})}r(e)})},function(e,t,r){Ember.run(function(){i(e.responseJSON||e.responseText)})})})},invalidate:function(e){var t=this;function r(e){Ember.run.cancel(t._refreshTokenTimeout);delete t._refreshTokenTimeout;e()}return new Ember.RSVP.Promise(function(i,n){if(!Ember.isEmpty(t.serverTokenRevocationEndpoint)){var s=[];Ember.A(["access_token","refresh_token"]).forEach(function(r){if(!Ember.isEmpty(e[r])){s.push(t.makeRequest(t.serverTokenRevocationEndpoint,{token_type_hint:r,token:e[r]}))}});Ember.$.when.apply(Ember.$,s).always(function(e){r(i)})}else{r(i)}})},makeRequest:function(e,t){return Ember.$.ajax({url:e,type:"POST",data:t,dataType:"json",contentType:"application/x-www-form-urlencoded"})},scheduleAccessTokenRefresh:function(e,t,r){var i=this;if(this.refreshAccessTokens){var n=(new Date).getTime();if(Ember.isEmpty(t)&&!Ember.isEmpty(e)){t=new Date(n+e*1e3).getTime()}var s=(Math.floor(Math.random()*5)+5)*1e3;if(!Ember.isEmpty(r)&&!Ember.isEmpty(t)&&t>n-s){Ember.run.cancel(this._refreshTokenTimeout);delete this._refreshTokenTimeout;if(!Ember.testing){this._refreshTokenTimeout=Ember.run.later(this,this.refreshAccessToken,e,r,t-n-s)}}}},refreshAccessToken:function(e,t){var r=this;var i={grant_type:"refresh_token",refresh_token:t};return new Ember.RSVP.Promise(function(n,s){r.makeRequest(r.serverTokenEndpoint,i).then(function(i){Ember.run(function(){e=i.expires_in||e;t=i.refresh_token||t;var s=r.absolutizeExpirationTime(e);var o=Ember.merge(i,{expires_in:e,expires_at:s,refresh_token:t});r.scheduleAccessTokenRefresh(e,null,t);r.trigger("sessionDataUpdated",o);n(o)})},function(e,t,r){Ember.Logger.warn("Access token could not be refreshed - server responded with "+r+".");s()})})},absolutizeExpirationTime:function(e){if(!Ember.isEmpty(e)){return new Date((new Date).getTime()+e*1e3).getTime()}}})});t("simple-auth-oauth2/authorizers/oauth2",["simple-auth/authorizers/base","exports"],function(e,t){"use strict";var r=e["default"];t["default"]=r.extend({authorize:function(e,t){var r=this.get("session.access_token");if(this.get("session.isAuthenticated")&&!Ember.isEmpty(r)){e.setRequestHeader("Authorization","Bearer "+r)}}})});t("simple-auth-oauth2/configuration",["simple-auth/utils/load-config","exports"],function(e,t){"use strict";var r=e["default"];var i={serverTokenEndpoint:"/token",serverTokenRevocationEndpoint:null,refreshAccessTokens:true};t["default"]={serverTokenEndpoint:i.serverTokenEndpoint,serverTokenRevocationEndpoint:i.serverTokenRevocationEndpoint,refreshAccessTokens:i.refreshAccessTokens,load:r(i)}});t("simple-auth-oauth2/ember",["./initializer"],function(e){"use strict";var t=e["default"];Ember.onLoad("Ember.Application",function(e){e.initializer(t)})});t("simple-auth-oauth2/initializer",["./configuration","simple-auth/utils/get-global-config","simple-auth-oauth2/authenticators/oauth2","simple-auth-oauth2/authorizers/oauth2","exports"],function(e,t,r,i,n){"use strict";var s=e["default"];var o=t["default"];var a=r["default"];var u=i["default"];n["default"]={name:"simple-auth-oauth2",before:"simple-auth",initialize:function(e,t){var r=o("simple-auth-oauth2");s.load(e,r);e.register("simple-auth-authorizer:oauth2-bearer",u);e.register("simple-auth-authenticator:oauth2-password-grant",a)}}});t("simple-auth/authenticators/base",["exports"],function(t){t["default"]=e.SimpleAuth.Authenticators.Base});t("simple-auth/authorizers/base",["exports"],function(t){t["default"]=e.SimpleAuth.Authorizers.Base});t("simple-auth/utils/get-global-config",["exports"],function(t){t["default"]=e.SimpleAuth.Utils.getGlobalConfig});t("simple-auth/utils/load-config",["exports"],function(t){t["default"]=e.SimpleAuth.Utils.loadConfig});var i=r("simple-auth-oauth2/initializer")["default"];var n=r("simple-auth-oauth2/configuration")["default"];var s=r("simple-auth-oauth2/authenticators/oauth2")["default"];var o=r("simple-auth-oauth2/authorizers/oauth2")["default"];e.SimpleAuth.Configuration.OAuth2=n;e.SimpleAuth.Authenticators.OAuth2=s;e.SimpleAuth.Authorizers.OAuth2=o;r("simple-auth-oauth2/ember")})(typeof global!=="undefined"?global:window);