!function(t){function e(e,r){var s=r.Canvas;null==i&&(n=s.prototype.getTextInfo,o=s.prototype.addText,i=s.prototype.render),s.prototype.render=function(){if(!e.getOptions().canvas)return i.call(this);var t=this.context,n=this._textCache;t.save(),t.textBaseline="middle";for(var o in n)if(a.call(n,o)){var r=n[o];for(var s in r)if(a.call(r,s)){var l=r[s],h=!0;for(var f in l)if(a.call(l,f)){var c=l[f];if(!c.active){delete l[f];continue}h&&(t.fillStyle=c.font.color,t.font=c.font.definition,h=!1);for(var v=c.lines,p=0;p<v.length;++p){var g=v[p];t.fillText(g.text,g.x,g.y)}}}}t.restore()},s.prototype.getTextInfo=function(i,o,r,a){if(!e.getOptions().canvas)return n.call(this,i,o,r,a);var s,l,h,f;if(o=""+o,s="object"==typeof r?r.style+" "+r.variant+" "+r.weight+" "+r.size+"px "+r.family:r,l=this._textCache[i],null==l&&(l=this._textCache[i]={}),h=l[s],null==h&&(h=l[s]={}),f=h[o],null==f){var c=this.context;if("object"!=typeof r){var v=t("<div>&nbsp;</div>").css("position","absolute").addClass("string"==typeof r?r:null).appendTo(this.getTextLayer(i));r={lineHeight:v.height(),style:v.css("font-style"),variant:v.css("font-variant"),weight:v.css("font-weight"),family:v.css("font-family"),color:v.css("color")},r.size=v.css("line-height",1).height(),v.remove()}s=r.style+" "+r.variant+" "+r.weight+" "+r.size+"px "+r.family,f=h[o]={width:0,height:0,active:!1,lines:[],font:{definition:s,color:r.color}},c.save(),c.font=s;for(var p=(o+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n"),g=0;g<p.length;++g){var d=p[g],y=c.measureText(d);f.width=Math.max(y.width,f.width),f.height+=r.lineHeight,f.lines.push({text:d,width:y.width,height:r.lineHeight})}c.restore()}return f},s.prototype.addText=function(t,i,n,r,a,s,l,h){if(!e.getOptions().canvas)return o.call(this,t,i,n,r,a,s,l,h);var f=this.getTextInfo(t,r,a,s),c=f.lines;f.active=!0,n+=f.height/c.length/2,n=Math.round("middle"==h?n-f.height/2:"bottom"==h?n-f.height:n),window.opera&&window.opera.version().split(".")[0]<12&&(n-=2);for(var v=0;v<c.length;++v){var p=c[v];p.y=n,n+=p.height,p.x=Math.round("center"==l?i-p.width/2:"right"==l?i-p.width:i)}}}var i,n,o,r={canvas:!0},a=Object.prototype.hasOwnProperty;t.plot.plugins.push({init:e,options:r,name:"canvas",version:"1.0"})}(jQuery);