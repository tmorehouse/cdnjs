!function(e){function t(t){function o(e){f.active&&(t.getPlaceholder().trigger("plotselecting",[n()]),l(e))}function s(t){1==t.which&&(document.body.focus(),void 0!==document.onselectstart&&null==g.onselectstart&&(g.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==g.ondrag&&(g.ondrag=document.ondrag,document.ondrag=function(){return!1}),c(f.first,t),f.active=!0,e(document).one("mouseup",i))}function i(e){return void 0!==document.onselectstart&&(document.onselectstart=g.onselectstart),void 0!==document.ondrag&&(document.ondrag=g.ondrag),f.active=!1,l(e),u()?r():(t.getPlaceholder().trigger("plotunselected",[]),t.getPlaceholder().trigger("plotselecting",[null])),!1}function n(){if(!u())return null;var e=Math.min(f.first.x,f.second.x),o=Math.max(f.first.x,f.second.x),s=Math.max(f.first.y,f.second.y),i=Math.min(f.first.y,f.second.y),n={},r=t.getAxes();return r.xaxis.used&&(n.xaxis={from:r.xaxis.c2p(e),to:r.xaxis.c2p(o)}),r.x2axis.used&&(n.x2axis={from:r.x2axis.c2p(e),to:r.x2axis.c2p(o)}),r.yaxis.used&&(n.yaxis={from:r.yaxis.c2p(s),to:r.yaxis.c2p(i)}),r.y2axis.used&&(n.y2axis={from:r.y2axis.c2p(s),to:r.y2axis.c2p(i)}),n}function r(){var e=n();t.getPlaceholder().trigger("plotselected",[e]);var o=t.getAxes();o.xaxis.used&&o.yaxis.used&&t.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function a(e,t,o){return e>t?e:t>o?o:t}function c(e,o){var s=t.getOptions(),i=t.getPlaceholder().offset(),n=t.getPlotOffset();e.x=a(0,o.pageX-i.left-n.left,t.width()),e.y=a(0,o.pageY-i.top-n.top,t.height()),"y"==s.selection.mode&&(e.x=e==f.first?0:t.width()),"x"==s.selection.mode&&(e.y=e==f.first?0:t.height())}function l(e){null!=e.pageX&&(c(f.second,e),u()?(f.show=!0,t.triggerRedrawOverlay()):x(!0))}function x(e){f.show&&(f.show=!1,t.triggerRedrawOverlay(),e||t.getPlaceholder().trigger("plotunselected",[]))}function d(e,o){var s,i,n=t.getAxes(),a=t.getOptions();"y"==a.selection.mode?(f.first.x=0,f.second.x=t.width()):(s=e.xaxis?n.xaxis:e.x2axis?n.x2axis:n.xaxis,i=e.xaxis||e.x2axis||{from:e.x1,to:e.x2},f.first.x=s.p2c(Math.min(i.from,i.to)),f.second.x=s.p2c(Math.max(i.from,i.to))),"x"==a.selection.mode?(f.first.y=0,f.second.y=t.height()):(s=e.yaxis?n.yaxis:e.y2axis?n.y2axis:n.yaxis,i=e.yaxis||e.y2axis||{from:e.y1,to:e.y2},f.first.y=s.p2c(Math.min(i.from,i.to)),f.second.y=s.p2c(Math.max(i.from,i.to))),f.show=!0,t.triggerRedrawOverlay(),o||r()}function u(){var e=5;return Math.abs(f.second.x-f.first.x)>=e&&Math.abs(f.second.y-f.first.y)>=e}var f={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},g={};t.clearSelection=x,t.setSelection=d,t.getSelection=n,t.hooks.bindEvents.push(function(e,t){var i=e.getOptions();null!=i.selection.mode&&t.mousemove(o),null!=i.selection.mode&&t.mousedown(s)}),t.hooks.drawOverlay.push(function(t,o){if(f.show&&u()){var s=t.getPlotOffset(),i=t.getOptions();o.save(),o.translate(s.left,s.top);var n=e.color.parse(i.selection.color);o.strokeStyle=n.scale("a",.8).toString(),o.lineWidth=1,o.lineJoin="round",o.fillStyle=n.scale("a",.4).toString();var r=Math.min(f.first.x,f.second.x),a=Math.min(f.first.y,f.second.y),c=Math.abs(f.second.x-f.first.x),l=Math.abs(f.second.y-f.first.y);o.fillRect(r,a,c,l),o.strokeRect(r,a,c,l),o.restore()}})}e.plot.plugins.push({init:t,options:{selection:{mode:null,color:"#e8cfac"}},name:"selection",version:"1.0"})}(jQuery);