!function(t){function e(e,a){var s=a.Canvas;null==i&&(n=s.prototype.getTextInfo,o=s.prototype.addText,i=s.prototype.render),s.prototype.render=function(){if(!e.getOptions().canvas)return i.call(this);var t=this.context,n=this._textCache;t.save();for(var o in n)if(r.call(n,o)){var a=n[o];for(var s in a)if(r.call(a,s)){var l=a[s],h=!0;for(var f in l)if(r.call(l,f)){var c=l[f];if(!c.active){delete l[f];continue}var p=c.x,v=c.y,y=c.lines,d=c.halign;h&&(t.fillStyle=c.font.color,t.font=c.font.definition,h=!1),t.textBaseline="top";for(var g=0;g<y.length;++g){var u=y[g],x=p;"center"==d?x-=u.width/2:"right"==d&&(x-=u.width),window.opera&&window.opera.version().split(".")[0]<12&&(x=Math.floor(x),v=Math.ceil(v-2)),t.fillText(u.text,x,v),v+=u.height}}}}t.restore()},s.prototype.getTextInfo=function(i,o,a,r){if(!e.getOptions().canvas)return n.call(this,i,o,a,r);var s,l,h,f;if(o=""+o,s="object"==typeof a?a.style+" "+a.variant+" "+a.weight+" "+a.size+"px "+a.family:a,l=this._textCache[i],null==l&&(l=this._textCache[i]={}),h=l[s],null==h&&(h=l[s]={}),f=h[o],null==f){var c=this.context;if("object"!=typeof a){var p=t("<div></div>").html(o).addClass("string"==typeof a?a:null).css({position:"absolute",top:-9999}).appendTo(this.getTextLayer(i));a={style:p.css("font-style"),variant:p.css("font-variant"),weight:p.css("font-weight"),size:parseInt(p.css("font-size"),10),family:p.css("font-family"),color:p.css("color")},p.remove()}s=a.style+" "+a.variant+" "+a.weight+" "+a.size+"px "+a.family,f=h[o]={x:null,y:null,width:0,height:0,active:!1,lines:[],font:{definition:s,color:a.color}},c.save(),c.font=s;for(var v=(o+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n"),y=0;y<v.length;++y){var d,g,u=v[y],x=c.measureText(u);d=x.width,g=x.height||a.size,g+=Math.round(.15*a.size),f.width=Math.max(d,f.width),f.height+=g,f.lines.push({text:u,width:d,height:g})}c.restore()}return f},s.prototype.addText=function(t,i,n,a,r,s,l,h){if(!e.getOptions().canvas)return o.call(this,t,i,n,a,r,s,l,h);var f=this.getTextInfo(t,a,r,s);f.x=i,f.y=n,f.active=!0,f.halign=l,"middle"==h?f.y=n-f.height/2:"bottom"==h&&(f.y=n-f.height)}}var i,n,o,a={canvas:!0},r=Object.prototype.hasOwnProperty;t.plot.plugins.push({init:e,options:a,name:"canvas",version:"1.0"})}(jQuery);