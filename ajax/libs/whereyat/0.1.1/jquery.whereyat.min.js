/*! Where Y'at - v0.1.0 - 2014-12-24
* https://github.com/zshannon/whereyat
* Copyright (c) 2014 Zane Shannon; Licensed MIT */
!function(a){var b;b=function(b,c){this.error=!1,this.options=a.extend({},b),this.completion=c,this.nodes=[],this.parse(),this.render()},b.prototype.locate=function(){a.ajax({method:"GET",url:"https://ip.wherey.at/",success:function(a){return function(b){"ok"===b.status?(a.location={lat:b.latitude,lng:b.longitude},a.render()):a.render("not_found"===b.status?{error:!0}:{error:!0})}}(this),error:function(a){return function(){a.render({error:!0})}}(this)})},b.prototype.parse=function(){a(this.options.className).each(function(a){return function(b,c){return a.nodes.push(c)}}(this))},b.prototype.render=function(b){return null==b&&(b={}),null!=this.location||b.error?(a(this.nodes).each(function(c){return function(d,e){var f,g,h,i,j,k,l;if(f=a(e),f.removeClass(""+c.options.classPrefix+"locating"),b.error)return f.addClass(""+c.options.classPrefix+"error");j={lat:f.data(c.options.latitudeData),lng:f.data(c.options.longitudeData)},k=c.distance(j,c.location),h=c.options.maxDistance,l=c.options.distances;for(i in l)if(g=l[i],g>=k){h=i;break}return f.addClass(""+c.options.classPrefix+h)}}(this)),void(null!=this.completion&&this.completion())):(this.locate(),void a(this.nodes).each(function(b){return function(c,d){var e;return e=a(d),e.addClass(""+b.options.classPrefix+"locating")}}(this)))},b.prototype.distance=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;return e=a.lat,f=b.lat,g=a.lng,h=b.lng,i=Math.PI*e/180,j=Math.PI*f/180,k=Math.PI*g/180,l=Math.PI*h/180,n=g-h,m=Math.PI*n/180,d=Math.sin(i)*Math.sin(j)+Math.cos(i)*Math.cos(j)*Math.cos(m),d=Math.acos(d),d=180*d/Math.PI,d=60*d*1.1515,"K"===c&&(d=1.609344*d),"N"===c&&(d=.8684*d),d},a.whereyat=function(c,d){return c=a.extend({},a.whereyat.options,c),new b(c,d)},a.whereyat.options={className:".whereyat",classPrefix:"yat-",latitudeData:"yatLat",longitudeData:"yatLong",maxDistance:"xl",distances:{xs:75,sm:200,md:750,lg:1250}}}(jQuery);