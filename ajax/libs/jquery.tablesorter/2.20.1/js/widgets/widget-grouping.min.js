!function(r){"use strict";var e=r.tablesorter;e.grouping={types:{number:function(r,o,t,u,p){var a,s;return u>1&&""!==t?o.hasClass(e.css.sortAsc)?(a=Math.floor(parseFloat(t)/u)*u,a>parseFloat(p||0)?a:parseFloat(p||0)):(a=Math.ceil(parseFloat(t)/u)*u,a<parseFloat(p||u)-a?parseFloat(p||u)-a:a):(s=(t+"").match(/\d+/g),s&&s.length>=u?s[u-1]:t||"")},separator:function(e,o,t,u){var p=(t+"").split(e.widgetOptions.group_separator);return r.trim(p&&u>0&&p.length>=u?p[(u||1)-1]:"")},word:function(r,e,o,t){var u=(o+" ").match(/\w+/g);return u&&u.length>=t?u[t-1]:o||""},letter:function(r,e,o,t){return o?(o+" ").substring(0,t):""},date:function(r,e,o,t){var u=r.widgetOptions,p=new Date(o||""),a=p.getHours();return"year"===t?p.getFullYear():"month"===t?u.group_months[p.getMonth()]:"monthyear"===t?u.group_months[p.getMonth()]+" "+p.getFullYear():"day"===t?u.group_months[p.getMonth()]+" "+p.getDate():"week"===t?u.group_week[p.getDay()]:"time"===t?("00"+(a>12?a-12:0===a?a+12:a)).slice(-2)+":"+("00"+p.getMinutes()).slice(-2)+" "+("00"+u.group_time[a>=12?1:0]).slice(-2):u.group_dateString(p)}},update:function(o,t,u){if(!r.isEmptyObject(t.cache)){var p,a,s,n,g,l,i,c,d,_=u.grouping_language,h="",f=!1,m=t.sortList[0]?t.sortList[0][0]:-1;if(t.$table.find("tr.group-hidden").removeClass("group-hidden").end().find("tr.group-header").remove(),u.group_collapsible&&t.$table.data("pagerSavedHeight",0),m>=0&&!t.$headers.filter('[data-column="'+m+'"]:last').hasClass("group-false")){for(u.group_currentGroup="",u.group_currentGroups={},g=(t.$headers.filter('[data-column="'+m+'"]:last').attr("class")||"").match(/(group-\w+(-\w+)?)/g),l=g?g[0].split("-"):["group","letter",1],u.group_collapsible&&u.group_saveGroups&&e.storage&&(u.group_currentGroups=e.storage(o,"tablesorter-groups")||{},d="number"===l[1]&&l[2]>1?"dir"+t.sortList[0][1]:"",c=u.group_currentGroup=""+m+d+l.join(""),u.group_currentGroups[c]?f=!0:u.group_currentGroups[c]=[]),a=0;a<t.$tbodies.length;a++)for(i=t.cache[a].normalized,h="",n=t.$tbodies.eq(a).children("tr").not("."+t.cssChildRow),p=0;p<n.length;p++)n.eq(p).is(":visible")&&e.grouping.types[l[1]]&&(s=i[p]?e.grouping.types[l[1]](t,t.$headers.filter('[data-column="'+m+'"]:last'),i[p][m],/date/.test(g)?l[2]:parseInt(l[2]||1,10)||1,h,_):s,h!==s&&(h=s,"number"===l[1]&&l[2]>1&&""!==s&&(s+=" - "+(parseInt(s,10)+(parseInt(l[2],10)-1)*(t.$headers.filter('[data-column="'+m+'"]:last').hasClass(e.css.sortAsc)?1:-1))),r.isFunction(u.group_formatter)&&(s=u.group_formatter((s||"").toString(),m,o,t,u)||s),n.eq(p).before('<tr class="group-header '+t.selectorRemove.slice(1)+'" unselectable="on"><td colspan="'+t.columns+'">'+(u.group_collapsible?"<i/>":"")+'<span class="group-name">'+s+'</span><span class="group-count"></span></td></tr>'),u.group_saveGroups&&!f&&u.group_collapsed&&u.group_collapsible&&u.group_currentGroups[u.group_currentGroup].push(s)));t.$table.find("tr.group-header").bind("selectstart",!1).each(function(){var e,t,p,a=r(this),s=a.nextUntil("tr.group-header").filter(":visible");(u.group_count||r.isFunction(u.group_callback))&&(t=a.find(".group-count"),t.length&&(u.group_count&&t.html(u.group_count.replace(/\{num\}/g,s.length)),r.isFunction(u.group_callback)&&u.group_callback(a.find("td"),s,m,o))),u.group_saveGroups&&u.group_currentGroups[u.group_currentGroup].length?(p=a.find(".group-name").text().toLowerCase(),e=r.inArray(p,u.group_currentGroups[u.group_currentGroup])>-1,a.toggleClass("collapsed",e),s.toggleClass("group-hidden",e)):u.group_collapsed&&u.group_collapsible&&(a.addClass("collapsed"),s.addClass("group-hidden"))}),t.$table.trigger(u.group_complete)}}},bindEvents:function(o,t,u){u.group_collapsible&&(u.group_currentGroups=[],t.$table.on("click toggleGroup","tr.group-header",function(p){p.stopPropagation();var a,s,n,g=r(this),l=g.find(".group-name").text().toLowerCase();"click"===p.type&&p.shiftKey&&g.siblings(".group-header").trigger("toggleGroup"),g.toggleClass("collapsed"),g.nextUntil("tr.group-header").toggleClass("group-hidden",g.hasClass("collapsed")),u.group_saveGroups&&e.storage&&(s=t.$table.find(".group-header"),a=g.hasClass("collapsed"),u.group_currentGroups[u.group_currentGroup]||(u.group_currentGroups[u.group_currentGroup]=[]),a&&u.group_currentGroup?u.group_currentGroups[u.group_currentGroup].push(l):u.group_currentGroup&&(n=r.inArray(l,u.group_currentGroups[u.group_currentGroup]),n>-1&&u.group_currentGroups[u.group_currentGroup].splice(n,1)),e.storage(o,"tablesorter-groups",u.group_currentGroups))})),r(u.group_saveReset).on("click",function(){e.grouping.clearSavedGroups(o)}),t.$table.on("pagerChange.tsgrouping",function(){e.grouping.update(o,t,u)})},clearSavedGroups:function(r){r&&e.storage&&(e.storage(r,"tablesorter-groups",""),e.grouping.update(r,r.config,r.config.widgetOptions))}},e.addWidget({id:"group",priority:100,options:{group_collapsible:!0,group_collapsed:!1,group_saveGroups:!0,group_saveReset:null,group_count:" ({num})",group_separator:"-",group_formatter:null,group_callback:null,group_complete:"groupingComplete",group_months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],group_week:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],group_time:["AM","PM"],group_dateString:function(r){return r.toLocaleString()}},init:function(r,o,t,u){e.grouping.bindEvents(r,t,u)},format:function(r,o,t){e.grouping.update(r,o,t)},remove:function(r,e){e.$table.off("click","tr.group-header").off("pagerChange.tsgrouping").find(".group-hidden").removeClass("group-hidden").end().find("tr.group-header").remove()}})}(jQuery);