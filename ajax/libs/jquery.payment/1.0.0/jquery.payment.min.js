(function(){var e,t,r,n,a,i,o,s,c,l,u,d,h,v,f,p;e=jQuery,p=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},t=function(){var e,t,r,n;for(t={},e=r=40;49>=r;e=++r)t[e]="visa";for(e=n=50;59>=n;e=++n)t[e]="mastercard";return t[34]=t[37]="amex",t[60]=t[62]=t[64]=t[65]="discover",t[35]="jcb",t[30]=t[36]=t[38]=t[39]="dinersclub",t}(),l=function(e){var t,r,n,a,i,o;for(n=!0,a=0,r=(e+"").split("").reverse(),i=0,o=r.length;o>i;i++)t=r[i],t=parseInt(t,10),(n=!n)&&(t*=2),t>9&&(t-=9),a+=t;return a%10===0},c=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)&&"function"==typeof t.createRange?t.createRange().text:void 0)?!0:!1},a=function(t){var r,n,a,i,o,s;if(n=String.fromCharCode(t.which),/^\d+$/.test(n)){if(r=e(t.currentTarget),s=r.val(),o=e.cardType(s+n),a=(s.replace(/\D/g,"")+n).length,"amex"===o){if(a>=15)return}else if(a>=16)return;if(null==r.prop("selectionStart")||r.prop("selectionStart")===s.length)return i="amex"===o?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,i.test(s)?(t.preventDefault(),r.val(s+" "+n)):i.test(s+n)?(t.preventDefault(),r.val(s+n+" ")):void 0}},r=function(t){var r,n;return r=e(t.currentTarget),n=r.val(),t.meta||null!=r.prop("selectionStart")&&r.prop("selectionStart")!==n.length?void 0:8===t.which&&/\s\d?$/.test(n)?(t.preventDefault(),r.val(n.replace(/\s\d?$/,""))):void 0},i=function(t){var r,n,a;return n=String.fromCharCode(t.which),/^\d+$/.test(n)?(r=e(t.currentTarget),a=r.val()+n,/^\d$/.test(a)&&"0"!==a&&"1"!==a?(t.preventDefault(),r.val("0"+a+" / ")):/^\d\d$/.test(a)?(t.preventDefault(),r.val(""+a+" / ")):void 0):void 0},o=function(t){var r,n,a;return n=String.fromCharCode(t.which),/^\d+$/.test(n)?(r=e(t.currentTarget),a=r.val(),/^\d\d$/.test(a)?r.val(""+a+" / "):void 0):void 0},s=function(t){var r,n,a;return n=String.fromCharCode(t.which),"/"===n?(r=e(t.currentTarget),a=r.val(),/^\d$/.test(a)&&"0"!==a?r.val("0"+a+" / "):void 0):void 0},n=function(t){var r,n;if(!t.meta&&(r=e(t.currentTarget),n=r.val(),8===t.which&&(null==r.prop("selectionStart")||r.prop("selectionStart")===n.length)))return/\s\/\s?$/.test(n)?(t.preventDefault(),r.val(n.replace(/\s\/\s?$/,""))):void 0},v=function(e){var t;return e.metaKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))},d=function(t){var r,n,a;return r=e(t.currentTarget),n=String.fromCharCode(t.which),/^\d+$/.test(n)&&!c(r)?(a=r.val()+n,a=a.replace(/\D/g,""),"amex"===e.cardType(a)?a.length<=15:a.length<=16):void 0},h=function(t){var r,n,a;return r=e(t.currentTarget),n=String.fromCharCode(t.which),/^\d+$/.test(n)&&!c(r)?(a=r.val()+n,a=a.replace(/\D/g,""),a.length>6?!1:void 0):void 0},u=function(t){var r,n;return r=e(t.currentTarget),n=r.val(),n.length<=4},f=function(t){var r,n,a;return r=e(t.currentTarget),a=r.val(),n=e.cardType(a)||"unknown",r.hasClass(n)?void 0:(r.removeClass("visa amex mastercard discover dinersclub jcb unknown"),r.addClass(n),r.toggleClass("identified","unknown"!==n),r.trigger("payment.cardType",n))},e.fn.formatCardCVC=function(){return this.restrictNumeric(),this.on("keypress",u)},e.fn.formatCardExpiry=function(){return this.restrictNumeric(),this.on("keypress",h),this.on("keypress",i),this.on("keypress",s),this.on("keypress",o),this.on("keydown",n)},e.fn.formatCardNumber=function(){return this.restrictNumeric(),this.on("keypress",d),this.on("keypress",a),this.on("keydown",r),this.on("keyup",f)},e.fn.restrictNumeric=function(){return this.on("keypress",v)},e.fn.cardExpiryVal=function(){return e.cardExpiryVal(e(this).val())},e.cardExpiryVal=function(e){var t,r,n,a;return e=e.replace(/\s/g,""),a=e.split("/",2),t=a[0],n=a[1],2===(null!=n?n.length:void 0)&&/^\d+$/.test(n)&&(r=(new Date).getFullYear(),r=r.toString().slice(0,2),n=r+n),t=parseInt(t,10),n=parseInt(n,10),{month:t,year:n}},e.validateCardNumber=function(e){return e=(e+"").replace(/\s+|-/g,""),e.length>=10&&e.length<=16&&l(e)},e.validateCardExpiry=function(e,t){var r,n,a;return"object"==typeof e&&"month"in e&&(a=e,e=a.month,t=a.year),e&&t?(e=p(e),t=p(t),/^\d+$/.test(e)&&/^\d+$/.test(t)&&parseInt(e,10)<=12?(n=new Date(t,e),r=new Date,n.setMonth(n.getMonth()-1),n.setMonth(n.getMonth()+1,1),n>r):!1):!1},e.validateCardCVC=function(e,t){return e=p(e),/^\d+$/.test(e)?t?"amex"===t?4===e.length:3===e.length:e.length>=3&&e.length<=4:!1},e.cardType=function(e){return t[e.slice(0,2)]||null}}).call(this);