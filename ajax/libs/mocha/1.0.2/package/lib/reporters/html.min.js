function HTML(e){Base.call(this,e);var t,s,n=this.stats,a=e.total,r=document.getElementById("mocha"),i=fragment(statsTemplate),l=i.getElementsByTagName("li"),o=l[1].getElementsByTagName("em")[0],d=l[2].getElementsByTagName("em")[0],c=l[3].getElementsByTagName("em")[0],m=i.getElementsByTagName("canvas")[0],p=[r];return m.getContext&&(s=m.getContext("2d"),t=new Progress),r?(r.appendChild(i),t&&t.size(40),e.on("suite",function(e){if(!e.root){var t=fragment('<div class="suite"><h1>%s</h1></div>',e.title);p[0].appendChild(t),p.unshift(document.createElement("div")),t.appendChild(p[0])}}),e.on("suite end",function(e){e.root||p.shift()}),e.on("fail",function(t,s){("hook"==t.type||s.uncaught)&&e.emit("test end",t)}),void e.on("test end",function(e){var r=n.tests/a*100|0;t&&t.update(r).draw(s);var i=new Date-n.start;if(text(o,n.passes),text(d,n.failures),text(c,(i/1e3).toFixed(2)),"passed"==e.state)var l=fragment('<div class="test pass %e"><h2>%e<span class="duration">%ems</span></h2></div>',e.speed,e.title,e.duration);else if(e.pending)var l=fragment('<div class="test pass pending"><h2>%e</h2></div>',e.title);else{var l=fragment('<div class="test fail"><h2>%e</h2></div>',e.title),m=e.err.stack||e.err.toString();~m.indexOf(e.err.message)||(m=e.err.message+"\n"+m),"[object Error]"==m&&(m=e.err.message),!e.err.stack&&e.err.sourceURL&&void 0!==e.err.line&&(m+="\n("+e.err.sourceURL+":"+e.err.line+")"),l.appendChild(fragment('<pre class="error">%e</pre>',m))}var u=l.getElementsByTagName("h2")[0];if(on(u,"click",function(){g.style.display="none"==g.style.display?"block":"none"}),!e.pending){var g=fragment("<pre><code>%e</code></pre>",clean(e.fn.toString()));l.appendChild(g),g.style.display="none"}p[0].appendChild(l)})):error("#mocha div missing, add it to your document")}function error(e){document.body.appendChild(fragment('<div id="error">%s</div>',e))}function fragment(e){var t=arguments,s=document.createElement("div"),n=1;return s.innerHTML=e.replace(/%([se])/g,function(e,s){switch(s){case"s":return String(t[n++]);case"e":return escape(t[n++])}}),s.firstChild}function text(e,t){e.textContent?e.textContent=t:e.innerText=t}function on(e,t,s){e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s)}function clean(e){e=e.replace(/^function *\(.*\) *{/,"").replace(/\s+\}$/,"");var t=e.match(/^\n?( *)/)[1].length,s=new RegExp("^ {"+t+"}","gm");return e=e.replace(s,"").replace(/^\s+/,"")}var Base=require("./base"),utils=require("../utils"),Progress=require("../browser/progress"),escape=utils.escape;exports=module.exports=HTML;var statsTemplate='<ul id="stats"><li class="progress"><canvas width="40" height="40"></canvas></li><li class="passes">passes: <em>0</em></li><li class="failures">failures: <em>0</em></li><li class="duration">duration: <em>0</em>s</li></ul>';