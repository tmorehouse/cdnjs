/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
(function(a){if(typeof bootstrap==="function"){bootstrap("promise",a)}else{if(typeof exports==="object"){a(void 0,exports)}else{if(typeof define==="function"){define(a)}else{if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=function(){var b={};return a(void 0,b)}}}else{a(void 0,Q={})}}}}})(function(aq,L){var W=i();var O;var am=function(){};var ad=Object.freeze||am;if(typeof cajaVM!=="undefined"){ad=cajaVM.def}var K;if(typeof process!=="undefined"){K=process.nextTick}else{if(typeof setImmediate==="function"){K=setImmediate}else{if(typeof MessageChannel!=="undefined"){var ah=new MessageChannel();var u={},C=u;ah.port1.onmessage=function(){u=u.next;var aE=u.task;delete u.task;aE()};K=function(aE){C=C.next={task:aE};ah.port2.postMessage(0)}}else{K=function(aE){setTimeout(aE,0)}}}}var t;if(Function.prototype.bind){var G=Function.prototype.bind;t=G.bind(G.call)}else{t=function(aE){return function(){return aE.call.apply(aE,arguments)}}}var ak=t(Array.prototype.slice);var T=t(Array.prototype.reduce||function(aH,aG){var aE=0,aF=this.length;if(arguments.length===1){do{if(aE in this){aG=this[aE++];break}if(++aE>=aF){throw new TypeError()}}while(1)}for(;aE<aF;aE++){if(aE in this){aG=aH(aG,this[aE],aE)}}return aG});var ao=t(Array.prototype.indexOf||function(aF){for(var aE=0;aE<this.length;aE++){if(this[aE]===aF){return aE}}return -1});var y=t(Array.prototype.map||function(aH,aF){var aE=this;var aG=[];T(aE,function(aK,aJ,aI){aG.push(aH.call(aF,aJ,aI,aE))},void 0);return aG});var A=Object.create||function(aF){function aE(){}aE.prototype=aF;return new aE()};var x=Object.keys||function(aE){var aG=[];for(var aF in aE){aG.push(aF)}return aG};var aB=Object.prototype.toString;function w(aE){return(aB(aE)==="[object StopIteration]"||aE instanceof H)}var H;if(typeof ReturnValue!=="undefined"){H=ReturnValue}else{H=function(aE){this.value=aE}}var Y="From previous event:";function o(aE,aF){if(aF.stack&&typeof aE==="object"&&aE!==null&&aE.stack&&aE.stack.indexOf(Y)===-1){aE.stack=z(aE.stack)+"\n"+Y+"\n"+z(aF.stack)}}function z(aH){var aF=aH.split("\n");var aI=[];for(var aG=0;aG<aF.length;++aG){var aE=aF[aG];if(!ar(aE)&&!f(aE)){aI.push(aE)}}return aI.join("\n")}function f(aE){return aE.indexOf("(module.js:")!==-1||aE.indexOf("(node.js:")!==-1}function ar(aF){var aG=/at .+ \((.*):(\d+):\d+\)/.exec(aF);if(!aG){return false}var aH=aG[1];var aE=aG[2];return aH===O&&aE>=W&&aE<=aa}function i(){if(Error.captureStackTrace){var aG,aE;var aF=Error.prepareStackTrace;Error.prepareStackTrace=function(aH,aI){aG=aI[1].getFileName();aE=aI[1].getLineNumber()};new Error().stack;Error.prepareStackTrace=aF;O=aG;return aE}}function aA(aG,aE,aF){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(aE+" is deprecated, use "+aF+" instead.",new Error("").stack)}return aG.apply(aG,arguments)}}L.nextTick=K;L.defer=X;function X(){var aJ=[],aH=[],aG;var aE=A(X.prototype);var aI=A(U.prototype);aI.promiseSend=function(aO,aM,aN,aL){var aK=ak(arguments);if(aJ){aJ.push(aK);if(aO==="when"&&aL){aH.push(aL)}}else{K(function(){aG.promiseSend.apply(aG,aK)})}};aI.valueOf=function(){if(aJ){return aI}return aG.valueOf()};if(Error.captureStackTrace){Error.captureStackTrace(aI,X);aI.stack=aI.stack.substring(aI.stack.indexOf("\n")+1)}function aF(aK){if(!aJ){return}aG=V(aK);T(aJ,function(aM,aL){K(function(){aG.promiseSend.apply(aG,aL)})},void 0);aJ=void 0;aH=void 0}ad(aI);aE.promise=aI;aE.resolve=aF;aE.reject=function(aK){aF(af(aK))};aE.notify=function(aK){if(aJ){T(aH,function(aM,aL){K(function(){aL(aK)})},void 0)}};return aE}X.prototype.makeNodeResolver=function(){var aE=this;return function(aF,aG){if(aF){aE.reject(aF)}else{if(arguments.length>2){aE.resolve(ak(arguments,1))}else{aE.resolve(aG)}}}};X.prototype.node=aA(X.prototype.makeNodeResolver,"node","makeNodeResolver");L.promise=s;function s(aF){var aE=X();r(aF,aE.resolve,aE.reject,aE.notify).fail(aE.reject);return aE.promise}L.makePromise=U;function U(aG,aI,aE,aF){if(aI===void 0){aI=function(aJ){return af(new Error("Promise does not support operation: "+aJ))}}var aH=A(U.prototype);aH.promiseSend=function(aN,aK){var aL=ak(arguments,2);var aJ;try{if(aG[aN]){aJ=aG[aN].apply(aH,aL)}else{aJ=aI.apply(aH,[aN].concat(aL))}}catch(aM){aJ=af(aM)}if(aK){aK(aJ)}};if(aE){aH.valueOf=aE}if(aF){aH.exception=aF}ad(aH);return aH}U.prototype.then=function(aE,aF,aG){return av(this,aE,aF,aG)};U.prototype.thenResolve=function(aE){return av(this,function(){return aE})};T(["isResolved","isFulfilled","isRejected","when","spread","send","get","put","del","post","invoke","keys","apply","call","bind","fapply","fcall","fbind","all","allResolved","view","viewInfo","timeout","delay","catch","finally","fail","fin","progress","end","done","nfcall","nfapply","nfbind","ncall","napply","nbind","npost","ninvoke","nend","nodeify"],function(aF,aE){U.prototype[aE]=function(){return L[aE].apply(L,[this].concat(ak(arguments)))}},void 0);U.prototype.toSource=function(){return this.toString()};U.prototype.toString=function(){return"[object Promise]"};ad(U.prototype);L.nearer=q;function q(aE){if(ap(aE)){return aE.valueOf()}return aE}L.isPromise=ap;function ap(aE){return aE&&typeof aE.promiseSend==="function"}L.isPromiseAlike=P;function P(aE){return aE&&typeof aE.then==="function"}L.isResolved=ax;function ax(aE){return d(aE)||n(aE)}L.isFulfilled=d;function d(aE){return !P(q(aE))}L.isRejected=n;function n(aE){aE=q(aE);return ap(aE)&&"exception" in aE}var N=[];var Z=[];var p;function j(){if(!p&&typeof window!=="undefined"&&!window.Touch&&window.console){console.log("Should be empty:",Z)}p=true}L.reject=af;function af(aG){var aF=U({when:function(aJ){if(aJ){var aI=ao(N,this);if(aI!==-1){Z.splice(aI,1);N.splice(aI,1)}}return aJ?aJ(aG):af(aG)}},function aH(){return af(aG)},function aE(){return this},aG);j();N.push(aF);Z.push(aG);return aF}L.begin=V;L.resolve=V;L.ref=aA(V,"ref","resolve");function V(aG){if(ap(aG)){return aG}aG=aE(aG);if(P(aG)){var aF=X();aG.then(aF.resolve,aF.reject,aF.notify);return aF.promise}return U({when:function(){return aG},get:function(aH){return aG[aH]},put:function(aH,aI){aG[aH]=aI;return aG},del:function(aH){delete aG[aH];return aG},post:function(aH,aI){return aG[aH].apply(aG,aI)},apply:function(aH,aI){return aG.apply(aH,aI)},fapply:function(aH){return aG.apply(void 0,aH)},viewInfo:function(){var aH=aG;var aI={};function aJ(aK){if(!aI[aK]){aI[aK]=typeof aH[aK]}}while(aH){Object.getOwnPropertyNames(aH).forEach(aJ);aH=Object.getPrototypeOf(aH)}return{type:typeof aG,properties:aI}},keys:function(){return x(aG)}},void 0,function aE(){return aG})}L.master=e;function e(aE){return U({isDef:function(){}},function aF(){var aG=ak(arguments);return M.apply(void 0,[aE].concat(aG))},function(){return q(aE)})}L.viewInfo=aC;function aC(aE,aF){aE=V(aE);if(aF){return U({viewInfo:function(){return aF}},function aG(){var aH=ak(arguments);return M.apply(void 0,[aE].concat(aH))},function(){return q(aE)})}else{return M(aE,"viewInfo")}}L.view=al;function al(aE){return aC(aE).when(function(aH){var aF;if(aH.type==="function"){aF=function(){return az(aE,void 0,arguments)}}else{aF={}}var aG=aH.properties||{};x(aG).forEach(function(aI){if(aG[aI]==="function"){aF[aI]=function(){return l(aE,aI,arguments)}}});return V(aF)})}L.when=av;function av(aK,aJ,aL,aG){var aM=X();var aH=false;function aI(aP){try{return typeof aJ==="function"?aJ(aP):aP}catch(aO){return af(aO)}}function aN(aO){if(typeof aL==="function"){o(aO,aE);try{return aL(aO)}catch(aP){return af(aP)}}return af(aO)}function aF(aO){return typeof aG==="function"?aG(aO):aO}var aE=V(aK);K(function(){aE.promiseSend("when",function(aO){if(aH){return}aH=true;aM.resolve(aI(aO))},function(aO){if(aH){return}aH=true;aM.resolve(aN(aO))})});aE.promiseSend("when",void 0,void 0,function(aO){aM.notify(aF(aO))});return aM.promise}L.spread=E;function E(aG,aE,aF){return av(aG,function(aH){return at(aH).then(function(aI){return aE.apply(void 0,aI)},aF)},aF)}L.async=S;function S(aE){return function(){function aG(aM,aK){var aJ;try{aJ=aH[aM](aK)}catch(aL){if(w(aL)){return aL.value}else{return af(aL)}}return av(aJ,aI,aF)}var aH=aE.apply(this,arguments);var aI=aG.bind(aG,"send");var aF=aG.bind(aG,"throw");return aI()}}L["return"]=g;function g(aE){throw new H(aE)}L.promised=ay;function ay(aE){return function(){return at([this,at(arguments)]).spread(function(aF,aG){return aE.apply(aF,aG)})}}L.sender=aA(ab,"sender","dispatcher");L.Method=aA(ab,"Method","dispatcher");function ab(aE){return function(aG){var aF=ak(arguments,1);return M.apply(void 0,[aG,aE].concat(aF))}}L.send=aA(M,"send","dispatch");function M(aG,aH){var aE=X();var aF=ak(arguments,2);aG=V(aG);K(function(){aG.promiseSend.apply(aG,[aH,aE.resolve].concat(aF))});return aE.promise}L.dispatch=aD;function aD(aG,aH,aF){var aE=X();aG=V(aG);K(function(){aG.promiseSend.apply(aG,[aH,aE.resolve].concat(aF))});return aE.promise}L.dispatcher=D;function D(aE){return function(aG){var aF=ak(arguments,1);return aD(aG,aE,aF)}}L.get=D("get");L.put=D("put");L["delete"]=L.del=D("del");var l=L.post=D("post");L.invoke=function(aG,aF){var aE=ak(arguments,2);return l(aG,aF,aE)};var az=L.apply=aA(D("apply"),"apply","fapply");var au=L.fapply=D("fapply");L.call=aA(J,"call","fcall");function J(aG,aF){var aE=ak(arguments,2);return az(aG,aF,aE)}L["try"]=r;L.fcall=r;function r(aF){var aE=ak(arguments,1);return au(aF,aE)}L.bind=aA(aw,"bind","fbind");function aw(aH,aF){var aE=ak(arguments,2);return function aG(){var aI=aE.concat(ak(arguments));return az(aH,aF,aI)}}L.fbind=ac;function ac(aG){var aE=ak(arguments,1);return function aF(){var aH=aE.concat(ak(arguments));return au(aG,aH)}}L.keys=D("keys");L.all=at;function at(aE){return av(aE,function(aH){var aG=aH.length;if(aG===0){return V(aH)}var aF=X();T(aH,function(aK,aJ,aI){if(d(aJ)){aH[aI]=q(aJ);if(--aG===0){aF.resolve(aH)}}else{av(aJ,function(aL){aH[aI]=aL;if(--aG===0){aF.resolve(aH)}}).fail(aF.reject)}},void 0);return aF.promise})}L.allResolved=R;function R(aE){return av(aE,function(aF){return av(at(y(aF,function(aG){return av(aG,am,am)})),function(){return y(aF,V)})})}L["catch"]=L.fail=a;function a(aF,aE){return av(aF,void 0,aE)}L.progress=B;function B(aE,aF){return av(aE,void 0,void 0,aF)}L["finally"]=L.fin=m;function m(aE,aF){return av(aE,function(aG){return av(aF(),function(){return aG})},function(aG){return av(aF(),function(){return af(aG)})})}L.end=aA(ai,"end","done");L.done=ai;function ai(aJ,aE,aI,aH){function aF(aK){K(function(){o(aK,aJ);if(L.onerror){L.onerror(aK)}else{throw aK}})}var aG=aE||aI||aH?av(aJ,aE,aI,aH):aJ;a(aG,aF)}L.timeout=ae;function ae(aH,aF){var aE=X();var aG=setTimeout(function(){aE.reject(new Error("Timed out after "+aF+" ms"))},aF);av(aH,function(aI){clearTimeout(aG);aE.resolve(aI)},function(aI){clearTimeout(aG);aE.reject(aI)});return aE.promise}L.delay=b;function b(aG,aF){if(aF===void 0){aF=aG;aG=void 0}var aE=X();setTimeout(function(){aE.resolve(aG)},aF);return aE.promise}L.nfapply=v;function v(aH,aF){var aG=ak(aF);var aE=X();aG.push(aE.makeNodeResolver());au(aH,aG).fail(aE.reject);return aE.promise}L.nfcall=F;function F(aG){var aF=ak(arguments,1);var aE=X();aF.push(aE.makeNodeResolver());au(aG,aF).fail(aE.reject);return aE.promise}L.nfbind=an;function an(aF){var aE=ak(arguments,1);return function(){var aH=aE.concat(ak(arguments));var aG=X();aH.push(aG.makeNodeResolver());au(aF,aH).fail(aG.reject);return aG.promise}}L.napply=aA(h,"napply","npost");function h(aG,aF,aE){return k(aG,aF).apply(void 0,aE)}L.ncall=aA(ag,"ncall","ninvoke");function ag(aG,aF){var aE=ak(arguments,2);return h(aG,aF,aE)}L.nbind=aA(k,"nbind","nfbind");function k(aH){if(arguments.length>1){var aF=arguments[1];var aE=ak(arguments,2);var aG=aH;aH=function(){var aI=aE.concat(ak(arguments));return aG.apply(aF,aI)}}return function(){var aI=X();var aJ=ak(arguments);aJ.push(aI.makeNodeResolver());au(aH,aJ).fail(aI.reject);return aI.promise}}L.npost=I;function I(aH,aG,aF){var aI=ak(aF);var aE=X();aI.push(aE.makeNodeResolver());l(aH,aG,aI).fail(aE.reject);return aE.promise}L.ninvoke=aj;function aj(aG,aF){var aH=ak(arguments,2);var aE=X();aH.push(aE.makeNodeResolver());l(aG,aF,aH).fail(aE.reject);return aE.promise}L.nend=aA(c,"nend","nodeify");L.nodeify=c;function c(aF,aE){if(aE){aF.then(function(aG){K(function(){aE(null,aG)})},function(aG){K(function(){aE(aG)})})}else{return aF}}var aa=i()});