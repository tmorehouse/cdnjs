/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * With formatStackTrace and formatSourcePosition functions
 * Copyright 2006-2008 the V8 project authors. All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *     * Neither the name of Google Inc. nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
(function(a){if(typeof bootstrap==="function"){bootstrap("promise",a)}else{if(typeof exports==="object"){a(void 0,exports)}else{if(typeof define==="function"){define(a)}else{if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=function(){var b={};return a(void 0,b)}}}else{a(void 0,Q={})}}}}})(function(j,aj){var A=af();var q;var an=function(){};var r=Object.freeze||an;if(typeof cajaVM!=="undefined"){r=cajaVM.def}var ap;if(typeof process!=="undefined"){ap=process.nextTick}else{if(typeof msSetImmediate==="function"){ap=msSetImmediate.bind(window)}else{if(typeof setImmediate==="function"){ap=setImmediate}else{if(typeof MessageChannel!=="undefined"){var W=new MessageChannel();var z={},at=z;W.port1.onmessage=function(){z=z.next;var av=z.task;delete z.task;av()};ap=function(av){at=at.next={task:av};W.port2.postMessage(0)}}else{ap=function(av){setTimeout(av,0)}}}}}var u;if(Function.prototype.bind){var M=Function.prototype.bind;u=M.bind(M.call)}else{u=function(av){return function(){return av.call.apply(av,arguments)}}}var al=u(Array.prototype.slice);var f=u(Array.prototype.reduce||function(ay,ax){var av=0,aw=this.length;if(arguments.length===1){do{if(av in this){ax=this[av++];break}if(++av>=aw){throw new TypeError()}}while(1)}for(;av<aw;av++){if(av in this){ax=ay(ax,this[av],av)}}return ax});var X=u(Array.prototype.indexOf||function(aw){for(var av=0;av<this.length;av++){if(this[av]===aw){return av}}return -1});var c=u(Array.prototype.map||function(ay,aw){var av=this;var ax=[];f(av,function(aB,aA,az){ax.push(ay.call(aw,aA,az,av))},void 0);return ax});var R=Object.create||function(aw){function av(){}av.prototype=aw;return new av()};var O=Object.keys||function(av){var ax=[];for(var aw in av){ax.push(aw)}return ax};var au=Object.prototype.toString;function D(av){return(au(av)==="[object StopIteration]"||av instanceof S)}var S;if(typeof ReturnValue!=="undefined"){S=ReturnValue}else{S=function(av){this.value=av}}function B(ay,aC){var ax=[];try{ax.push(ay.toString())}catch(aA){try{ax.push("<error: "+aA+">")}catch(aw){ax.push("<error>")}}for(var az=0;az<aC.length;az++){var aB=aC[az];var av;if(typeof aB==="string"){ax.push(aB)}else{try{av=ab(aB)}catch(aA){try{av="<error: "+aA+">"}catch(aw){av="<error>"}}ax.push("    at "+av)}}return ax.join("\n")}function ab(aw){var aA="";if(aw.isNative()){aA="native"}else{if(aw.isEval()){aA="eval at "+aw.getEvalOrigin()}else{var ay=aw.getFileName();if(ay){aA+=ay;var ax=aw.getLineNumber();if(ax!==null){aA+=":"+ax;var av=aw.getColumnNumber();if(av){aA+=":"+av}}}}}if(!aA){aA="unknown source"}var aF="";var aB=aw.getFunction().name;var aE=true;var aD=aw.isConstructor();var az=!(aw.isToplevel()||aD);if(az){var aC=aw.getMethodName();aF+=aw.getTypeName()+".";if(aB){aF+=aB;if(aC&&(aC!==aB)){aF+=" [as "+aC+"]"}}else{aF+=aC||"<anonymous>"}}else{if(aD){aF+="new "+(aB||"<anonymous>")}else{if(aB){aF+=aB}else{aF+=aA;aE=false}}}if(aE){aF+=" ("+aA+")"}return aF}function i(ax,aw){if(ax!==q){return false}var av=aw.getLineNumber();return av>=A&&av<=x}function d(ax){var aw=Error.prepareStackTrace;Error.prepareStackTrace=function(ay,az){return az.filter(function(aA){var aB=aA.getFileName();return(aB!=="module.js"&&aB!=="node.js"&&!i(aB,aA))})};var av=ax.stack;Error.prepareStackTrace=aw;return av}function af(){if(Error.captureStackTrace){var ax,av;var aw=Error.prepareStackTrace;Error.prepareStackTrace=function(ay,az){ax=az[1].getFileName();av=az[1].getLineNumber()};new Error().stack;Error.prepareStackTrace=aw;q=ax;return av}}function K(ax,av,aw){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(av+" is deprecated, use "+aw+" instead.",new Error("").stack)}return ax.apply(ax,arguments)}}aj.nextTick=ap;aj.defer=o;function o(){var az=[],ax;var av=R(o.prototype);var ay=R(am.prototype);ay.promiseSend=function(){var aA=al(arguments);if(az){az.push(aA)}else{ap(function(){ax.promiseSend.apply(ax,aA)})}};ay.valueOf=function(){if(az){return ay}return ax.valueOf()};if(Error.captureStackTrace){Error.captureStackTrace(ay,o)}function aw(aA){if(!az){return}ax=I(aA);f(az,function(aC,aB){ap(function(){ax.promiseSend.apply(ax,aB)})},void 0);az=void 0;return ax}r(ay);av.promise=ay;av.resolve=aw;av.reject=function(aA){return aw(L(aA))};return av}o.prototype.makeNodeResolver=function(){var av=this;return function(aw,ax){if(aw){av.reject(aw)}else{if(arguments.length>2){av.resolve(al(arguments,1))}else{av.resolve(ax)}}}};o.prototype.node=K(o.prototype.makeNodeResolver,"node","makeNodeResolver");aj.promise=ac;function ac(aw){var av=o();l(aw,av.resolve,av.reject).fail(av.reject);return av.promise}aj.makePromise=am;function am(ax,az,av,aw){if(az===void 0){az=function(aA){return L(new Error("Promise does not support operation: "+aA))}}var ay=R(am.prototype);ay.promiseSend=function(aE,aB){var aC=al(arguments,2);var aA;try{if(ax[aE]){aA=ax[aE].apply(ay,aC)}else{aA=az.apply(ay,[aE].concat(aC))}}catch(aD){aA=L(aD)}aB(aA)};if(av){ay.valueOf=av}if(aw){ay.exception=aw}r(ay);return ay}am.prototype.then=function(av,aw){return V(this,av,aw)};f(["isResolved","isFulfilled","isRejected","when","spread","send","get","put","del","post","invoke","keys","apply","call","bind","fapply","fcall","fbind","all","allResolved","view","viewInfo","timeout","delay","catch","finally","fail","fin","end"],function(aw,av){am.prototype[av]=function(){return aj[av].apply(aj,[this].concat(al(arguments)))}},void 0);am.prototype.toSource=function(){return this.toString()};am.prototype.toString=function(){return"[object Promise]"};r(am.prototype);aj.nearer=y;function y(av){if(Object(av)!==av){return av}else{return av.valueOf()}}aj.isPromise=H;function H(av){return av&&typeof av.promiseSend==="function"}aj.isResolved=k;function k(av){return Y(av)||ae(av)}aj.isFulfilled=Y;function Y(av){return !H(y(av))}aj.isRejected=ae;function ae(av){av=y(av);return H(av)&&"exception" in av}var ad=[];var J=[];if(typeof window!=="undefined"&&window.console){console.log("Should be empty:",J)}aj.reject=L;function L(ax){ax=ax||new Error();var aw=am({when:function(aA){if(aA){var az=X(ad,this);if(az!==-1){J.splice(az,1);ad.splice(az,1)}}return aA?aA(ax):L(ax)}},function ay(){return L(ax)},function av(){return this},ax);ad.push(aw);J.push(ax);return aw}aj.begin=I;aj.resolve=I;aj.ref=K(I,"ref","resolve");function I(ax){if(H(ax)){return ax}if(ax&&typeof ax.then==="function"){var aw=o();ax.then(aw.resolve,aw.reject);return aw.promise}return am({when:function(){return ax},get:function(ay){return ax[ay]},put:function(ay,az){return ax[ay]=az},del:function(ay){return delete ax[ay]},post:function(ay,az){return ax[ay].apply(ax,az)},apply:function(ay,az){return ax.apply(ay,az)},fapply:function(ay){return ax.apply(void 0,ay)},viewInfo:function(){var ay=ax;var az={};function aA(aB){if(!az[aB]){az[aB]=typeof ay[aB]}}while(ay){Object.getOwnPropertyNames(ay).forEach(aA);ay=Object.getPrototypeOf(ay)}return{type:typeof ax,properties:az}},keys:function(){return O(ax)}},void 0,function av(){return ax})}aj.master=C;function C(av){return am({isDef:function(){}},function aw(){var ax=al(arguments);return P.apply(void 0,[av].concat(ax))},function(){return y(av)})}aj.viewInfo=ai;function ai(av,aw){av=I(av);if(aw){return am({viewInfo:function(){return aw}},function ax(){var ay=al(arguments);return P.apply(void 0,[av].concat(ay))},function(){return y(av)})}else{return P(av,"viewInfo")}}aj.view=e;function e(av){return ai(av).when(function(ay){var aw;if(ay.type==="function"){aw=function(){return aq(av,void 0,arguments)}}else{aw={}}var ax=ay.properties||{};O(ax).forEach(function(az){if(ax[az]==="function"){aw[az]=function(){return F(av,az,arguments)}}});return I(aw)})}aj.when=V;function V(aA,ax,az){var ay=o();var aw=false;function av(aD){try{return ax?ax(aD):aD}catch(aC){return L(aC)}}function aB(aC){try{return az?az(aC):L(aC)}catch(aD){return L(aD)}}ap(function(){I(aA).promiseSend("when",function(aC){if(aw){return}aw=true;ay.resolve(av(aC))},function(aC){if(aw){return}aw=true;ay.resolve(aB(aC))})});return ay.promise}aj.spread=h;function h(ax,av,aw){return V(ax,function(ay){return G(ay).then(function(az){return av.apply(void 0,az)})},aw)}aj.async=aa;function aa(av){return function(){function ax(aD,aB){var aA;try{aA=ay[aD](aB)}catch(aC){if(D(aC)){return aC.value}else{return L(aC)}}return V(aA,az,aw)}var ay=av.apply(this,arguments);var az=ax.bind(ax,"send");var aw=ax.bind(ax,"throw");return az()}}aj["return"]=p;function p(av){throw new S(av)}aj.promised=w;function w(av){return function(){return G([this,G(arguments)]).spread(function(aw,ax){return av.apply(aw,ax)})}}aj.sender=K(n,"sender","dispatcher");aj.Method=K(n,"Method","dispatcher");function n(av){return function(ax){var aw=al(arguments,1);return P.apply(void 0,[ax,av].concat(aw))}}aj.send=K(P,"send","dispatch");function P(ax,ay){var av=o();var aw=al(arguments,2);ax=I(ax);ap(function(){ax.promiseSend.apply(ax,[ay,av.resolve].concat(aw))});return av.promise}aj.dispatch=ah;function ah(ax,ay,aw){var av=o();ax=I(ax);ap(function(){ax.promiseSend.apply(ax,[ay,av.resolve].concat(aw))});return av.promise}aj.dispatcher=N;function N(av){return function(ax){var aw=al(arguments,1);return ah(ax,av,aw)}}aj.get=N("get");aj.put=N("put");aj["delete"]=aj.del=N("del");var F=aj.post=N("post");aj.invoke=function(ax,aw){var av=al(arguments,2);return F(ax,aw,av)};var aq=aj.apply=K(N("apply"),"apply","fapply");var T=aj.fapply=N("fapply");aj.call=K(b,"call","fcall");function b(ax,aw){var av=al(arguments,2);return aq(ax,aw,av)}aj["try"]=l;aj.fcall=l;function l(aw){var av=al(arguments,1);return T(aw,av)}aj.bind=K(m,"bind","fbind");function m(ay,aw){var av=al(arguments,2);return function ax(){var az=av.concat(al(arguments));return aq(ay,aw,az)}}aj.fbind=s;function s(ax){var av=al(arguments,1);return function aw(){var ay=av.concat(al(arguments));return T(ax,ay)}}aj.keys=N("keys");aj.all=G;function G(av){return V(av,function(ay){var ax=ay.length;if(ax===0){return I(ay)}var aw=o();f(ay,function(aB,aA,az){if(Y(aA)){ay[az]=y(aA);if(--ax===0){aw.resolve(ay)}}else{V(aA,function(aC){ay[az]=aC;if(--ax===0){aw.resolve(ay)}}).fail(aw.reject)}},void 0);return aw.promise})}aj.allResolved=g;function g(av){return V(av,function(aw){return V(G(c(aw,function(ax){return V(ax,an,an)})),function(){return c(aw,I)})})}aj["catch"]=aj.fail=t;function t(aw,av){return V(aw,void 0,av)}aj["finally"]=aj.fin=ag;function ag(av,aw){return V(av,function(ax){return V(aw(),function(){return ax})},function(ax){return V(aw(),function(){return L(ax)})})}aj.end=E;function E(av){V(av,void 0,function(aw){ap(function(){var ax;if(Error.captureStackTrace&&typeof aw==="object"&&(ax=d(aw))){var ay=d(av);var az=ax.concat("From previous event:",ay);aw.stack=B(aw,az)}throw aw})})}aj.timeout=ak;function ak(ay,aw){var av=o();var ax=setTimeout(function(){av.reject(new Error("Timed out after "+aw+" ms"))},aw);V(ay,function(az){clearTimeout(ax);av.resolve(az)},av.reject);return av.promise}aj.delay=U;function U(ax,aw){if(aw===void 0){aw=ax;ax=void 0}var av=o();setTimeout(function(){av.resolve(ax)},aw);return av.promise}aj.napply=Z;function Z(ax,aw,av){return a(ax,aw).apply(void 0,av)}aj.ncall=ao;function ao(ax,aw){var av=al(arguments,2);return Z(ax,aw,av)}aj.nbind=a;function a(ay){if(arguments.length>1){var aw=arguments[1];var av=al(arguments,2);var ax=ay;ay=function(){var az=av.concat(al(arguments));return ax.apply(aw,az)}}return function(){var az=o();var aA=al(arguments);aA.push(az.makeNodeResolver());T(ay,aA).fail(az.reject);return az.promise}}aj.npost=v;function v(ax,aw,av){return Z(ax[aw],ax,av)}aj.ninvoke=ar;function ar(ax,aw){var av=al(arguments,2);return Z(ax[aw],ax,av)}r(aj);var x=af()});