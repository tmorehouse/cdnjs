!function(a){"use strict";function n(a){var b=".";return b+a+" "}var b={scregalAdding:"scregalAdding",scregalAdded:"scregalAdded",scregalRemoving:"scregalRemoving",scregalRemoved:"scregalRemoved",scregalFigure:"scregalFigure",scregalWrap:"scregalWrap",scregalBox:"scregalBox",scregalBesideBox:"scregalBesideBox",scregalCenterBox:"scregalCenterBox",scregalLeftBox:"scregalLeftBox",scregalRightBox:"scregalRightBox",scregalTitle:"scregalTitle",scregalFront:"scregalFront",scregalLeftImg:"scregalLeftImg",scregalRightImg:"scregalRightImg",scregalCenterImg:"scregalCenterImg",scregalClose:"scregalClose",scregalNavigation:"scregalNavigation",scregalLeftNavigation:"scregalLeftNavigation",scregalRightNavigation:"scregalRightNavigation"};void 0===window.scregal&&(window.scregal={}),window.scregal.classnames=b;var c=a('<div class="'+window.scregal.classnames.scregalBox+'">'),d=a('<a href="#" class="'+window.scregal.classnames.scregalWrap+" "+window.scregal.classnames.scregalLeftBox+" "+window.scregal.classnames.scregalBesideBox+'">'),e=a('<div class="'+window.scregal.classnames.scregalWrap+" "+window.scregal.classnames.scregalCenterBox+'">'),f=a('<a href="#" class="'+window.scregal.classnames.scregalWrap+" "+window.scregal.classnames.scregalRightBox+" "+window.scregal.classnames.scregalBesideBox+'">'),g=a('<img class="'+window.scregal.classnames.scregalLeftImg+'" />').css("display","none"),h=a('<img class="'+window.scregal.classnames.scregalCenterImg+'" />').css("display","none"),i=a('<img class="'+window.scregal.classnames.scregalRightImg+'" />').css("display","none"),j=a('<div class="'+window.scregal.classnames.scregalNavigation+" "+window.scregal.classnames.scregalRightNavigation+'">'),k=a('<div class="'+window.scregal.classnames.scregalNavigation+" "+window.scregal.classnames.scregalLeftNavigation+'">'),l=a('<div class="'+window.scregal.classnames.scregalClose+'">'),m=a('<div class="'+window.scregal.classnames.scregalFront+'"><div class="'+window.scregal.classnames.scregalTitle+'"></div></div>').css("display","none"),o=function(){var b=function(b,c){var d=this;this.$instance=b,"string"==typeof b&&(this.$instance=a(b));var e=this.$instance.data("scregal");if(e)return e;if(this.isInitialized=!1,this.isScregalWorking=!1,this.isAutoGalleryRunning=!1,this.isNavigationHidden=!1,this.isFrontHidden=!1,this.auto_gallery_delay_timer=null,this.auto_gallery_init_timer=null,this.ids_counter=0,this.handlerForElem=void 0,this.scregal_datas={},this.recent_scregal_data=void 0,this.recent_data_image={scregalCenterImg:{},scregalLeftImg:{},scregalRightImg:{}},this.defaults={elems:"> a",maxWidth:"85%",centerDisappearAnimation:{opacity:0},sideDisappearAnimation:{opacity:0},centerAppearAnimation:{opacity:1},sideAppearAnimation:{opacity:1},disappearDuration:2e3,appearDuration:2e3,disappearEasing:"easeInOutExpo",appearEasing:"easeInOutExpo",isNavigationHidden:!1,isNavigationKeyboard:!0,hideNavigationWhenAutoGallery:!0,hideFrontWhenAutoGallery:!1,runAutoGalleryAfterDelay:5e3,autoGalleryDelay:3e3,init:!0,prev:void 0,next:void 0,close:void 0,addFront:!0,frontContent:function(){},frontTitle:function(){return a('<div class="scregalSubtitle">')},basicHeight:function(){return a(window).height()},basicWidth:function(){return a(window).width()},getGalleryName:function(){return"rel"}},this.updateOptions(c),this.$instance.length){var f=0==a.trim(this.defaults.elems).indexOf(">")?this.$instance.find(this.defaults.elems):a(this.defaults.elems);f.each(function(){d.append(a(this))})}this.defaults.init&&this.init()};return b.prototype.init=function(){var b=this;b.isInitialized||(a("body "+n(window.scregal.classnames.scregalBox)).length||(a("body").prepend(c),c.append(d,e,f,g,h,i),b.defaults.addFront&&(c.append(m),m.prepend(b.defaults.frontContent()),m.show(0)),b.defaults.prev?"":c.append(k),b.defaults.next?"":c.append(j),b.defaults.close?"":c.append(l)),b.defaults.isNavigationHidden?b.disappearNavigation():"",b.isInitialized=!0,b.$instance.trigger("scregalInitialized"),b.$instance.data("scregal",b),b.set_other_handlers())},b.prototype.updateOptions=function(b){var c=this;b?a.extend(c.defaults,b):""},b.prototype.append=function(b){var c=this;b.each(function(){var b=a(this),d=b.attr("data-rel")?b.attr("data-rel"):c.defaults.getGalleryName.call(b);c.scregal_datas[d]?"":c.scregal_datas[d]=[];var e={elem:b,href:b.attr("href"),rel:d,id:c.ids_counter++,frontTitle:c.defaults.frontTitle.call(b),handler:function(a){a.preventDefault(),c.openGallery(b)}};b.on("click",e.handler),c.scregal_datas[d].push(e),b.addClass("scregal"),b.data("scregal",e),c.$instance.trigger("elemAppended",[b])})},b.prototype.remove=function(b){var c=this;b.each(function(){var b=a(this).data("scregal"),d=c.scregal_datas[b.rel];for(var e in d){var f=parseInt(e);d[f].id==b.id&&d.splice(f,1)}a(this).off("click",b.handler),a(this).removeData("scregal"),c.$instance.trigger("elemRemoved",[a(this)])})},b.prototype.set_recent_scregal_data=function(a){this.recent_scregal_data=a},b.prototype.disappearNavigation=function(){var a=this;a.isNavigationHidden=!0,j.add(k).add(l).add(a.defaults.prev+", "+a.defaults.next+", "+a.defaults.close).fadeOut(300)},b.prototype.appearNavigation=function(){var a=this;a.defaults.isNavigationHidden||(a.isNavigationHidden=!1,j.add(k).add(l).add(a.defaults.prev+", "+a.defaults.next+", "+a.defaults.close).fadeIn(300))},b.prototype.disappearFront=function(){this.isFrontHidden=!0,m.fadeOut(300)},b.prototype.appearFront=function(){this.isFrontHidden=!1,m.fadeIn(300)},b.prototype.is_navigation_hover=function(){var b=this,c=b.defaults.prev?b.defaults.prev+":hover":n(window.scregal.classnames.scregalLeftNavigation)+":hover",d=b.defaults.next?b.defaults.next+":hover":n(window.scregal.classnames.scregalRightNavigation)+":hover",e=a(c+", "+d),f=e.length?!0:!1;return f},b.prototype.autoGalleryInit=function(){var a=this;clearTimeout(a.auto_gallery_init_timer),a.defaults.runAutoGalleryAfterDelay&&(a.auto_gallery_init_timer=setTimeout(function(){a.isScregalWorking&&!a.is_navigation_hover()?a.autoGalleryStart():""},a.defaults.runAutoGalleryAfterDelay))},b.prototype.autoGalleryStart=function(){var a=this;a.isAutoGalleryRunning=!0,a.defaults.hideNavigationWhenAutoGallery?a.disappearNavigation():"",a.defaults.hideFrontWhenAutoGallery?a.disappearFront():"",a.auto_gallery_delay_timer=setInterval(function(){a.gallery_progress(!0)},a.defaults.autoGalleryDelay+Math.max(a.defaults.disappearDuration,a.defaults.appearDuration))},b.prototype.autoGalleryStop=function(){var a=this;a.isAutoGalleryRunning=!1,clearInterval(a.auto_gallery_delay_timer),a.autoGalleryInit()},b.prototype.set_other_handlers=function(){var b=this,d=3;c.on("mousemove",function(){b.isFrontHidden?b.appearFront():"",b.isNavigationHidden&&!b.defaults.isNavigationHidden?b.appearNavigation():"",b.isAutoGalleryRunning?b.autoGalleryStop():"",b.autoGalleryInit()}),a(n(window.scregal.classnames.scregalCenterImg)+", "+n(window.scregal.classnames.scregalLeftImg)+", "+n(window.scregal.classnames.scregalRightImg)).load(function(){b.recent_data_image[a(this).attr("class")].width=a(this).width(),b.recent_data_image[a(this).attr("class")].height=a(this).height(),b.recent_data_image[a(this).attr("class")].href=a(this).attr("src"),0==--d&&(b.update_boxes_content(),b.update_boxes_size(),d=3)}),a(window).resize(function(){b.update_boxes_size()}),a("body").on("click",n(window.scregal.classnames.scregalRightBox),function(a){a.preventDefault(),b.autoGalleryStop(),b.gallery_progress(!0)}),a("body").on("click",n(window.scregal.classnames.scregalLeftBox),function(a){a.preventDefault(),b.autoGalleryStop(),b.gallery_progress()}),a("body").on("click",b.defaults.prev+", "+n(window.scregal.classnames.scregalLeftNavigation),function(a){a.preventDefault(),a.stopPropagation(),b.gallery_progress()}),a("body").on("click",b.defaults.next+", "+n(window.scregal.classnames.scregalRightNavigation),function(a){a.preventDefault(),a.stopPropagation(),b.gallery_progress(!0)}),a("body").on("click",b.defaults.close+", "+n(window.scregal.classnames.scregalClose),function(a){a.preventDefault(),a.stopPropagation(),b.closeGallery()}),a(document).on("keyup",function(a){a.preventDefault();var c=a.which;if(b.isScregalWorking&&b.defaults.isNavigationKeyboard)switch(c){case 27:b.closeGallery();break;case 37:b.gallery_progress(),b.autoGalleryStop();break;case 39:b.gallery_progress(!0),b.autoGalleryStop()}})},b.prototype.openGallery=function(b){var c=this,d=b.data("scregal");c.set_recent_scregal_data(d),c.load_gallery_data(),c.isScregalWorking=!0,a(n(window.scregal.classnames.scregalBox)).fadeIn(300),c.$instance.trigger("scregalAppeared")},b.prototype.gallery_progress=function(a){var b=a?this.getNextIndex():this.getPrevIndex(),c=this.scregal_datas[this.recent_scregal_data.rel][b];this.set_recent_scregal_data(c),this.load_gallery_data()},b.prototype.closeGallery=function(){a(n(window.scregal.classnames.scregalBox)).fadeOut(300),a(n(window.scregal.classnames.scregalFigure)).remove(),this.isScregalWorking=!1,this.autoGalleryStop(),this.$instance.trigger("scregalDisappeared")},b.prototype.getPrevIndex=function(){var a=this.recent_scregal_data.id,b=this.scregal_datas[this.recent_scregal_data.rel],c=b.length;for(var d in b){var e=parseInt(d);if(b[e].id==a)return 0==e?c-1:e-1}},b.prototype.getNextIndex=function(){var a=this.recent_scregal_data.id,b=this.scregal_datas[this.recent_scregal_data.rel],c=b.length;for(var d in b){var e=parseInt(d);if(b[e].id==a)return e==c-1?0:e+1}},b.prototype.add_front_to_item=function(){var b=this;a(n(window.scregal.classnames.scregalTitle)).html(b.recent_scregal_data.frontTitle)},b.prototype.load_gallery_data=function(){var a=this.getPrevIndex(),b=this.getNextIndex();h.attr("src",this.recent_scregal_data.href),g.attr("src",this.scregal_datas[this.recent_scregal_data.rel][a].href),i.attr("src",this.scregal_datas[this.recent_scregal_data.rel][b].href),this.defaults.addFront?this.add_front_to_item():""},b.prototype.on=function(a,b){that.$instance.on(a,b)},b.prototype.off=function(a,b){that.$instance.off(a,b)},b.prototype.update_boxes_size=function(){var a=this,b=a.defaults.basicWidth(),c=a.defaults.basicHeight(),g=a.recent_data_image.scregalCenterImg.width,h=a.recent_data_image.scregalCenterImg.height,i=Math.floor(g/(h/c));e.add(d).add(f).height(c);var j="string"==typeof a.defaults.maxWidth?parseInt(a.defaults.maxWidth)/100*b>=i?i:parseInt(a.defaults.maxWidth)/100*b:a.defaults.maxWidth>=i?i:a.defaults.maxWidth;j=Math.floor(j),e.css({width:j}),d.css({width:(b-j)/2}),f.css({width:(b-j)/2})},b.prototype.update_boxes_content=function(){var b=this,c=a('<figure class="'+window.scregal.classnames.scregalFigure+" "+window.scregal.classnames.scregalAdding+'">'),g=c.clone().css("background-image","url("+b.recent_data_image.scregalCenterImg.href+")"),h=c.clone().css("background-image","url("+b.recent_data_image.scregalLeftImg.href+")"),i=c.clone().css("background-image","url("+b.recent_data_image.scregalRightImg.href+")");a(n(window.scregal.classnames.scregalWrap)+n(window.scregal.classnames.scregalRemoved)).remove(),e.prepend(g),d.prepend(h),f.prepend(i),a(n(window.scregal.classnames.scregalBesideBox)+n(window.scregal.classnames.scregalAdded)).addClass(window.scregal.classnames.scregalRemoving).animate(b.defaults.sideDisappearAnimation,b.defaults.disappearDuration,b.defaults.disappearEasing,function(){a(this).removeClass(window.scregal.classnames.scregalRemoving),a(this).addClass(window.scregal.classnames.scregalRemoved)}),a(n(window.scregal.classnames.scregalCenterBox)+n(window.scregal.classnames.scregalAdded)).addClass(window.scregal.classnames.scregalRemoving).animate(b.defaults.centerDisappearAnimation,b.defaults.disappearDuration,b.defaults.disappearEasing,function(){a(this).removeClass(window.scregal.classnames.scregalRemoving),a(this).addClass(window.scregal.classnames.scregalRemoved)}),a(n(window.scregal.classnames.scregalBesideBox)+n(window.scregal.classnames.scregalAdding)).animate(b.defaults.sideAppearAnimation,b.defaults.appearDuration,b.defaults.appearEasing,function(){a(this).removeClass(window.scregal.classnames.scregalAdding),a(this).addClass(window.scregal.classnames.scregalAdded)}),a(n(window.scregal.classnames.scregalCenterBox)+n(window.scregal.classnames.scregalAdding)).animate(b.defaults.centerAppearAnimation,b.defaults.appearDuration,b.defaults.appearEasing,function(){a(this).removeClass(window.scregal.classnames.scregalAdding),a(this).addClass(window.scregal.classnames.scregalAdded)})},b}();window.Scregal=o;var p=a(".js-scregal");p.each(function(){var b=a(this),c=b.attr("data-scregal-options"),d=c?JSON.parse(c):{};new o(b,d)}),a.fn.scregal=function(b){a(this).each(function(){var c=a(this);new o(c,b),a(this).addClass("js-scregal")})}}(jQuery);