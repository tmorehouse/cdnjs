/*
* Media Element
* HTML5 <video> libary
* http://mediaelementjs.com/
*
* Creates a JavaScript object that mimics HTML5 media objects
* through a Flash->JavaScript|Silverlight bridge
*
* Copyright 2010, John Dyer
* Dual licensed under the MIT or GPL Version 2 licenses.
*
* Version: 1.0.7
*/
var html5=html5||{};html5.meIndex=0;html5.plugins={silverlight:[{version:[3,0],type:"video/mp4"},{version:[3,0],type:"video/m4v"},{version:[3,0],type:"video/mov"},{version:[3,0],type:"video/wmv"},{version:[3,0],type:"audio/wma"},{version:[3,0],type:"audio/mp4"},{version:[3,0],type:"audio/m4a"},{version:[3,0],type:"audio/mp3"}],flash:[{version:[9,0,124],type:"video/mp4"},{version:[9,0,124],type:"video/flv"},{version:[9,0,124],type:"video/mov"},{version:[9,0,124],type:"audio/mp3"},{version:[9,0,124],type:"audio/m4a"},{version:[9,0,124],type:"audio/mp4"},{version:[9,0,124],type:"audio/flv"}]};html5.PluginDetector={hasPluginVersion:function(c,a){var b=this.plugins[c];a[1]=a[1]||0;a[2]=a[2]||0;return(b[0]>a[0]||(b[0]==a[0]&&b[1]>a[1])||(b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]))?true:false},nav:window.navigator,ua:window.navigator.userAgent.toLowerCase(),plugins:[],addPlugin:function(d,c,e,a,b){this.plugins[d]=this.detectPlugin(c,e,a,b)},detectPlugin:function(h,b,c,l){var j=[0,0,0],k,f,a;if(typeof(this.nav.plugins)!="undefined"&&typeof this.nav.plugins[h]=="object"){k=this.nav.plugins[h].description;if(k&&!(typeof this.nav.mimeTypes!="undefined"&&this.nav.mimeTypes[b]&&!this.nav.mimeTypes[b].enabledPlugin)){j=k.replace(h,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".");for(f=0;f<j.length;f++){j[f]=parseInt(j[f],10)}}}else{if(typeof(window.ActiveXObject)!="undefined"){try{a=new ActiveXObject(c);if(a){j=l(a)}}catch(g){}}}return j}};html5.PluginDetector.addPlugin("flash","Shockwave Flash","application/x-shockwave-flash","ShockwaveFlash.ShockwaveFlash",function(b){var a=[],c=b.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");a=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}return a});html5.PluginDetector.addPlugin("silverlight","Silverlight Plug-In","application/x-silverlight-2","AgControl.AgControl",function(b){var a=[0,0,0,0],c=function(f,d,e,g){while(f.isVersionSupported(d[0]+"."+d[1]+"."+d[2]+"."+d[3])){d[e]+=g}d[e]-=g};c(b,a,0,1);c(b,a,1,1);c(b,a,2,10000);c(b,a,2,1000);c(b,a,2,100);c(b,a,2,10);c(b,a,2,1);c(b,a,3,1);return a});if(html5.PluginDetector.ua.match(/Android 2\.[12]/)!==null){HTMLMediaElement.canPlayType=function(a){return(a.match(/video\/(mp4|m4v)/)!==null)?"probably":""}}html5.Utility={escapeHTML:function(a){return a.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},absolutizeUrl:function(a){var b=document.createElement("div");b.innerHTML='<a href="'+this.escapeHTML(a)+'">x</a>';return b.firstChild.href},getScriptPath:function(b){var f=0,e,g="",d="",c,a=document.getElementsByTagName("script");for(;f<a.length;f++){c=a[f].src;for(e=0;e<b.length;e++){d=b[e];if(c.indexOf(d)>-1){g=c.substring(0,c.indexOf(d));break}}if(g!==""){break}}return g}};html5.MediaElementDefaults={enablePluginDebug:false,plugins:["silverlight","flash"],type:"",pluginPath:html5.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),flashName:"flashmediaelement.swf",silverlightName:"silverlightmediaelement.xap",defaultVideoWidth:480,defaultVideoHeight:270,pluginWidth:-1,pluginHeight:-1,success:function(){},error:function(){}};html5.MediaElement=function(a,b){html5.HtmlMediaElementShim.create(a,b)};html5.HtmlMediaElementShim={create:function(f,e){var j=html5.MediaElementDefaults,h=(typeof(f)=="string")?document.getElementById(f):f,a=(h.tagName.toLowerCase()=="video"),b=(typeof(h.canPlayType)!="undefined"),c={method:"",url:""},i=h.getAttribute("poster"),g=h.getAttribute("autoplay"),d;for(d in e){j[d]=e[d]}i=(i=="undefined"||i===null)?"":i;c=this.determinePlayback(h,j,a,b);if(c.method=="native"){this.updateNative(h,j)}else{if(c.method!==""){this.createPlugin(h,j,a,c.method,html5.Utility.absolutizeUrl(c.url),i,g)}else{this.createErrorMessage(h,j,c.url,i)}}},determinePlayback:function(o,r,a,b){var q=[],g,f,e,d,c,l,p={method:"",url:""},h,m;if(typeof(r.type)!="undefined"&&r.type!==""){q.push({type:r.type,url:null})}else{if(o.getAttribute("src")!="undefined"&&o.getAttribute("src")!==null){c=o.getAttribute("src");l=this.checkType(c,o.getAttribute("type"),a);q.push({type:l,url:c})}else{for(g=0;g<o.childNodes.length;g++){d=o.childNodes[g];if(d.nodeType==1&&d.tagName.toLowerCase()=="source"){c=d.getAttribute("src");l=this.checkType(c,d.getAttribute("type"),a);q.push({type:l,url:c})}}}}if(b){for(g=0;g<q.length;g++){if(o.canPlayType(q[g].type).replace(/no/,"")!==""){p.method="native";p.url=q[g].url;return p}}}for(g=0;g<q.length;g++){for(f=0;f<r.plugins.length;f++){h=r.plugins[f];m=html5.plugins[h];for(e=0;e<m.length;e++){if(q[g].type==m[e].type&&html5.PluginDetector.hasPluginVersion(h,m[e].version)){p.method=h;p.url=q[g].url;return p}}}}return p},checkType:function(a,c,d){var b;if(a&&!c){b=a.substring(a.lastIndexOf(".")+1);return((d)?"video":"audio")+"/"+b}else{return c}},createErrorMessage:function(c,b,f,g){var a=document.createElement("div");a.className="me-cannotplay";try{a.style.width=c.width+"px";a.style.height=c.height+"px"}catch(d){}a.innerHTML=(g!=="")?'<a href="'+f+'"><img src="'+g+'" /></a>':'<a href="'+f+'">Download file</a>';c.parentNode.insertBefore(a,c);c.style.display="none";b.error(c)},createPlugin:function(i,m,b,f,h,j,g){var d=1,k=1,e="me_"+f+"_"+(html5.meIndex++),l=new html5.PluginMediaElement(e,f),c=document.createElement("div"),a;if(b){d=(m.videoWidth>0)?m.videoWidth:(i.getAttribute("width")!==null)?i.getAttribute("width"):m.defaultVideoWidth;k=(m.videoHeight>0)?m.videoHeight:(i.getAttribute("height")!==null)?i.getAttribute("height"):m.defaultVideoHeight}else{if(m.enablePluginDebug){d=320;k=240}}l.success=m.success;html5.MediaPluginBridge.registerPluginElement(e,l,i);c.className="me-plugin";i.parentNode.insertBefore(c,i);a=["id="+e,"poster="+j,"autoplay="+g,"width="+d,"height="+k];if(h!==null){a.push("file="+h)}if(m.enablePluginDebug){a.push("debug=true")}switch(f){case"silverlight":c.innerHTML='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="'+e+'" name="'+e+'" width="'+d+'" height="'+k+'"><param name="initParams" value="'+a.join(",")+'" /><param name="windowless" value="true" /><param name="background" value="black" /><param name="minRuntimeVersion" value="3.0.0.0" /><param name="autoUpgrade" value="true" /><param name="source" value="'+m.pluginPath+m.silverlightName+'" /></object>';break;case"flash":if(navigator.appName.indexOf("Microsoft")!=-1){c.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+e+'" width="'+d+'" height="'+k+'"><param name="movie" value="'+m.pluginPath+m.flashName+"?x="+(new Date())+'" /><param name="flashvars" value="'+a.join("&")+'" /><param name="quality" value="high" /><param name="bgcolor" value="#000000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="sameDomain" /><param name="allowFullScreen" value="true" /></object>'}else{c.innerHTML='<embed id="'+e+'" name="'+e+'" play="true" loop="false" quality="high" bgcolor="#000000" wmode="transparent" allowScriptAccess="sameDomain" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+m.pluginPath+m.flashName+"?"+a.join("&")+'" width="'+d+'" height="'+k+'"></embed>'}break}i.style.display="none"},updateNative:function(c,b){for(var a in html5.HtmlMediaElement){c[a]=html5.HtmlMediaElement[a]}b.success(c,c)}};html5.HtmlMediaElement={pluginType:"native",setCurrentTime:function(a){this.currentTime=a},setMuted:function(a){this.muted=a},setVolume:function(a){this.volume=a},setSrc:function(a){this.src=a},setVideoSize:function(b,a){this.width=b;this.height=a}};html5.PluginMediaElement=function(a,b){this.id=a;this.pluginType=b;this.events={}};html5.PluginMediaElement.prototype={pluginElement:null,playbackRate:-1,defaultPlaybackRate:-1,seekable:[],played:[],paused:true,ended:false,seeking:false,duration:0,muted:false,volume:1,currentTime:0,play:function(){this.pluginApi.playMedia();this.paused=false},load:function(){this.pluginApi.loadMedia();this.paused=false},pause:function(){this.pluginApi.pauseMedia();this.paused=true},setSrc:function(a){this.pluginApi.setSrc(html5.Utility.absolutizeUrl(a))},setCurrentTime:function(a){this.pluginApi.setCurrentTime(a);this.currentTime=a},setVolume:function(a){this.pluginApi.setVolume(a);this.volume=a},setMuted:function(a){this.pluginApi.setMuted(a);this.muted=a},setVideoSize:function(b,a){if(this.pluginElement.style){this.pluginElement.style.width=b+"px";this.pluginElement.style.height=a+"px"}this.pluginApi.setVideoSize(b,a)},setFullscreen:function(a){this.pluginApi.setFullscreen(a)},addEventListener:function(b,c,a){this.events[b]=this.events[b]||[];this.events[b].push(c)},dispatchEvent:function(a){var c,b,d=this.events[a];if(d){b=Array.prototype.slice.call(arguments,1);for(c=0;c<d.length;c++){d[c].apply(null,b)}}}};html5.MediaPluginBridge={pluginMediaElements:{},htmlMediaElements:{},registerPluginElement:function(c,a,b){this.pluginMediaElements[c]=a;this.htmlMediaElements[c]=b},initPlugin:function(c){var a=this.pluginMediaElements[c],b=this.htmlMediaElements[c];switch(a.pluginType){case"flash":a.pluginElement=a.pluginApi=document.getElementById(c);break;case"silverlight":a.pluginElement=document.getElementById(a.id);a.pluginApi=a.pluginElement.Content.SilverlightApp;break}if(a.success){a.success(a,b)}},fireEvent:function(h,c,b){var g,f,a,d=this.pluginMediaElements[h];d.ended=false;d.paused=false;g={type:c,target:d};for(f in b){d[f]=b[f];g[f]=b[f]}a=b.bufferedTime||0;g.target.buffered=g.buffered={start:function(e){return 0},end:function(e){return a},length:1};d.dispatchEvent(g.type,g)}};window.html5=html5;window.MediaElement=html5.MediaElement;
/*
 * Media Element jQuery plugin
 * http://mediaelementjs.com/
 *
 * Creates a controller bar for HTML5 <video> tags
 * and falls back to a Flash player or Silverlight player for browsers that
 * do not support <video> or cannot play the video type.
 * Mostly designed for H.264, but can also play Ogg, WebM, FLV, WMV, ACC and MP3
 *
 * Copyright 2010, John Dyer
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Version: 1.0.7
 */
(function(f){var b=document.createElement("video");var d=navigator.userAgent;var a=(typeof b.webkitEnterFullScreen!=="undefined");if(d.match("Chrome")){a=false}var e={defaultVideoWidth:480,defaultVideoHeight:270,videoWidth:-1,videoHeight:-1,audioWidth:300,audioHeight:30,messages:{start:"Click to Start",loading:"Loading",paused:"Paused",error:"Error",ended:"Ended"}};function h(i){i=Math.round(i);minutes=Math.floor(i/60);minutes=(minutes>=10)?minutes:"0"+minutes;i=Math.floor(i%60);i=(i>=10)?i:"0"+i;return minutes+":"+i}var c=0;function g(v,O){v=f(v);var y=f.extend(true,{},e,O);var x=v[0].tagName.toLowerCase()=="video";var H="mep_"+c++;var N=navigator.userAgent;var Q=(N.match(/iPad/i)!==null);var J=(N.match(/iPhone/i)!==null);var W=(N.match(/Android/i)!==null);if(Q||J){v.attr("controls","controls");v.removeAttr("poster");if(Q&&v[0].getAttribute("autoplay")!==null){v[0].load();v[0].play()}return}else{if(W&&x){v.attr("controls","controls");return}else{v.removeAttr("controls")}}var D=f('<div id="'+H+'" class="mep-container"><div class="mep-mediaelement"></div><div class="mep-poster"><img /></div><div class="mep-overlay"><div class="mep-overlay-message"></div></div><div class="mep-controls"><div class="mep-playpause-button mep-play"><span></span></div><div class="mep-time-rail"><span class="mep-time-total"><span class="mep-time-loaded"></span><span class="mep-time-current"></span><span class="mep-time-handle"></span></span></div><div class="mep-time"><span class="mep-currenttime"></span> <span> | </span> <span class="mep-duration"></span></div><div class="mep-volume-button mep-mute"><span></span><div class="mep-volume-slider"><div class="mep-volume-rail"><div class="mep-volume-handle"></div></div></div></div><div class="mep-fullscreen-button"><span></span></div></div><div class="mep-clear"></div></div>');v.before(D);var G=f("#"+H);G.find(".mep-mediaelement").append(v);G.addClass(v[0].className);var k=G.find(".mep-poster");var F=k.find("img");k.hide();var B=v.attr("poster");if(B!==""){F.attr("src",B);k.show()}var S=G.find(".mep-overlay");var s=G.find(".mep-overlay-message");if(v[0].getAttribute("autoplay")!==null){E(y.messages.loading)}else{E(y.messages.start)}function q(u,o){u=parseInt(u);o=parseInt(o);G.width(u).height(o);S.width(u).height(o);F.height(o).width(u)}var i=0;var l=0;if(x){i=(y.videoWidth>0)?y.videoWidth:(v[0].getAttribute("width")!==null)?v.attr("width"):y.defaultVideoWidth;l=(y.videoHeight>0)?y.videoHeight:(v[0].getAttribute("height")!==null)?v.attr("height"):y.defaultVideoHeight}else{i=y.audioWidth;l=y.audioHeight}q(i,l);var C=G.find(".mep-controls");var m=true;if(x){G.bind("mouseenter",function(){C.fadeIn(200);V();m=true}).bind("mouseleave",function(){C.fadeOut(200);m=false})}function E(o){if(x){s.html(o);S.css("visibility","visible")}}function R(){S.css("visibility","hidden")}var T=C.find(".mep-playpause-button");var j=C.find(".mep-fullscreen-button");if(!x){j.remove()}var P=C.find(".mep-time");var X=C.find(".mep-currenttime").html("00:00");var A=C.find(".mep-duration").html("00:00");var t=C.find(".mep-volume-button");var M=C.find(".mep-volume-slider");var r=C.find(".mep-volume-rail");var Y=C.find(".mep-volume-handle");var Z=C.find(".mep-time-rail");var p=Z.find(".mep-time-current").width(0);var I=Z.find(".mep-time-loaded").width(0);var w=Z.find(".mep-time-total");var z=C.find(".mep-time-handle");function V(){var o=T.outerWidth(true)+P.outerWidth(true)+t.outerWidth(true)+((x)?j.outerWidth(true):0);var u=C.width()-o-(Z.outerWidth(true)-Z.outerWidth(false));Z.width(u);w.width(u-(w.outerWidth(true)-w.width()))}function L(u,aa){C.show();V();T.bind("click",function(){if(T.hasClass("mep-play")){u.play();T.removeClass("mep-play").addClass("mep-pause")}else{u.pause();T.removeClass("mep-pause").addClass("mep-play")}});function ak(ap){var am=r.height();var ao=ap.pageY-r.offset().top;if(ao<0){ao=0}else{if(ao>am){ao=am}}Y.css("top",ao-(Y.height()/2));var an=(am-ao)/am;if(an==0){u.setMuted(true);t.removeClass("mep-mute").addClass("mep-unmute")}else{u.setMuted(false);t.removeClass("mep-unmute").addClass("mep-mute")}u.setVolume(an)}function aj(am){Y.css("top",r.height()-(r.height()*am)-(Y.height()/2))}function ai(){f(document).unbind("mousemove",ak).unbind("mouseup",ai)}M.bind("mousedown",function(am){ak(am);f(document).bind("mousemove",ak).bind("mouseup",ai)});t.find("span").bind("click",function(){if(u.muted){u.setMuted(false);t.removeClass("mep-unmute").addClass("mep-mute");aj(1)}else{u.setMuted(true);t.removeClass("mep-mute").addClass("mep-unmute");aj(0)}});var ad=false;var ac=0;var o=0;j.bind("click",function(){ae(!ad)});function ae(am){switch(u.pluginType){case"flash":u.setFullscreen(am);break;case"silverlight":u.setFullscreen(am);break;case"native":if(a){if(am){u.webkitEnterFullScreen()}else{u.webkitExitFullScreen()}}else{if(am){ac=v.height();o=v.width();G.addClass("mep-container-fullscreen").width("100%").height("100%").css("z-index",1000);v.width("100%").height("100%");S.width("100%").height("100%");F.width("100%").height("auto");j.removeClass("mep-fullscreen").addClass("mep-unfullscreen");V();f(document).bind("keydown",ah);f(window).bind("resize",al)}else{G.removeClass("mep-container-fullscreen").width(o).height(ac).css("z-index",1);v.width(o).height(ac);F.width(o).height(ac);j.removeClass("mep-unfullscreen").addClass("mep-fullscreen");V();f(document).unbind("keydown",ah);f(window).unbind("resize",al)}}}ad=am}function ah(am){if(am.keyCode==27){ae(false)}}function al(am){V()}Z.delegate("span","click",function(aq){var am=aq.pageX;var ar=w.offset();var ao=w.outerWidth();var an=((am-ar.left)/ao);var ap=an*u.duration;u.setCurrentTime(ap)});S.bind("click",function(am){if(u.paused){u.play()}},true);u.addEventListener("timeupdate",function(ao){if(!m){return}if(u.currentTime&&u.duration){X.html(h(u.currentTime));if(u.duration){A.html(h(u.duration))}var an=w.width()*u.currentTime/u.duration;p.width(an);var am=an-(z.width()/2);z.css("left",am)}ag(ao.target)},true);u.addEventListener("progress",function(am){ag(am.target)},true);function ag(an){if(an&&an.bytesTotal!=undefined&&an.bytesTotal>0&&an.bufferedBytes!=undefined){var am=an.bufferedBytes/an.bytesTotal;I.width(w.width()*am)}else{if(an&&an.buffered&&an.buffered.length>0&&an.buffered.end&&an.duration){var am=an.buffered.end(0)/an.duration;I.width(w.width()*am)}}}u.addEventListener("click",function(am){if(u.paused){u.play()}},true);u.addEventListener("playing",function(am){k.hide();T.removeClass("mep-play").addClass("mep-pause");R()},true);u.addEventListener("pause",function(am){T.removeClass("mep-pause").addClass("mep-play");E(y.messages.paused)},true);u.addEventListener("ended",function(am){k.show();T.removeClass("mep-pause").addClass("mep-play");E(y.messages.ended)},true);u.addEventListener("loadedmetadata",function(am){if(x&&y.videoHeight<=0&&v[0].getAttribute("height")===null&&!isNaN(am.target.videoHeight)){q(am.target.videoWidth,am.target.videoHeight);V();u.setVideoSize(am.target.videoWidth,am.target.videoHeight)}},true);var af="play playing played paused pausing".split(" ");for(var ab=0;ab<af.length;ab++){u.addEventListener(af[ab],function(am){console.log(am.type,am.target.paused)},true)}setTimeout(function(){V()},50);if(y.success){y.success(u,aa)}}function U(u){E(y.messages.error);var aa="";for(var o in u){aa+=o+" = "+u[o]+","}console.log("medialementplayer ERROR",aa)}var K=f.extend({},y,{pluginWidth:l,pluginHeight:i,success:L,error:U});var n=html5.MediaElement(v[0],K);return n}jQuery.fn.mediaelementplayer=function(i){return this.each(function(){return new g(f(this),i)})};window.html5.MediaElementPlayer=g;window.MediaElementPlayer=g})(jQuery);
