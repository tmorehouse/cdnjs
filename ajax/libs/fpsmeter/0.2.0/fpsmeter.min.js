/*! FPSMeter 0.2.0 - 11th Apr 2013 | https://github.com/Darsain/fpsmeter */
(function(e,V){function r(a,f){function Q(){g.legend.fps!==m&&(g.legend.fps=m,g.legend.innerText=m?"FPS":"ms");H=m?b.fps:b.duration;g.count.innerText=999<H?"999+":H.toFixed(99<H?0:d.decimals)}function h(){A=+new Date;I<A-d.threshold&&(b.fps-=b.fps/Math.max(1,60*d.smoothing/d.interval),b.duration=1E3/b.fps);for(c=d.history;c--;)E[c]=0===c?b.fps:E[c-1],F[c]=0===c?b.duration:F[c-1];Q();if(d.heat){if(w.length){J=Math.round(Math.min((m?b.fps/d.maxFps:b.duration/d.threshold)*B,B));for(c=w.length;c--;)w[c].el.style[j[w[c].name].heatOn]=
x[0|j[w[c].name].heatmap][J]}if(g.graph&&j.column.heatOn)for(c=s.length;c--;)J=Math.round(Math.min((m?E[c]/d.maxFps:F[c]/d.threshold)*B,B)),s[c].style[j.column.heatOn]=x[0|j.column.heatmap][J]}if(g.graph)for(n=0;n<d.history;n++)s[n].style.height=(m?E[n]?Math.round(L/d.maxFps*Math.min(E[n],d.maxFps)):0:F[n]?Math.round(L/d.threshold*Math.min(F[n],d.threshold)):0)+"px"}function e(){20>d.interval?(p=K(e),h()):(p=setTimeout(e,d.interval),M=K(h))}function v(a){a=a||window.event;a.preventDefault?(a.preventDefault(),
a.stopPropagation()):(a.returnValue=!1,a.cancelBubble=!0);b.toggle()}function G(){d.toggleOn&&R(g.container,d.toggleOn,v,1);a.removeChild(g.container)}function S(){g.container&&G();j=r.theme[d.theme];x=j.compiledHeatmaps||[];if(!x.length&&j.heatmaps.length){for(n=0;n<j.heatmaps.length;n++){x[n]=[];for(c=0;c<=B;c++){var b=x[n],f=c,e;e=0.33/B*c;var h=j.heatmaps[n].saturation,m=j.heatmaps[n].lightness,l=void 0,t=void 0,k=void 0,q=k=void 0,u=l=t=void 0,u=void 0,k=0.5>=m?m*(1+h):m+h-m*h;0===k?e="#000":
(q=2*m-k,t=(k-q)/k,e*=6,l=Math.floor(e),u=e-l,u*=k*t,0===l||6===l?(l=k,t=q+u,k=q):1===l?(l=k-u,t=k,k=q):2===l?(l=q,t=k,k=q+u):3===l?(l=q,t=k-u):4===l?(l=q+u,t=q):(l=k,t=q,k-=u),e="#"+N(l)+N(t)+N(k));b[f]=e}}j.compiledHeatmaps=x}g.container=y(document.createElement("div"),j.container);g.count=g.container.appendChild(y(document.createElement("div"),j.count));g.legend=g.container.appendChild(y(document.createElement("div"),j.legend));g.graph=d.graph?g.container.appendChild(y(document.createElement("div"),
j.graph)):0;w.length=0;for(var p in g)g[p]&&j[p].heatOn&&w.push({name:p,el:g[p]});s.length=0;if(g.graph){g.graph.style.width=d.history*j.column.width+(d.history-1)*j.column.spacing+"px";for(c=0;c<d.history;c++)s[c]=g.graph.appendChild(y(document.createElement("div"),j.column)),s[c].style.position="absolute",s[c].style.bottom=0,s[c].style.right=c*j.column.width+c*j.column.spacing+"px",s[c].style.width=j.column.width+"px",s[c].style.height="0px"}y(g.container,d);Q();a.appendChild(g.container);g.graph&&
(L=g.graph.clientHeight);d.toggleOn&&("click"===d.toggleOn&&(g.container.style.cursor="pointer"),R(g.container,d.toggleOn,v))}"object"===O(a)&&a.nodeType===V&&(f=a,a=document.body);a||(a=document.body);var b=this,d=z({},r.defaults,f||{}),g={},s=[],j,x,B=100,w=[],T=0,C=d.threshold,P=0,I=+new Date-C,A,E=[],F=[],p,M,m="fps"===d.show,L,J,H,c,n;b.options=d;b.fps=0;b.duration=0;b.isPaused=0;b.tickStart=function(){P=+new Date};b.tick=function(){A=+new Date;T=A-I;C+=(T-C)/d.smoothing;b.fps=1E3/C;b.duration=
P<I?C:A-P;I=A};b.pause=function(){p&&(b.isPaused=1,clearTimeout(p),D(p),D(M),p=M=0);return b};b.resume=function(){p||(b.isPaused=0,e());return b};b.set=function(a,c){d[a]=c;m="fps"===d.show;-1!==U(a,W)&&S();-1!==U(a,X)&&y(g.container,d);return b};b.showDuration=function(){b.set("show","ms");return b};b.showFps=function(){b.set("show","fps");return b};b.toggle=function(){b.set("show",m?"ms":"fps");return b};b.hide=function(){b.pause();g.container.style.display="none";return b};b.show=function(){b.resume();
g.container.style.display="block";return b};b.destroy=function(){b.pause();G();b.tick=b.tickStart=function(){}};S();e()}function y(a,f){for(var e in f)try{a.style[e]=f[e]}catch(h){}return a}function O(a){return Object.prototype.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase()}function U(a,f){if("array"!==O(f))return-1;if(f.indexOf)return f.indexOf(a);for(var e=0,h=f.length;e<h;e++)if(f[e]===a)return e;return-1}function z(){var a=arguments,f;for(f in a[1])if(a[1].hasOwnProperty(f))switch(O(a[1][f])){case "object":a[0][f]=
z({},a[0][f],a[1][f]);break;case "array":a[0][f]=a[1][f].slice(0);break;default:a[0][f]=a[1][f]}return 2<a.length?z.apply(null,[a[0]].concat(Array.prototype.slice.call(a,2))):a[0]}function N(a){a=Math.round(255*a).toString(16);return 1===a.length?"0"+a:a}function R(a,f,e,h){if(a.addEventListener)a[h?"removeEventListener":"addEventListener"](f,e,!1);else if(a.attachEvent)a[h?"detachEvent":"attachEvent"]("on"+f,e)}for(var D=e.cancelAnimationFrame||e.cancelRequestAnimationFrame,K=e.requestAnimationFrame,
h=["moz","webkit","o"],G=0,v=0,Y=h.length;v<Y&&!D;++v)K=(D=e[h[v]+"CancelAnimationFrame"]||e[h[v]+"CancelRequestAnimationFrame"])&&e[h[v]+"RequestAnimationFrame"];D||(K=function(a){var f=+new Date,h=Math.max(0,16-(f-G));G=f+h;return e.setTimeout(function(){a(f+h)},h)},D=function(a){clearTimeout(a)});window.FPSMeter=r;r.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",
theme:"dark",heat:0,graph:0,history:20};var W=["toggleOn","theme","heat","graph","history"],X="position zIndex left top right bottom margin".split(" ");r.theme={};h=r.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,
position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};r.theme.dark=z({},h,{heatmaps:[{saturation:0.8,lightness:0.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},
column:{background:"#3f3f3f"}});r.theme.light=z({},h,{heatmaps:[{saturation:0.5,lightness:0.5}],container:{color:"#444",background:"#fff",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}});r.theme.colorful=z({},h,{heatmaps:[{saturation:0.5,lightness:0.6}],container:{heatOn:"backgroundColor",background:"#aaa",border:"1px solid #ccc",borderColor:"rgba(0,0,0,0.1)",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}});
r.theme.transparent=z({},h,{heatmaps:[{saturation:0.8,lightness:0.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.3)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#777",backgroundColor:"rgba(0,0,0,.3)",heatOn:"backgroundColor",opacity:0.5}})})(window);
