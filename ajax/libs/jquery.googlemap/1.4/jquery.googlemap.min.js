$(function(){$.fn.googleMap=function(e){switch(e=$.extend({zoom:10,coords:[48.895651,2.290569],type:"ROADMAP",debug:!1,langage:"english"},e),e.type){case"ROADMAP":case"SATELLITE":case"HYBRID":case"TERRAIN":e.type=google.maps.MapTypeId[e.type];break;default:e.type=google.maps.MapTypeId.ROADMAP}return this.each(function(){var o=new google.maps.Map(this,{zoom:e.zoom,center:new google.maps.LatLng(e.coords[0],e.coords[1]),mapTypeId:e.type});$(this).data("googleMap",o),$(this).data("googleLang",e.langage),$(this).data("googleDebug",e.debug),$(this).data("googleMarker",new Array),$(this).data("googleBound",new google.maps.LatLngBounds)}),this},$.fn.addMarker=function(e){return e=$.extend({coords:!1,address:!1,url:!1,id:!1,icon:!1,draggable:!1,title:"",text:"",success:function(){}},e),this.each(function(){if($this=$(this),!$this.data("googleMap"))return $this.data("googleDebug")&&console.error("jQuery googleMap : Unable to add a marker where there is no map !"),!1;if(!e.coords&&!e.address)return $this.data("googleDebug")&&console.error("jQuery googleMap : Unable to add a marker if you don't tell us where !"),!1;if(e.address&&"string"==typeof e.address)geocoder=new google.maps.Geocoder,geocoder.geocode({address:e.address,bounds:$this.data("googleBound"),language:$this.data("googleLang")},function(o,t){if(t==google.maps.GeocoderStatus.OK){if($this.data("googleBound").extend(o[0].geometry.location),e.icon)var a=new google.maps.Marker({map:$this.data("googleMap"),position:o[0].geometry.location,title:e.title,icon:e.icon,draggable:e.draggable});else var a=new google.maps.Marker({map:$this.data("googleMap"),position:o[0].geometry.location,title:e.title,draggable:e.draggable});if(e.draggable&&google.maps.event.addListener(a,"dragend",function(){var o=a.getPosition(),t={};"undefined"!=typeof o.d?(t.lat=o.d,t.lon=o.e):$this.data("googleDebug")&&console.error("jQuery googleMap : Wrong google response",o),e.success(t)}),""==e.title||""==e.text||e.url)e.url&&google.maps.event.addListener(a,"click",function(){document.location=e.url});else{var g=new google.maps.InfoWindow({content:"<h1>"+e.title+"</h1>"+e.text}),n=$this.data("googleMap");google.maps.event.addListener(a,"click",function(){g.open(n,a)})}e.id?$this.data("googleMarker")[e.id]=a:$this.data("googleMarker").push(a),1==$this.data("googleMarker").length?($this.data("googleMap").setCenter(o[0].geometry.location),$this.data("googleMap").setZoom($this.data("googleMap").getZoom())):$this.data("googleMap").fitBounds($this.data("googleBound"));var r={};"undefined"!=typeof o[0].geometry.location.d?(r.lat=o[0].geometry.location.d,r.lon=o[0].geometry.location.e):$this.data("googleDebug")&&console.error("jQuery googleMap : Wrong google response",o[0].geometry.location),e.success(r)}else $this.data("googleDebug")&&console.error("jQuery googleMap : Unable to find the place asked for the marker ("+t+")")});else{if($this.data("googleBound").extend(new google.maps.LatLng(e.coords[0],e.coords[1])),e.icon)var o=new google.maps.Marker({map:$this.data("googleMap"),position:new google.maps.LatLng(e.coords[0],e.coords[1]),title:e.title,icon:e.icon});else var o=new google.maps.Marker({map:$this.data("googleMap"),position:new google.maps.LatLng(e.coords[0],e.coords[1]),title:e.title});if(""==e.title||""==e.text||e.url)e.url&&google.maps.event.addListener(o,"click",function(){document.location=e.url});else{var t=new google.maps.InfoWindow({content:"<h1>"+e.title+"</h1>"+e.text}),a=$this.data("googleMap");google.maps.event.addListener(o,"click",function(){t.open(a,o)})}e.id?$this.data("googleMarker")[e.id]=o:$this.data("googleMarker").push(o),1==$this.data("googleMarker").length?($this.data("googleMap").setCenter(new google.maps.LatLng(e.coords[0],e.coords[1])),$this.data("googleMap").setZoom($this.data("googleMap").getZoom())):$this.data("googleMap").fitBounds($this.data("googleBound")),e.success({lat:e.coords[0],lon:e.coords[1]})}}),this},$.fn.removeMarker=function(e){this.each(function(){var o=$(this);if(!o.data("googleMap"))return o.data("googleDebug")&&console.log("jQuery googleMap : Unable to delete a marker where there is no map !"),!1;var t=o.data("googleMarker");return"undefined"==typeof t[e]?(o.data("googleDebug")&&console.error("jQuery googleMap : Unable to delete a marker if it not exists !"),!1):(t[e].setMap(null),void(o.data("googleDebug")&&console.log("jQuery googleMap : marker deleted")))})},$.fn.addWay=function(e){e=$.extend({start:!1,end:!1,step:[],route:!1,langage:"english"},e);var o=new google.maps.DirectionsService({region:"fr"}),t=new google.maps.DirectionsRenderer({draggable:!0,map:$(this).data("googleMap"),panel:document.getElementById(e.route),provideTripAlternatives:!0}),a=[];for(var g in e.step){var n;n="object"==typeof e.step[g]?new google.maps.LatLng(e.step[g][0],e.step[g][1]):e.step[g],a.push({location:n,stopover:!0})}if("object"!=typeof e.end){var r=new google.maps.Geocoder;r.geocode({address:e.end,bounds:$(this).data("googleBound"),language:e.langage},function(g,n){if(n==google.maps.GeocoderStatus.OK){var r={origin:e.start,destination:g[0].geometry.location,travelMode:google.maps.DirectionsTravelMode.DRIVING,region:"fr",waypoints:a};o.route(r,function(e,o){o==google.maps.DirectionsStatus.OK?t.setDirections(e):$(this).data("googleDebug")&&console.error("jQuery googleMap : Unable to find the place asked for the route ("+e+")")})}else $(this).data("googleDebug")&&console.error("jQuery googleMap : Address not found")})}else{var s={origin:e.start,destination:new google.maps.LatLng(e.end[0],e.end[1]),travelMode:google.maps.DirectionsTravelMode.DRIVING,region:"fr",waypoints:a};o.route(s,function(e,o){o==google.maps.DirectionsStatus.OK?t.setDirections(e):$(this).data("googleDebug")&&console.error("jQuery googleMap : Address not found")})}return this}});