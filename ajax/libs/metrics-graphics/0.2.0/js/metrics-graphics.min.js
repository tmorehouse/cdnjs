"use strict";function moz_chart(){var t={};t.defaults={},t.defaults.all={animate_on_load:!1,top:40,bottom:30,right:10,left:50,buffer:8,width:350,height:220,small_height_threshold:120,small_width_threshold:160,small_text:!1,xax_count:6,xax_tick:5,yax_count:5,yax_tick:5,x_extended_ticks:!1,y_extended_ticks:!1,y_scale_type:"linear",max_x:null,max_y:null,min_x:null,min_y:null,x_accessor:"date",xax_units:"",x_label:"",y_accessor:"value",y_label:"",yax_units:"",transition_on_update:!0,rollover_callback:null,show_rollover_text:!0,show_confidence_band:null,xax_format:function(t){var e=d3.time.format("%b %d");return e(t)},area:!0,chart_type:"line",data:[],decimals:2,format:"count",inflator:10/9,linked:!1,list:!1,baselines:null,markers:null,scalefns:{},scales:{},show_years:!0,target:"#viz",interpolate:"cardinal"};var e=arguments[0];e||(e={}),e=merge_with_defaults(e,t.defaults.all);return e.list&&(e.x_accessor=0,e.y_accessor=1),"missing-data"==e.chart_type?charts.missing(e):"point"==e.chart_type?charts.point(e).markers().mainPlot().rollover():charts.line(e).markers().mainPlot().rollover(),e.data}function chart_title(t){var e={target:null,title:null,description:null},t=arguments[0];t||(t={}),t=merge_with_defaults(t,e),t.target&&t.title&&($(t.target).append('<h2 class="chart_title">'+t.title+'<i class="fa fa-question-circle fa-inverse"></i></h2>'),t.description&&$(t.target+" h2.chart_title").popover({content:t.description,trigger:"hover",placement:"top"}))}function xAxis(t){var e,a,r,n=d3.select(t.target+" svg");t.scalefns.xf=function(e){return t.scales.X(e[t.x_accessor])};var s;if("line"==t.chart_type)for(var l=0;l<t.data.length;l++)s=t.data[l].length-1,(t.data[l][0][t.x_accessor]<a||!a)&&(a=t.data[l][0][t.x_accessor]),(t.data[l][s][t.x_accessor]>r||!r)&&(r=t.data[l][s][t.x_accessor]);else"point"==t.chart_type&&(r=d3.max(t.data[0],function(e){return e[t.x_accessor]}),a=d3.min(t.data[0],function(e){return e[t.x_accessor]}));a=t.min_x?t.min_x:a,r=t.max_x?t.max_x:r,t.x_axis_negative=!1,t.time_series||(a>=0?a=0:(a-=r*(t.inflator-1),t.x_axis_negative=!0)),t.scales.X=t.time_series?d3.time.scale():d3.scale.linear(),t.scales.X.domain([a,r]).range([t.left+t.buffer,t.width-t.right-t.buffer]),$(t.target+" svg .x-axis").length>0&&$(t.target+" svg .x-axis").remove(),e=n.append("g").classed("x-axis",!0).classed("x-axis-small",t.use_small_class);var s=t.scales.X.ticks(t.xax_count).length-1;if(t.x_label&&e.append("text").attr("class","label").attr("x",function(){return t.left+t.buffer+(t.width-t.right-t.buffer-(t.left+t.buffer))/2}).attr("y",t.height-t.bottom/2).attr("dy",".50em").attr("text-anchor","end").text(function(){return t.x_label}),t.x_extended_ticks||t.y_extended_ticks||e.append("line").attr("x1",t.scales.X(t.scales.X.ticks(t.xax_count)[s])).attr("x2",t.scales.X(t.scales.X.ticks(t.xax_count)[0])).attr("y1",t.height-t.bottom).attr("y2",t.height-t.bottom),e.selectAll(".xax-ticks").data(t.scales.X.ticks(t.xax_count)).enter().append("line").attr("x1",t.scales.X).attr("x2",t.scales.X).attr("y1",t.height-t.bottom).attr("y2",function(){return t.x_extended_ticks?t.top:t.height-t.bottom+t.xax_tick}),e.selectAll(".xax-labels").data(t.scales.X.ticks(t.xax_count)).enter().append("text").attr("x",t.scales.X).attr("y",t.height-t.bottom+7*t.xax_tick/3).attr("dy",".50em").attr("text-anchor","middle").text(function(e){return t.xax_units+t.xax_format(e)}),t.time_series&&t.show_years){for(var a,r,l=0;l<t.data.length;l++)s=t.data[l].length-1,(t.data[l][0][t.x_accessor]<a||!a)&&(a=t.data[l][0][t.x_accessor]),(t.data[l][s][t.x_accessor]>r||!r)&&(r=t.data[l][s][t.x_accessor]);var i=d3.time.years(a,r);if(0==i.length){var c=t.scales.X.ticks(t.xax_count)[0];i=[c]}e=e.append("g").classed("year-marker",!0).classed("year-marker-small",t.use_small_class),e.selectAll(".year_marker").data(i).enter().append("line").attr("x1",t.scales.X).attr("x2",t.scales.X).attr("y1",t.top).attr("y2",t.height-t.bottom);var o=d3.time.format("%Y");e.selectAll(".year_marker").data(i).enter().append("text").attr("x",t.scales.X).attr("y",t.height-t.buffer+t.xax_tick).attr("dy",t.use_small_class?-3:t.y_extended_ticks?-6:0).attr("text-anchor","middle").text(function(t){return o(t)})}return this}function yAxis(t){function e(t){return 1e3==t?3:1e6==t?7:Math.log(t)/Math.LN10}var a,r,n,s=d3.select(t.target+" svg");t.scalefns.yf=function(e){return t.scales.Y(e[t.y_accessor])};for(var l,i,c=0;c<t.data.length;c++)0==c&&(n=t.data[c][0][t.y_accessor],r=t.data[c][0][t.y_accessor]),i=d3.min(t.data[c],function(e){return e[t.y_accessor]}),l=d3.max(t.data[c],function(e){return e[t.y_accessor]}),n=Math.max(n,l),r=Math.min(r,i);r=t.min_y?t.min_y:r,n=t.max_y?t.max_y:n,r>=0?(r=0,t.y_axis_negative=!1):(r-=n*(t.inflator-1),t.y_axis_negative=!0),"log"==t.y_scale_type?(0>=r&&(r=1),t.scales.Y=d3.scale.log().domain([r,n*t.inflator]).range([t.height-t.bottom-t.buffer,t.top])):t.scales.Y=d3.scale.linear().domain([r,n*t.inflator]).range([t.height-t.bottom-t.buffer,t.top]),t.scales.Y_axis=d3.scale.linear().domain([r,n*t.inflator]).range([t.height-t.bottom-t.buffer,t.top]);var o;o="count"==t.format?function(e){var a=d3.formatPrefix(e);return t.yax_units+a.scale(e)+a.symbol}:function(t){var e=d3.format("%p");return e(t)},$(t.target+" svg .y-axis").length>0&&$(t.target+" svg .y-axis").remove(),a=s.append("g").classed("y-axis",!0).classed("y-axis-small",t.use_small_class),t.y_label&&a.append("text").attr("class","label").attr("x",function(){return-1*(t.top+t.buffer+(t.height-t.bottom-t.buffer-(t.top+t.buffer))/2)}).attr("y",function(){return t.left/2}).attr("dy","0.4em").attr("text-anchor","middle").text(function(){return t.y_label}).attr("transform",function(){return"rotate(-90)"});var d=t.scales.Y.ticks(t.yax_count);"log"==t.y_scale_type&&(d=d.filter(function(t){return e(t)%1===0||e(t)%1<1-1e6}));var u=d.length-1;return t.x_extended_ticks||t.y_extended_ticks||a.append("line").attr("x1",t.left).attr("x2",t.left).attr("y1",t.scales.Y(d[0])).attr("y2",t.scales.Y(d[u])),a.selectAll(".yax-ticks").data(d).enter().append("line").attr("x1",t.left).attr("x2",function(){return t.y_extended_ticks?t.width-t.right:t.left-t.yax_tick}).attr("y1",t.scales.Y).attr("y2",t.scales.Y),a.selectAll(".yax-labels").data(d).enter().append("text").attr("x",t.left-3*t.yax_tick/2).attr("dx",-3).attr("y",t.scales.Y).attr("dy",".35em").attr("text-anchor","end").text(function(t){var e=o(t);return e}),this}function init(t){if($.isArray(t.data[0])||(t.data=[t.data]),$.isArray(t.y_accessor)&&(t.data=t.data.map(function(e){return t.y_accessor.map(function(t){return e.map(function(e){return e=clone(e),e.multiline_y_accessor=e[t],e})})})[0],t.y_accessor="multiline_y_accessor"),"line"==t.chart_type)for(var e=0;e<t.data.length;e++)t.data[e].sort(function(e,a){return e[t.x_accessor]-a[t.x_accessor]});t.time_series="date"==$.type(t.data[0][0][t.x_accessor])?!0:!1;return $(t.target).is(":empty")&&(chart_title(t),d3.select(t.target).append("svg").classed("linked",t.linked).attr("width",t.width).attr("height",t.height)),t.use_small_class=t.height-t.top-t.bottom-t.buffer<=t.small_height_threshold&&t.width-t.left-t.right-2*t.buffer<=t.small_width_threshold||t.small_text,xAxis(t),yAxis(t),this}function markers(t){var e,a,r=d3.select(t.target+" svg");return t.markers&&($(t.target+" svg .markers").length>0&&$(t.target+" svg .markers").remove(),e=r.append("g").attr("class","markers"),e.selectAll(".markers").data(t.markers).enter().append("line").attr("x1",function(e){return t.scales.X(e[t.x_accessor])}).attr("x2",function(e){return t.scales.X(e[t.x_accessor])}).attr("y1",t.top).attr("y2",function(){return t.height-t.bottom-t.buffer}).attr("stroke-dasharray","3,1"),e.selectAll(".markers").data(t.markers).enter().append("text").attr("x",function(e){return t.scales.X(e[t.x_accessor])}).attr("y",t.top-8).attr("text-anchor","middle").text(function(t){return t.label})),t.baselines&&(r.selectAll(".baselines").remove(),a=r.append("g").attr("class","baselines"),a.selectAll(".baselines").data(t.baselines).enter().append("line").attr("x1",t.left+t.buffer).attr("x2",t.width-t.right-t.buffer).attr("y1",function(e){return t.scales.Y(e.value)}).attr("y2",function(e){return t.scales.Y(e.value)}),a.selectAll(".baselines").data(t.baselines).enter().append("text").attr("x",t.width-t.right-t.buffer).attr("y",function(e){return t.scales.Y(e.value)}).attr("dy",-3).attr("text-anchor","end").text(function(t){return t.label})),this}function modify_time_period(t,e){var a=clone(t);if(""!=e)for(var r=0;r<a.length;r++){var n=a[r].length-e;a[r].splice(0,n)}return a}function convert_dates(t){return t=t.map(function(t){var e=d3.time.format("%Y-%m-%d");return t.date=e.parse(t.date),t})}function merge_with_defaults(t){return each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var a in e)void 0===t[a]&&(t[a]=e[a])}),t}function number_of_values(t,e,a){var r=t.filter(function(t){return t[e]===a});return r.length}function has_values_below(t,e,a){var r=t.filter(function(t){return t[e]<=a});return r.length>0}function has_too_many_zeros(t,e,a){return number_of_values(t,e,0)>=a}function clone(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date){var e=new Date;return e.setTime(t.getTime()),e}if(t instanceof Array){for(var e=[],a=0,r=t.length;r>a;a++)e[a]=clone(t[a]);return e}if(t instanceof Object){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=clone(t[n]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")}var charts={},globals={};globals.link=!1,charts.line=function(t){return this.args=t,this.init=function(t){return init(t),this},this.mainPlot=function(){var e,a=d3.select(t.target+" svg"),r=0,n=d3.svg.area().x(t.scalefns.xf).y0(t.scales.Y("linear"==t.y_scale_type?0:1)).y1(t.scalefns.yf).interpolate(t.interpolate);if(t.show_confidence_band)var e=d3.svg.area().x(t.scalefns.xf).y0(function(e){var a=t.show_confidence_band[0];return t.scales.Y(e[a])}).y1(function(e){var a=t.show_confidence_band[1];return t.scales.Y(e[a])}).interpolate(t.interpolate);for(var s=d3.svg.line().x(t.scalefns.xf).y(t.scalefns.yf).interpolate(t.interpolate),l=d3.svg.line().x(t.scalefns.xf).y(function(){return t.scales.Y(r)}).interpolate(t.interpolate),i=t.data.length-1;i>=0;i--)t.show_confidence_band&&a.append("path").attr("class","confidence-band").attr("d",e(t.data[i])),t.area&&!t.y_axis_negative&&t.data.length<=1&&($(t.target+" svg path.area"+(i+1)+"-color").length>0?d3.selectAll(t.target+" svg path.area"+(i+1)+"-color").transition().duration(function(){return t.transition_on_update?1e3:0}).attr("d",n(t.data[i])):a.append("path").attr("class","main-area area"+(i+1)+"-color").attr("d",n(t.data[i]))),$(t.target+" svg path.line"+(i+1)+"-color").length>0?d3.selectAll(t.target+" svg path.line"+(i+1)+"-color").transition().duration(function(){return t.transition_on_update?1e3:0}).attr("d",s(t.data[i])):t.animate_on_load?(r=d3.median(t.data[i],function(e){return e[t.y_accessor]}),a.append("path").attr("class","main-line line"+(i+1)+"-color").attr("d",l(t.data[i])).transition().duration(1e3).attr("d",s(t.data[i]))):a.append("path").attr("class","main-line line"+(i+1)+"-color").attr("d",s(t.data[i]));return this},this.markers=function(){return markers(t),this},this.rollover=function(){var e,a=d3.select(t.target+" svg");$(t.target+" svg .transparent-rollover-rect").length>0&&$(t.target+" svg .transparent-rollover-rect").remove(),$(t.target+" svg .voronoi").length>0&&$(t.target+" svg .voronoi").remove(),a.append("text").attr("class","active_datapoint").attr("xml:space","preserve").attr("x",t.width-t.right).attr("y",t.top/2).attr("text-anchor","end"),a.append("circle").classed("line_rollover_circle",!0).attr("cx",0).attr("cy",0).attr("r",0);for(var r=1,n=0;n<t.data.length;n++){for(var s=0;s<t.data[n].length;s++)t.data[n][s].line_id=r;r++}if(t.data.length>1){var l=d3.geom.voronoi().x(function(e){return t.scales.X(e[t.x_accessor])}).y(function(e){return t.scales.Y(e[t.y_accessor])}),e=a.append("g").attr("class","voronoi"),i=d3.nest().key(function(e){return t.scales.X(e[t.x_accessor])+","+t.scales.Y(e[t.y_accessor])}).rollup(function(t){return t[0]}).entries(d3.merge(t.data.map(function(t){return t}))).map(function(t){return t.values});e.selectAll("path").data(l(i)).enter().append("path").attr("d",function(t){return"M"+t.join("L")+"Z"}).datum(function(t){return t.point}).attr("class",function(e){if(t.linked){var a=e[t.x_accessor],r=d3.time.format("%Y-%m-%d");return"line"+e.line_id+"-color roll_"+r(a)}return"line"+e.line_id+"-color"}).on("mouseover",this.rolloverOn(t)).on("mouseout",this.rolloverOff(t))}else{var r=1,e=a.append("g").attr("class","transparent-rollover-rect");e.selectAll(".rollover-rects").data(t.data[0]).enter().append("rect").attr("class",function(e,a){if(t.linked){var n=e[t.x_accessor],s=d3.time.format("%Y-%m-%d"),l="number"==typeof n?a:s(n);return"line"+r+"-color roll_"+l}return"line"+r+"-color"}).attr("x",function(e,a){var r,n=e;if(0==a){var s=t.data[0][1];r=t.scalefns.xf(n)-(t.scalefns.xf(s)-t.scalefns.xf(n))/2}else{var l=t.scalefns.xf(t.data[0][1])-t.scalefns.xf(t.data[0][0]);r=t.scalefns.xf(n)-l/2}return r}).attr("y",function(e){return t.data.length>1?t.scalefns.yf(e)-6:t.top}).attr("width",function(e,a){return a!=t.data[0].length-1?t.scalefns.xf(t.data[0][a+1])-t.scalefns.xf(e):t.scalefns.xf(t.data[0][1])-t.scalefns.xf(t.data[0][0])}).attr("height",function(){return t.data.length>1?12:t.height-t.bottom-t.top-t.buffer}).attr("opacity",0).on("mouseover",this.rolloverOn(t)).on("mouseout",this.rolloverOff(t))}return this},this.rolloverOn=function(t){{var e=d3.select(t.target+" svg");d3.time.format("%Y-%m-%d")}return function(a,r){if(e.selectAll("circle.line_rollover_circle").attr("class","").attr("class","area"+a.line_id+"-color").classed("line_rollover_circle",!0).attr("cx",function(){return t.scales.X(a[t.x_accessor])}).attr("cy",function(){return t.scales.Y(a[t.y_accessor])}).attr("r",2.5).style("opacity",1),t.linked&&!globals.link){globals.link=!0;var n=a[t.x_accessor],s=d3.time.format("%Y-%m-%d"),l="number"==typeof n?r:s(n);d3.selectAll(".line"+a.line_id+"-color.roll_"+l).each(function(t,e){d3.select(this).on("mouseover")(t,e)})}e.selectAll("text").filter(function(t){return a==t}).attr("opacity",.3);var i=d3.time.format("%b %e, %Y");if("count"==t.format)var c=function(e){var a=e%1!=0,r=d3.format("0,000");return e=a?d3.round(e,t.decimals):e,r(e)};else var c=function(e){var a=(t.decimals?"."+t.decimals:"")+"%",r=d3.format(a);return r(e)};t.show_rollover_text&&e.select(".active_datapoint").text(function(){if(t.time_series){var e=new Date(+a[t.x_accessor]);return e.setDate(e.getDate()),i(e)+"  "+t.yax_units+c(a[t.y_accessor])}return t.x_accessor+": "+c(a[t.x_accessor])+", "+t.y_accessor+": "+t.yax_units+c(a[t.y_accessor])}),t.rollover_callback&&t.rollover_callback(a,r)}},this.rolloverOff=function(t){var e=d3.select(t.target+" svg");return function(a,r){if(t.linked&&globals.link){globals.link=!1;var n=a[t.x_accessor],s=d3.time.format("%Y-%m-%d"),l="number"==typeof n?r:s(n);d3.selectAll(".roll_"+l).each(function(t){d3.select(this).on("mouseout")(t)})}e.selectAll("circle.line_rollover_circle").style("opacity",0),e.select(".active_datapoint").text("")}},this.init(t),this},charts.point=function(t){return this.args=t,this.init=function(t){return init(t),this},this.markers=function(){return markers(t),this},this.mainPlot=function(){var e,a=d3.select(t.target+" svg");return e=a.append("g").classed("points",!0),e.selectAll("circle").data(t.data[0]).enter().append("svg:circle").attr("cx",t.scalefns.xf).attr("cy",t.scalefns.yf).attr("r",2),this},this.rollover=function(){var e=d3.select(t.target+" svg"),a=e.append("g").attr("id","point-clips"),r=e.append("g").attr("id","point-paths");a.selectAll("clipPath").data(t.data[0]).enter().append("clipPath").attr("id",function(t,e){return"clip-"+e}).append("circle").attr("cx",t.scalefns.xf).attr("cy",t.scalefns.yf).attr("r",20);var n=d3.geom.voronoi().x(t.scalefns.xf).y(t.scalefns.yf);return r.selectAll("path").data(n(t.data[0])).enter().append("path").attr("d",function(t){return"M"+t.join(",")+"Z"}).attr("id",function(t,e){return"path-"+e}).attr("clip-path",function(t,e){return"url(#clip-"+e+")"}).style("fill-opacity",0).on("mouseover",this.rolloverOn(t)).on("mouseout",this.rolloverOff(t)),this},this.rolloverOn=function(t){var e=d3.select(t.target+" svg");return function(t,a){e.selectAll(".points circle").classed("unselected",!0),e.selectAll(".points circle").filter(function(t,e){return a==e}).classed("unselected",!1).classed("selected",!0).attr("r",3)}},this.rolloverOff=function(t){var e=d3.select(t.target+" svg");return function(){e.selectAll(".points circle").classed("unselected",!1).classed("selected",!1).attr("r",2)}},this.update=function(){return this},this.init(t),this},charts.missing=function(t){return this.args=t,this.init=function(t){if($(t.target).is(":empty")){chart_title(t);var e=d3.select(t.target).append("svg").attr("width",t.width).attr("height",t.height);e.append("rect").attr("class","missing-pane").attr("x",t.left).attr("y",t.top).attr("width",t.width-2*t.left).attr("height",t.height-2*t.top),e.append("text").attr("x",t.width/2).attr("y",t.height/2).attr("dy",".50em").attr("text-anchor","middle").text(function(){return"Data currently missing or unavailable"})}return this},this.init(t),this};var each=function(t,e,a){if(null==t)return t;if(Array.prototype.forEach&&t.forEach===Array.prototype.forEach)t.forEach(e,a);else if(t.length===+t.length){for(var r=0,n=t.length;n>r;r++)if(e.call(a,t[r],r,t)===breaker)return}else for(var s in t)if(e.call(a,t[s],s,t)===breaker)return;return t};