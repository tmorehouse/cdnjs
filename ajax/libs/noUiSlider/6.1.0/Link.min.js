(function(f){function a(j,i,h){if((j[i]||j[h])&&(j[i]===j[h])){throw new Error("(Link) '"+i+"' can't match '"+h+"'.'")}}function e(h){return h instanceof f||(f.zepto&&f.zepto["isZ"](h))}var g=["decimals","mark","thousand","prefix","postfix","encoder","decoder","negative","negativeBefore","to","from"],c=[2,".","","","",function(h){return h},function(h){return h},"-","",function(h){return h},function(h){return h}];function d(h){if(h===undefined){h={}}if(typeof h!=="object"){throw new Error("(Format) 'format' option must be an object.")}var i={};f(g).each(function(j,k){if(h[k]===undefined){i[k]=c[j]}else{if((typeof h[k])===(typeof c[j])){if(k==="decimals"){if(h[k]<0||h[k]>7){throw new Error("(Format) 'format.decimals' option must be between 0 and 7.")}}i[k]=h[k]}else{throw new Error("(Format) 'format."+k+"' must be a "+typeof c[j]+".")}}});a(i,"mark","thousand");a(i,"prefix","negative");a(i,"prefix","negativeBefore");this.settings=i}d.prototype.v=function(h){return this.settings[h]};d.prototype.to=function(l){function j(o){return o.split("").reverse().join("")}l=this.v("encoder")(l);var h=this.v("decimals"),i="",k="",m="",n="";if(parseFloat(l.toFixed(h))===0){l="0"}if(l<0){i=this.v("negative");k=this.v("negativeBefore")}l=Math.abs(l).toFixed(h).toString();l=l.split(".");if(this.v("thousand")){m=j(l[0]).match(/.{1,3}/g);m=j(m.join(j(this.v("thousand"))))}else{m=l[0]}if(this.v("mark")&&l.length>1){n=this.v("mark")+l[1]}return this.v("to")(k+this.v("prefix")+i+m+n+this.v("postfix"))};d.prototype.from=function(i){function h(k){return k.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}var j;if(i===null||i===undefined){return false}i=this.v("from")(i);i=i.toString();j=i.replace(new RegExp("^"+h(this.v("negativeBefore"))),"");if(i!==j){i=j;j="-"}else{j=""}i=i.replace(new RegExp("^"+h(this.v("prefix"))),"");if(this.v("negative")){j="";i=i.replace(new RegExp("^"+h(this.v("negative"))),"-")}i=i.replace(new RegExp(h(this.v("postfix"))+"$"),"").replace(new RegExp(h(this.v("thousand")),"g"),"").replace(this.v("mark"),".");i=this.v("decoder")(parseFloat(j+i));if(isNaN(i)){return false}return i};function b(h,i){if(typeof h!=="object"){f.error("(Link) Initialize with an object.")}return new b.prototype.init(h.target||function(){},h.method,h.format||{},i)}b.prototype.setTooltip=function(h,i){this.method=i||"html";this.el=f(h.replace("-tooltip-","")||"<div/>")[0]};b.prototype.setHidden=function(h){this.method="val";this.el=document.createElement("input");this.el.name=h;this.el.type="hidden"};b.prototype.setField=function(j){function h(l,k,m){return[m?l:k,m?k:l]}var i=this;this.method="val";this.target=j.on("change",function(k){i.obj.val(h(null,f(k.target).val(),i.N),{link:i,set:true})})};b.prototype.init=function(i,k,h,j){this.formatting=h;this.update=!j;if(typeof i==="string"&&i.indexOf("-tooltip-")===0){this.setTooltip(i,k);return}if(typeof i==="string"&&i.indexOf("-")!==0){this.setHidden(i);return}if(typeof i==="function"){this.target=false;this.method=i;return}if(e(i)){if(!k){if(i.is("input, select, textarea")){this.setField(i);return}k="html"}if(typeof k==="function"||(typeof k==="string"&&i[k])){this.method=k;this.target=i;return}}throw new RangeError("(Link) Invalid Link.")};b.prototype.write=function(j,i,h,k){if(this.update&&k===false){return}this.actual=j;j=this.format(j);this.saved=j;if(typeof this.method==="function"){this.method.call(this.target[0]||h[0],j,i,h)}else{this.target[this.method](j,i,h)}};b.prototype.setFormatting=function(h){this.formatting=new d(f.extend({},h,this.formatting instanceof d?this.formatting.settings:this.formatting))};b.prototype.setObject=function(h){this.obj=h};b.prototype.setIndex=function(h){this.N=h};b.prototype.format=function(h){return this.formatting.to(h)};b.prototype.getValue=function(h){return this.formatting.from(h)};b.prototype.init.prototype=b.prototype;f.Link=b}(window.jQuery||window.Zepto));