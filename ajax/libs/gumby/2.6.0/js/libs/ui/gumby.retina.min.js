!function(b){function a(c){Gumby.debug("Initializing Retina",c);this.$el=c;this.imageSrc=this.$el.attr("src");this.retinaSrc=this.fetchRetinaImage();this.$retinaImg=b(new Image());var d=this;if(!this.retinaSrc){return false}this.$retinaImg.attr("src",this.retinaSrc).load(function(){d.retinaImageLoaded()}).error(function(){Gumby.error("Couln't load retina image: "+d.retinaSrc)})}a.prototype.fetchRetinaImage=function(){var d=this.imageSrc,c=this.imageSrc.search(/(\.|\/)(gif|jpe?g|png)$/i);if(c<0){return false}return d.substr(0,c)+"@2x"+d.substr(c,d.length)};a.prototype.retinaImageLoaded=function(){Gumby.debug("Swapping image for retina version",this.$el);Gumby.debug("Triggering onRetina event",this.$el);this.$el.attr("src",this.$retinaImg.attr("src")).trigger("gumby.onRetina")};Gumby.addInitalisation("retina",function(){if(!window.devicePixelRatio||window.devicePixelRatio<=1){return}b("img[data-retina],img[gumby-retina],img[retina]").each(function(){var c=b(this);if(c.data("isRetina")){return true}c.data("isRetina",true);new a(c)})});Gumby.UIModule({module:"retina",events:["onRetina"],init:function(){Gumby.initialize("retina")}})}(jQuery);